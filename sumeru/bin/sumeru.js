function BigInteger(e,t,n){e!=null&&("number"==typeof e?this.fromNumber(e,t,n):t==null&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function nbi(){return new BigInteger(null)}function am1(e,t,n,r,i,s){while(--s>=0){var o=t*this[e++]+n[r]+i;i=Math.floor(o/67108864),n[r++]=o&67108863}return i}function am2(e,t,n,r,i,s){var o=t&32767,u=t>>15;while(--s>=0){var a=this[e]&32767,f=this[e++]>>15,l=u*a+f*o;a=o*a+((l&32767)<<15)+n[r]+(i&1073741823),i=(a>>>30)+(l>>>15)+u*f+(i>>>30),n[r++]=a&1073741823}return i}function am3(e,t,n,r,i,s){var o=t&16383,u=t>>14;while(--s>=0){var a=this[e]&16383,f=this[e++]>>14,l=u*a+f*o;a=o*a+((l&16383)<<14)+n[r]+i,i=(a>>28)+(l>>14)+u*f,n[r++]=a&268435455}return i}function int2char(e){return BI_RM.charAt(e)}function intAt(e,t){var n=BI_RC[e.charCodeAt(t)];return n==null?-1:n}function bnpCopyTo(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s}function bnpFromInt(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+DV:this.t=0}function nbv(e){var t=nbi();return t.fromInt(e),t}function bnpFromString(e,t){var n;if(t==16)n=4;else if(t==8)n=3;else if(t==256)n=8;else if(t==2)n=1;else if(t==32)n=5;else{if(t!=4){this.fromRadix(e,t);return}n=2}this.t=0,this.s=0;var r=e.length,i=!1,s=0;while(--r>=0){var o=n==8?e[r]&255:intAt(e,r);if(o<0){e.charAt(r)=="-"&&(i=!0);continue}i=!1,s==0?this[this.t++]=o:s+n>this.DB?(this[this.t-1]|=(o&(1<<this.DB-s)-1)<<s,this[this.t++]=o>>this.DB-s):this[this.t-1]|=o<<s,s+=n,s>=this.DB&&(s-=this.DB)}n==8&&(e[0]&128)!=0&&(this.s=-1,s>0&&(this[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),i&&BigInteger.ZERO.subTo(this,this)}function bnpClamp(){var e=this.s&this.DM;while(this.t>0&&this[this.t-1]==e)--this.t}function bnToString(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(e==16)t=4;else if(e==8)t=3;else if(e==2)t=1;else if(e==32)t=5;else{if(e!=4)return this.toRadix(e);t=2}var n=(1<<t)-1,r,i=!1,s="",o=this.t,u=this.DB-o*this.DB%t;if(o-->0){u<this.DB&&(r=this[o]>>u)>0&&(i=!0,s=int2char(r));while(o>=0)u<t?(r=(this[o]&(1<<u)-1)<<t-u,r|=this[--o]>>(u+=this.DB-t)):(r=this[o]>>(u-=t)&n,u<=0&&(u+=this.DB,--o)),r>0&&(i=!0),i&&(s+=int2char(r))}return i?s:"0"}function bnNegate(){var e=nbi();return BigInteger.ZERO.subTo(this,e),e}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(e){var t=this.s-e.s;if(t!=0)return t;var n=this.t;t=n-e.t;if(t!=0)return this.s<0?-t:t;while(--n>=0)if((t=this[n]-e[n])!=0)return t;return 0}function nbits(e){var t=1,n;return(n=e>>>16)!=0&&(e=n,t+=16),(n=e>>8)!=0&&(e=n,t+=8),(n=e>>4)!=0&&(e=n,t+=4),(n=e>>2)!=0&&(e=n,t+=2),(n=e>>1)!=0&&(e=n,t+=1),t}function bnBitLength(){return this.t<=0?0:this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(e,t){var n;for(n=this.t-1;n>=0;--n)t[n+e]=this[n];for(n=e-1;n>=0;--n)t[n]=0;t.t=this.t+e,t.s=this.s}function bnpDRShiftTo(e,t){for(var n=e;n<this.t;++n)t[n-e]=this[n];t.t=Math.max(this.t-e,0),t.s=this.s}function bnpLShiftTo(e,t){var n=e%this.DB,r=this.DB-n,i=(1<<r)-1,s=Math.floor(e/this.DB),o=this.s<<n&this.DM,u;for(u=this.t-1;u>=0;--u)t[u+s+1]=this[u]>>r|o,o=(this[u]&i)<<n;for(u=s-1;u>=0;--u)t[u]=0;t[s]=o,t.t=this.t+s+1,t.s=this.s,t.clamp()}function bnpRShiftTo(e,t){t.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t){t.t=0;return}var r=e%this.DB,i=this.DB-r,s=(1<<r)-1;t[0]=this[n]>>r;for(var o=n+1;o<this.t;++o)t[o-n-1]|=(this[o]&s)<<i,t[o-n]=this[o]>>r;r>0&&(t[this.t-n-1]|=(this.s&s)<<i),t.t=this.t-n,t.clamp()}function bnpSubTo(e,t){var n=0,r=0,i=Math.min(e.t,this.t);while(n<i)r+=this[n]-e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){r-=e.s;while(n<this.t)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{r+=this.s;while(n<e.t)r-=e[n],t[n++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=r<0?-1:0,r<-1?t[n++]=this.DV+r:r>0&&(t[n++]=r),t.t=n,t.clamp()}function bnpMultiplyTo(e,t){var n=this.abs(),r=e.abs(),i=n.t;t.t=i+r.t;while(--i>=0)t[i]=0;for(i=0;i<r.t;++i)t[i+n.t]=n.am(0,r[i],t,i,0,n.t);t.s=0,t.clamp(),this.s!=e.s&&BigInteger.ZERO.subTo(t,t)}function bnpSquareTo(e){var t=this.abs(),n=e.t=2*t.t;while(--n>=0)e[n]=0;for(n=0;n<t.t-1;++n){var r=t.am(n,t[n],e,2*n,0,1);(e[n+t.t]+=t.am(n+1,2*t[n],e,2*n+1,r,t.t-n-1))>=t.DV&&(e[n+t.t]-=t.DV,e[n+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(n,t[n],e,2*n,0,1)),e.s=0,e.clamp()}function bnpDivRemTo(e,t,n){var r=e.abs();if(r.t<=0)return;var i=this.abs();if(i.t<r.t){t!=null&&t.fromInt(0),n!=null&&this.copyTo(n);return}n==null&&(n=nbi());var s=nbi(),o=this.s,u=e.s,a=this.DB-nbits(r[r.t-1]);a>0?(r.lShiftTo(a,s),i.lShiftTo(a,n)):(r.copyTo(s),i.copyTo(n));var f=s.t,l=s[f-1];if(l==0)return;var c=l*(1<<this.F1)+(f>1?s[f-2]>>this.F2:0),h=this.FV/c,p=(1<<this.F1)/c,d=1<<this.F2,v=n.t,m=v-f,g=t==null?nbi():t;s.dlShiftTo(m,g),n.compareTo(g)>=0&&(n[n.t++]=1,n.subTo(g,n)),BigInteger.ONE.dlShiftTo(f,g),g.subTo(s,s);while(s.t<f)s[s.t++]=0;while(--m>=0){var y=n[--v]==l?this.DM:Math.floor(n[v]*h+(n[v-1]+d)*p);if((n[v]+=s.am(0,y,n,m,0,f))<y){s.dlShiftTo(m,g),n.subTo(g,n);while(n[v]<--y)n.subTo(g,n)}}t!=null&&(n.drShiftTo(f,t),o!=u&&BigInteger.ZERO.subTo(t,t)),n.t=f,n.clamp(),a>0&&n.rShiftTo(a,n),o<0&&BigInteger.ZERO.subTo(n,n)}function bnMod(e){var t=nbi();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(BigInteger.ZERO)>0&&e.subTo(t,t),t}function Classic(e){this.m=e}function cConvert(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e}function cRevert(e){return e}function cReduce(e){e.divRemTo(this.m,null,e)}function cMulTo(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function cSqrTo(e,t){e.squareTo(t),this.reduce(t)}function bnpInvDigit(){if(this.t<1)return 0;var e=this[0];if((e&1)==0)return 0;var t=e&3;return t=t*(2-(e&15)*t)&15,t=t*(2-(e&255)*t)&255,t=t*(2-((e&65535)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}function Montgomery(e){this.m=e,this.mp=e.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function montConvert(e){var t=nbi();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(BigInteger.ZERO)>0&&this.m.subTo(t,t),t}function montRevert(e){var t=nbi();return e.copyTo(t),this.reduce(t),t}function montReduce(e){while(e.t<=this.mt2)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=e[t]&32767,r=n*this.mpl+((n*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;n=t+this.m.t,e[n]+=this.m.am(0,r,e,t,0,this.m.t);while(e[n]>=e.DV)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function montSqrTo(e,t){e.squareTo(t),this.reduce(t)}function montMulTo(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function bnpIsEven(){return(this.t>0?this[0]&1:this.s)==0}function bnpExp(e,t){if(e>4294967295||e<1)return BigInteger.ONE;var n=nbi(),r=nbi(),i=t.convert(this),s=nbits(e)-1;i.copyTo(n);while(--s>=0){t.sqrTo(n,r);if((e&1<<s)>0)t.mulTo(r,i,n);else{var o=n;n=r,r=o}}return t.revert(n)}function bnModPowInt(e,t){var n;return e<256||t.isEven()?n=new Classic(t):n=new Montgomery(t),this.exp(e,n)}function Arcfour(){this.i=0,this.j=0,this.S=new Array}function ARC4init(e){var t,n,r;for(t=0;t<256;++t)this.S[t]=t;n=0;for(t=0;t<256;++t)n=n+this.S[t]+e[t%e.length]&255,r=this.S[t],this.S[t]=this.S[n],this.S[n]=r;this.i=0,this.j=0}function ARC4next(){var e;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,e=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=e,this.S[e+this.S[this.i]&255]}function prng_newstate(){return new Arcfour}function rng_seed_int(e){rng_pool[rng_pptr++]^=e&255,rng_pool[rng_pptr++]^=e>>8&255,rng_pool[rng_pptr++]^=e>>16&255,rng_pool[rng_pptr++]^=e>>24&255,rng_pptr>=rng_psize&&(rng_pptr-=rng_psize)}function rng_seed_time(){rng_seed_int((new Date).getTime())}function rng_get_byte(){if(rng_state==null){rng_seed_time(),rng_state=prng_newstate(),rng_state.init(rng_pool);for(rng_pptr=0;rng_pptr<rng_pool.length;++rng_pptr)rng_pool[rng_pptr]=0;rng_pptr=0}return rng_state.next()}function rng_get_bytes(e){var t;for(t=0;t<e.length;++t)e[t]=rng_get_byte()}function SecureRandom(){}function parseBigInt(e,t){return new BigInteger(e,t)}function linebrk(e,t){var n="",r=0;while(r+t<e.length)n+=e.substring(r,r+t)+"\n",r+=t;return n+e.substring(r,e.length)}function byte2Hex(e){return e<16?"0"+e.toString(16):e.toString(16)}function pkcs1pad2(e,t){if(t<e.length+11)return console.log("Message too long for RSA"),null;var n=new Array,r=e.length-1;while(r>=0&&t>0){var i=e.charCodeAt(r--);i<128?n[--t]=i:i>127&&i<2048?(n[--t]=i&63|128,n[--t]=i>>6|192):(n[--t]=i&63|128,n[--t]=i>>6&63|128,n[--t]=i>>12|224)}n[--t]=0;var s=new SecureRandom,o=new Array;while(t>2){o[0]=0;while(o[0]==0)s.nextBytes(o);n[--t]=o[0]}return n[--t]=2,n[--t]=0,new BigInteger(n)}function RSAKey(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function RSASetPublic(e,t){e!=null&&t!=null&&e.length>0&&t.length>0?(this.n=parseBigInt(e,16),this.e=parseInt(t,16)):console.log("Invalid RSA public key")}function RSADoPublic(e){return e.modPowInt(this.e,this.n)}function RSAEncrypt(e){var t=pkcs1pad2(e,this.n.bitLength()+7>>3);if(t==null)return null;var n=this.doPublic(t);if(n==null)return null;var r=n.toString(16);return(r.length&1)==0?r:"0"+r}function bnClone(){var e=nbi();return this.copyTo(e),e}function bnIntValue(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function bnByteValue(){return this.t==0?this.s:this[0]<<24>>24}function bnShortValue(){return this.t==0?this.s:this[0]<<16>>16}function bnpChunkSize(e){return Math.floor(Math.LN2*this.DB/Math.log(e))}function bnSigNum(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function bnpToRadix(e){e==null&&(e=10);if(this.signum()==0||e<2||e>36)return"0";var t=this.chunkSize(e),n=Math.pow(e,t),r=nbv(n),i=nbi(),s=nbi(),o="";this.divRemTo(r,i,s);while(i.signum()>0)o=(n+s.intValue()).toString(e).substr(1)+o,i.divRemTo(r,i,s);return s.intValue().toString(e)+o}function bnpFromRadix(e,t){this.fromInt(0),t==null&&(t=10);var n=this.chunkSize(t),r=Math.pow(t,n),i=!1,s=0,o=0;for(var u=0;u<e.length;++u){var a=intAt(e,u);if(a<0){e.charAt(u)=="-"&&this.signum()==0&&(i=!0);continue}o=t*o+a,++s>=n&&(this.dMultiply(r),this.dAddOffset(o,0),s=0,o=0)}s>0&&(this.dMultiply(Math.pow(t,s)),this.dAddOffset(o,0)),i&&BigInteger.ZERO.subTo(this,this)}function bnpFromNumber(e,t,n){if("number"==typeof t)if(e<2)this.fromInt(1);else{this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo(BigInteger.ONE.shiftLeft(e-1),op_or,this),this.isEven()&&this.dAddOffset(1,0);while(!this.isProbablePrime(t))this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(BigInteger.ONE.shiftLeft(e-1),this)}else{var r=new Array,i=e&7;r.length=(e>>3)+1,t.nextBytes(r),i>0?r[0]&=(1<<i)-1:r[0]=0,this.fromString(r,256)}}function bnToByteArray(){var e=this.t,t=new Array;t[0]=this.s;var n=this.DB-e*this.DB%8,r,i=0;if(e-->0){n<this.DB&&(r=this[e]>>n)!=(this.s&this.DM)>>n&&(t[i++]=r|this.s<<this.DB-n);while(e>=0){n<8?(r=(this[e]&(1<<n)-1)<<8-n,r|=this[--e]>>(n+=this.DB-8)):(r=this[e]>>(n-=8)&255,n<=0&&(n+=this.DB,--e)),(r&128)!=0&&(r|=-256),i==0&&(this.s&128)!=(r&128)&&++i;if(i>0||r!=this.s)t[i++]=r}}return t}function bnEquals(e){return this.compareTo(e)==0}function bnMin(e){return this.compareTo(e)<0?this:e}function bnMax(e){return this.compareTo(e)>0?this:e}function bnpBitwiseTo(e,t,n){var r,i,s=Math.min(e.t,this.t);for(r=0;r<s;++r)n[r]=t(this[r],e[r]);if(e.t<this.t){i=e.s&this.DM;for(r=s;r<this.t;++r)n[r]=t(this[r],i);n.t=this.t}else{i=this.s&this.DM;for(r=s;r<e.t;++r)n[r]=t(i,e[r]);n.t=e.t}n.s=t(this.s,e.s),n.clamp()}function op_and(e,t){return e&t}function bnAnd(e){var t=nbi();return this.bitwiseTo(e,op_and,t),t}function op_or(e,t){return e|t}function bnOr(e){var t=nbi();return this.bitwiseTo(e,op_or,t),t}function op_xor(e,t){return e^t}function bnXor(e){var t=nbi();return this.bitwiseTo(e,op_xor,t),t}function op_andnot(e,t){return e&~t}function bnAndNot(e){var t=nbi();return this.bitwiseTo(e,op_andnot,t),t}function bnNot(){var e=nbi();for(var t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e}function bnShiftLeft(e){var t=nbi();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t}function bnShiftRight(e){var t=nbi();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t}function lbit(e){if(e==0)return-1;var t=0;return(e&65535)==0&&(e>>=16,t+=16),(e&255)==0&&(e>>=8,t+=8),(e&15)==0&&(e>>=4,t+=4),(e&3)==0&&(e>>=2,t+=2),(e&1)==0&&++t,t}function bnGetLowestSetBit(){for(var e=0;e<this.t;++e)if(this[e]!=0)return e*this.DB+lbit(this[e]);return this.s<0?this.t*this.DB:-1}function cbit(e){var t=0;while(e!=0)e&=e-1,++t;return t}function bnBitCount(){var e=0,t=this.s&this.DM;for(var n=0;n<this.t;++n)e+=cbit(this[n]^t);return e}function bnTestBit(e){var t=Math.floor(e/this.DB);return t>=this.t?this.s!=0:(this[t]&1<<e%this.DB)!=0}function bnpChangeBit(e,t){var n=BigInteger.ONE.shiftLeft(e);return this.bitwiseTo(n,t,n),n}function bnSetBit(e){return this.changeBit(e,op_or)}function bnClearBit(e){return this.changeBit(e,op_andnot)}function bnFlipBit(e){return this.changeBit(e,op_xor)}function bnpAddTo(e,t){var n=0,r=0,i=Math.min(e.t,this.t);while(n<i)r+=this[n]+e[n],t[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){r+=e.s;while(n<this.t)r+=this[n],t[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{r+=this.s;while(n<e.t)r+=e[n],t[n++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=r<0?-1:0,r>0?t[n++]=r:r<-1&&(t[n++]=this.DV+r),t.t=n,t.clamp()}function bnAdd(e){var t=nbi();return this.addTo(e,t),t}function bnSubtract(e){var t=nbi();return this.subTo(e,t),t}function bnMultiply(e){var t=nbi();return this.multiplyTo(e,t),t}function bnSquare(){var e=nbi();return this.squareTo(e),e}function bnDivide(e){var t=nbi();return this.divRemTo(e,t,null),t}function bnRemainder(e){var t=nbi();return this.divRemTo(e,null,t),t}function bnDivideAndRemainder(e){var t=nbi(),n=nbi();return this.divRemTo(e,t,n),new Array(t,n)}function bnpDMultiply(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()}function bnpDAddOffset(e,t){if(e==0)return;while(this.t<=t)this[this.t++]=0;this[t]+=e;while(this[t]>=this.DV)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}function NullExp(){}function nNop(e){return e}function nMulTo(e,t,n){e.multiplyTo(t,n)}function nSqrTo(e,t){e.squareTo(t)}function bnPow(e){return this.exp(e,new NullExp)}function bnpMultiplyLowerTo(e,t,n){var r=Math.min(this.t+e.t,t);n.s=0,n.t=r;while(r>0)n[--r]=0;var i;for(i=n.t-this.t;r<i;++r)n[r+this.t]=this.am(0,e[r],n,r,0,this.t);for(i=Math.min(e.t,t);r<i;++r)this.am(0,e[r],n,r,0,t-r);n.clamp()}function bnpMultiplyUpperTo(e,t,n){--t;var r=n.t=this.t+e.t-t;n.s=0;while(--r>=0)n[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)n[this.t+r-t]=this.am(t-r,e[r],n,0,0,this.t+r-t);n.clamp(),n.drShiftTo(1,n)}function Barrett(e){this.r2=nbi(),this.q3=nbi(),BigInteger.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}function barrettConvert(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=nbi();return e.copyTo(t),this.reduce(t),t}function barrettRevert(e){return e}function barrettReduce(e){e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);while(e.compareTo(this.r2)<0)e.dAddOffset(1,this.m.t+1);e.subTo(this.r2,e);while(e.compareTo(this.m)>=0)e.subTo(this.m,e)}function barrettSqrTo(e,t){e.squareTo(t),this.reduce(t)}function barrettMulTo(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function bnModPow(e,t){var n=e.bitLength(),r,i=nbv(1),s;if(n<=0)return i;n<18?r=1:n<48?r=3:n<144?r=4:n<768?r=5:r=6,n<8?s=new Classic(t):t.isEven()?s=new Barrett(t):s=new Montgomery(t);var o=new Array,u=3,a=r-1,f=(1<<r)-1;o[1]=s.convert(this);if(r>1){var l=nbi();s.sqrTo(o[1],l);while(u<=f)o[u]=nbi(),s.mulTo(l,o[u-2],o[u]),u+=2}var c=e.t-1,h,p=!0,d=nbi(),v;n=nbits(e[c])-1;while(c>=0){n>=a?h=e[c]>>n-a&f:(h=(e[c]&(1<<n+1)-1)<<a-n,c>0&&(h|=e[c-1]>>this.DB+n-a)),u=r;while((h&1)==0)h>>=1,--u;(n-=u)<0&&(n+=this.DB,--c);if(p)o[h].copyTo(i),p=!1;else{while(u>1)s.sqrTo(i,d),s.sqrTo(d,i),u-=2;u>0?s.sqrTo(i,d):(v=i,i=d,d=v),s.mulTo(d,o[h],i)}while(c>=0&&(e[c]&1<<n)==0)s.sqrTo(i,d),v=i,i=d,d=v,--n<0&&(n=this.DB-1,--c)}return s.revert(i)}function bnGCD(e){var t=this.s<0?this.negate():this.clone(),n=e.s<0?e.negate():e.clone();if(t.compareTo(n)<0){var r=t;t=n,n=r}var i=t.getLowestSetBit(),s=n.getLowestSetBit();if(s<0)return t;i<s&&(s=i),s>0&&(t.rShiftTo(s,t),n.rShiftTo(s,n));while(t.signum()>0)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=n.getLowestSetBit())>0&&n.rShiftTo(i,n),t.compareTo(n)>=0?(t.subTo(n,t),t.rShiftTo(1,t)):(n.subTo(t,n),n.rShiftTo(1,n));return s>0&&n.lShiftTo(s,n),n}function bnpModInt(e){if(e<=0)return 0;var t=this.DV%e,n=this.s<0?e-1:0;if(this.t>0)if(t==0)n=this[0]%e;else for(var r=this.t-1;r>=0;--r)n=(t*n+this[r])%e;return n}function bnModInverse(e){var t=e.isEven();if(this.isEven()&&t||e.signum()==0)return BigInteger.ZERO;var n=e.clone(),r=this.clone(),i=nbv(1),s=nbv(0),o=nbv(0),u=nbv(1);while(n.signum()!=0){while(n.isEven()){n.rShiftTo(1,n);if(t){if(!i.isEven()||!s.isEven())i.addTo(this,i),s.subTo(e,s);i.rShiftTo(1,i)}else s.isEven()||s.subTo(e,s);s.rShiftTo(1,s)}while(r.isEven()){r.rShiftTo(1,r);if(t){if(!o.isEven()||!u.isEven())o.addTo(this,o),u.subTo(e,u);o.rShiftTo(1,o)}else u.isEven()||u.subTo(e,u);u.rShiftTo(1,u)}n.compareTo(r)>=0?(n.subTo(r,n),t&&i.subTo(o,i),s.subTo(u,s)):(r.subTo(n,r),t&&o.subTo(i,o),u.subTo(s,u))}return r.compareTo(BigInteger.ONE)!=0?BigInteger.ZERO:u.compareTo(e)>=0?u.subtract(e):u.signum()<0?(u.addTo(e,u),u.signum()<0?u.add(e):u):u}function bnIsProbablePrime(e){var t,n=this.abs();if(n.t==1&&n[0]<=lowprimes[lowprimes.length-1]){for(t=0;t<lowprimes.length;++t)if(n[0]==lowprimes[t])return!0;return!1}if(n.isEven())return!1;t=1;while(t<lowprimes.length){var r=lowprimes[t],i=t+1;while(i<lowprimes.length&&r<lplim)r*=lowprimes[i++];r=n.modInt(r);while(t<i)if(r%lowprimes[t++]==0)return!1}return n.millerRabin(e)}function bnpMillerRabin(e){var t=this.subtract(BigInteger.ONE),n=t.getLowestSetBit();if(n<=0)return!1;var r=t.shiftRight(n);e=e+1>>1,e>lowprimes.length&&(e=lowprimes.length);var i=nbi();for(var s=0;s<e;++s){i.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var o=i.modPow(r,this);if(o.compareTo(BigInteger.ONE)!=0&&o.compareTo(t)!=0){var u=1;while(u++<n&&o.compareTo(t)!=0){o=o.modPowInt(2,this);if(o.compareTo(BigInteger.ONE)==0)return!1}if(o.compareTo(t)!=0)return!1}}return!0}function pkcs1unpad2(e,t){var n=e.toByteArray(),r=0;while(r<n.length&&n[r]==0)++r;if(n.length-r!=t-1||n[r]!=2)return null;++r;while(n[r]!=0)if(++r>=n.length)return null;var i="";while(++r<n.length){var s=n[r]&255;s<128?i+=String.fromCharCode(s):s>191&&s<224?(i+=String.fromCharCode((s&31)<<6|n[r+1]&63),++r):(i+=String.fromCharCode((s&15)<<12|(n[r+1]&63)<<6|n[r+2]&63),r+=2)}return i}function RSASetPrivate(e,t,n){e!=null&&t!=null&&e.length>0&&t.length>0?(this.n=parseBigInt(e,16),this.e=parseInt(t,16),this.d=parseBigInt(n,16)):console.log("Invalid RSA private key")}function RSASetPrivateEx(e,t,n,r,i,s,o,u){e!=null&&t!=null&&e.length>0&&t.length>0?(this.n=parseBigInt(e,16),this.e=parseInt(t,16),this.d=parseBigInt(n,16),this.p=parseBigInt(r,16),this.q=parseBigInt(i,16),this.dmp1=parseBigInt(s,16),this.dmq1=parseBigInt(o,16),this.coeff=parseBigInt(u,16)):console.log("Invalid RSA private key")}function RSAGenerate(e,t){var n=new SecureRandom,r=e>>1;this.e=parseInt(t,16);var i=new BigInteger(t,16);for(;;){for(;;){this.p=new BigInteger(e-r,1,n);if(this.p.subtract(BigInteger.ONE).gcd(i).compareTo(BigInteger.ONE)==0&&this.p.isProbablePrime(10))break}for(;;){this.q=new BigInteger(r,1,n);if(this.q.subtract(BigInteger.ONE).gcd(i).compareTo(BigInteger.ONE)==0&&this.q.isProbablePrime(10))break}if(this.p.compareTo(this.q)<=0){var s=this.p;this.p=this.q,this.q=s}var o=this.p.subtract(BigInteger.ONE),u=this.q.subtract(BigInteger.ONE),a=o.multiply(u);if(a.gcd(i).compareTo(BigInteger.ONE)==0){this.n=this.p.multiply(this.q),this.d=i.modInverse(a),this.dmp1=this.d.mod(o),this.dmq1=this.d.mod(u),this.coeff=this.q.modInverse(this.p);break}}}function RSADoPrivate(e){if(this.p==null||this.q==null)return e.modPow(this.d,this.n);var t=e.mod(this.p).modPow(this.dmp1,this.p),n=e.mod(this.q).modPow(this.dmq1,this.q);while(t.compareTo(n)<0)t=t.add(this.p);return t.subtract(n).multiply(this.coeff).mod(this.p).multiply(this.q).add(n)}function RSADecrypt(e){var t=parseBigInt(e,16),n=this.doPrivate(t);return n==null?null:pkcs1unpad2(n,this.n.bitLength()+7>>3)}var SUMERU_APP_FW_DEBUG=!1;(function(e,t){var n="NAMESPACE",r="sumeru_AppFW",i={},s=!1,o=function(e,t){Library.net.get({url:e,callback:function(e){var n={};(new Function("exports",e)).call(null,n),t&&t(n)}})},u=function(e){var t,r={};if(Object.create)t=Object.create(r);else{function s(){}s.prototype=r,t=new s,t.__getPrototypeof=function(){return r}}return t.__namespace=n,t.__isSeal=!1,t.__require=function(e,n,r){o(e,function(e){n&&n(e),r&&t.__reg(r,e)})},t.__runTraps=function(n){var r=i[e].traps[n];r&&r.length>0&&r.forEach(function(e){e(t[n])})},t.__reg=function(e,n,i){return i?t[e]=n:r[e]=n,t.__runTraps(e),n},t.__regAsync=function(e,n){return function(i){n?t[e]=i:r[e]=i,t.__runTraps(e)}},t.__load=function(e){return t[e]},t.__loadAsync=function(n,r){var s;i[e].traps[n]?s=i[e].traps[n]:s=i[e].traps[n]=[],s.push(r),t[n]!==undefined&&r(t[n])},t.addSubPackage=function(n){var s=e+"."+n;if(i[e].isSeal)throw'package ["'+e+'"] has sealed.';if(!i[s])return r[n]=u(s),i[s]={spaceObj:t[n],isSeal:!1,traps:{}},r[n];throw'package ["'+s+'"] already exists'},t.__clear=function(){var s;if(i[e].isSeal)return;for(var o in r)s=r[o],s.__namespace===n&&(s.__clear(),Object.getPrototypeOf?r[o]=Object.getPrototypeOf(s):r[o]=s.__getPrototypeof(),t[o]=s);i[e].isSeal=!0},t};s=e[t],e[t]=u(r),i[r]={spaceObj:e[t],isSeal:!1,traps:{}};if(s)for(var a in s)e[t].__reg([a],s[a]);e[t].clear=function(){e[t].__clear(),e[t].seal=undefined,delete e[t].seal,e[t]=Object.getPrototypeOf(e[t])},typeof module!="undefined"&&module.exports&&(module.exports=function(){return e[t]}),SUMERU_APP_FW_DEBUG&&(e.DEBUG_PKG_MAPPING=i,e[t].__reg("SUMERU_APP_FW_DEBUG",!0))})(this,"sumeru");var Run_UnitTest_PKG=function(){var e=sumeru;a=fw.addSubPackage("a"),b=a.addSubPackage("b"),a.__loadAsync("name",function(e){console.log("fire trap...fw.a.name : "+e)}),b.__loadAsync("name",function(e){console.log("fire trap...fw.b.name : "+e)}),fw.a.b.__reg("age",100,!0),b.__loadAsync("age",function(e){console.log("fire trap...fw.b.age : "+e)});var t=a.__regAsync("name"),n=fw.a.b.__regAsync("name");setTimeout(function(){t("package fw.a"),n("package fw.a.b");for(var e=100;e<110;e++)n("name _ "+e);console.log(a.b.age),console.log(fw.a.b.age),console.log("async done...")},1e3),fw.clear(),console.log(fw.a.b.age===undefined),console.log(e.a.b.age===100),console.log(fw.addSubPackage===undefined),console.log(fw.a.addSubPackage===undefined),console.log(fw.a.b.addSubPackage===undefined),console.log(a.addSubPackage===undefined),console.log(b.addSubPackage===undefined)},runnable=function(e){function u(e){s(e).forEach(function(t){this[t]=e[t]},this)}var t=e.addSubPackage("utils"),n=Array.prototype.splice,r=Array.prototype.concat,i=function(e){return n.apply(e,n.call(arguments,1))},s=Object.keys,o=function(e){return r.apply(i(e,0),i(arguments,1))},a=t.__reg("cpp",function(e){var t=i(arguments,1);return t.forEach(u,e),e}),f=t.__reg("extendFrom",function(e,t){var n=null,r=function(){};return Object.create?n=Object.create(e):(r.prototype=e,n=new r),a(n,t)}),l=t.__reg("getProxy",function(e,t){var n={};return t.forEach(function(e){var t=this;n[e]=function(){if(t[e]instanceof Function)return t[e].apply(t,arguments);throw e+" is not a function"}},e),n}),c=t.__reg("cleanObj",function(e,t){var n=Object.keys(e);n.forEach(function(e){try{e!="isDestroy"&&(t&&t(this[e]),typeof this[e]=="array"&&(this[e].length=0),delete this[e])}catch(n){}},e)}),h=t.__reg("encodeURIComponentFull",function(e){var t=encodeURIComponent(e);return t=t.replace(/!/g,"%21"),t=t.replace(/\*/g,"%2A"),t=t.replace(/'/g,"%27"),t=t.replace(/\(/g,"%28"),t=t.replace(/\)/g,"%29"),t=t.replace(/\./g,"%2E"),t=t.replace(/\-/g,"%2D"),t=t.replace(/\_/g,"%5F"),t=t.replace(/\~/g,"%7E"),t}),p=t.__reg("uriParamToMap",function(e){var t={};if(!e)return t;var n=e.split("&");return n.forEach(function(e){var t=e.split("=");t[0]&&(this[t[0]]=decodeURIComponent(t[1]))},t),t}),d=function(e,t){var n=[];return e.forEach(function(e){n.push(h(e))}),n.join(t)},v=t.__reg("mapToUriParam",function(e){var t=[],n=null;return typeof e!="object"||Array.isArray(e)?"":(n=Object.keys(e),n.forEach(function(n){var r=e[n];switch(typeof r){case"string":case"number":case"boolean":t.push(n+"="+h(r));case"object":Array.isArray(r)&&t.push(n+"="+d(r));default:return}}),t.join("&"))}),m=t.__reg("randomInt",function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}),g="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ",y=g.length-1;t.__reg("randomStr",function(t){var n="";for(var r=0;r<t;r++)n+=g[m(0,y)];return n});var b=t.__reg("parseJSON",function(e){return(new Function("window","document","sumeru","XMLHttpRequest","return "+e+";")).call({},undefined,undefined,undefined,undefined)}),w=t.__reg("isSimpleType",function(e){switch(typeof e){case"string":case"number":case"boolean":return!0}return!1}),E=t.__reg("setStyles",function(t,n){var r=t.style,i="",s=/^(left|top|bottom|right|width|height)$/i;for(var o in n)i=n[o],typeof n[o]=="number"&&s.test(o)&&(i+="px"),r[o]=i;return t});e.utils.__reg("chain",function(e,t){if(!Array.isArray(e))return!1;var n=e[0].length;if(!e.every(function(e){return e instanceof Function&&e.length===n}))return!1;var r=0,s=null;return s=function(){var n=e[r++];if(n!==undefined){var u=o(arguments,s);n.apply(this,u)}else t.apply(this,i(arguments,0))},s}),e.utils.__reg("getTimeStamp",function(){return(new Date).valueOf()});var S={};e.__random=function(e){e=e||10;var t="qwertyuiopasdfghjklzxcvbnm1234567890",n=t.length,r=e,i="";while(r--)i+=t.charAt(Math.floor(Math.random()*n));return S[i]?random(e):(S[i]=1,i)}};typeof module!="undefined"&&module.exports?module.exports=runnable:runnable(sumeru),function(e){e.event=e.event||{},e.event.domReady=function(e){/complete|loaded|interactive/.test(document.readyState)?e():document.addEventListener("DOMContentLoaded",function(){e()},!1)},e.event.onload=function(e){/complete/.test(document.readyState)?e():window.onload=function(){e()}},e.event.mapEvent=function(e,t){var n=document.querySelector(e);if(!n)return;for(var r in t){if(typeof t[r]!="function")continue;r=r.split(","),r.forEach(function(e){n.addEventListener(e.trim(),t[r])})}}}(sumeru);var dbits,canary=0xdeadbeefcafe,j_lm=(canary&16777215)==15715070;BigInteger.prototype.am=am3,dbits=28,BigInteger.prototype.DB=dbits,BigInteger.prototype.DM=(1<<dbits)-1,BigInteger.prototype.DV=1<<dbits;var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP),BigInteger.prototype.F1=BI_FP-dbits,BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz",BI_RC=new Array,rr,vv;rr="0".charCodeAt(0);for(vv=0;vv<=9;++vv)BI_RC[rr++]=vv;rr="a".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;rr="A".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;Classic.prototype.convert=cConvert,Classic.prototype.revert=cRevert,Classic.prototype.reduce=cReduce,Classic.prototype.mulTo=cMulTo,Classic.prototype.sqrTo=cSqrTo,Montgomery.prototype.convert=montConvert,Montgomery.prototype.revert=montRevert,Montgomery.prototype.reduce=montReduce,Montgomery.prototype.mulTo=montMulTo,Montgomery.prototype.sqrTo=montSqrTo,BigInteger.prototype.copyTo=bnpCopyTo,BigInteger.prototype.fromInt=bnpFromInt,BigInteger.prototype.fromString=bnpFromString,BigInteger.prototype.clamp=bnpClamp,BigInteger.prototype.dlShiftTo=bnpDLShiftTo,BigInteger.prototype.drShiftTo=bnpDRShiftTo,BigInteger.prototype.lShiftTo=bnpLShiftTo,BigInteger.prototype.rShiftTo=bnpRShiftTo,BigInteger.prototype.subTo=bnpSubTo,BigInteger.prototype.multiplyTo=bnpMultiplyTo,BigInteger.prototype.squareTo=bnpSquareTo,BigInteger.prototype.divRemTo=bnpDivRemTo,BigInteger.prototype.invDigit=bnpInvDigit,BigInteger.prototype.isEven=bnpIsEven,BigInteger.prototype.exp=bnpExp,BigInteger.prototype.toString=bnToString,BigInteger.prototype.negate=bnNegate,BigInteger.prototype.abs=bnAbs,BigInteger.prototype.compareTo=bnCompareTo,BigInteger.prototype.bitLength=bnBitLength,BigInteger.prototype.mod=bnMod,BigInteger.prototype.modPowInt=bnModPowInt,BigInteger.ZERO=nbv(0),BigInteger.ONE=nbv(1),Arcfour.prototype.init=ARC4init,Arcfour.prototype.next=ARC4next;var rng_psize=256,rng_state,rng_pool,rng_pptr;if(rng_pool==null){rng_pool=new Array,rng_pptr=0;var t;while(rng_pptr<rng_psize)t=Math.floor(65536*Math.random()),rng_pool[rng_pptr++]=t>>>8,rng_pool[rng_pptr++]=t&255;rng_pptr=0,rng_seed_time()}SecureRandom.prototype.nextBytes=rng_get_bytes,RSAKey.prototype.doPublic=RSADoPublic,RSAKey.prototype.setPublic=RSASetPublic,RSAKey.prototype.encrypt=RSAEncrypt,NullExp.prototype.convert=nNop,NullExp.prototype.revert=nNop,NullExp.prototype.mulTo=nMulTo,NullExp.prototype.sqrTo=nSqrTo,Barrett.prototype.convert=barrettConvert,Barrett.prototype.revert=barrettRevert,Barrett.prototype.reduce=barrettReduce,Barrett.prototype.mulTo=barrettMulTo,Barrett.prototype.sqrTo=barrettSqrTo;var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],lplim=(1<<26)/lowprimes[lowprimes.length-1];BigInteger.prototype.chunkSize=bnpChunkSize,BigInteger.prototype.toRadix=bnpToRadix,BigInteger.prototype.fromRadix=bnpFromRadix,BigInteger.prototype.fromNumber=bnpFromNumber,BigInteger.prototype.bitwiseTo=bnpBitwiseTo,BigInteger.prototype.changeBit=bnpChangeBit,BigInteger.prototype.addTo=bnpAddTo,BigInteger.prototype.dMultiply=bnpDMultiply,BigInteger.prototype.dAddOffset=bnpDAddOffset,BigInteger.prototype.multiplyLowerTo=bnpMultiplyLowerTo,BigInteger.prototype.multiplyUpperTo=bnpMultiplyUpperTo,BigInteger.prototype.modInt=bnpModInt,BigInteger.prototype.millerRabin=bnpMillerRabin,BigInteger.prototype.clone=bnClone,BigInteger.prototype.intValue=bnIntValue,BigInteger.prototype.byteValue=bnByteValue,BigInteger.prototype.shortValue=bnShortValue,BigInteger.prototype.signum=bnSigNum,BigInteger.prototype.toByteArray=bnToByteArray,BigInteger.prototype.equals=bnEquals,BigInteger.prototype.min=bnMin,BigInteger.prototype.max=bnMax,BigInteger.prototype.and=bnAnd,BigInteger.prototype.or=bnOr,BigInteger.prototype.xor=bnXor,BigInteger.prototype.andNot=bnAndNot,BigInteger.prototype.not=bnNot,BigInteger.prototype.shiftLeft=bnShiftLeft,BigInteger.prototype.shiftRight=bnShiftRight,BigInteger.prototype.getLowestSetBit=bnGetLowestSetBit,BigInteger.prototype.bitCount=bnBitCount,BigInteger.prototype.testBit=bnTestBit,BigInteger.prototype.setBit=bnSetBit,BigInteger.prototype.clearBit=bnClearBit,BigInteger.prototype.flipBit=bnFlipBit,BigInteger.prototype.add=bnAdd,BigInteger.prototype.subtract=bnSubtract,BigInteger.prototype.multiply=bnMultiply,BigInteger.prototype.divide=bnDivide,BigInteger.prototype.remainder=bnRemainder,BigInteger.prototype.divideAndRemainder=bnDivideAndRemainder,BigInteger.prototype.modPow=bnModPow,BigInteger.prototype.modInverse=bnModInverse,BigInteger.prototype.pow=bnPow,BigInteger.prototype.gcd=bnGCD,BigInteger.prototype.isProbablePrime=bnIsProbablePrime,BigInteger.prototype.square=bnSquare,RSAKey.prototype.doPrivate=RSADoPrivate,RSAKey.prototype.setPrivate=RSASetPrivate,RSAKey.prototype.setPrivateEx=RSASetPrivateEx,RSAKey.prototype.generate=RSAGenerate,RSAKey.prototype.decrypt=RSADecrypt;var runnable=function(e,t,n){var r={e:"3"};e.addSubPackage("myrsa");var i=function(e,t){var n=new RSAKey,i="";n.setPublic(t,r.e);var s=n.encrypt(e);return s&&(s=linebrk(s,64)),s},s=function(e){var t=new RSAKey;if(e.length==0)return e;t.setPrivateEx(r.n,r.e,r.d,r.p,r.q,r.dmp1,r.dmq1,r.coeff);var n=t.decrypt(e);return n&&(n=n),n},o=function(e,t){if(typeof e!="string"||!c())return console.log("RSA encrypt canceled",e),e;if(!r.pk2&&typeof t=="undefined")return console.log("pk2 没传入，rsa加密不启用"),e;t=typeof t=="string"?t:r.pk2;var n=[];for(var s=0,o=e.length;s<o;s+=5)n.push(i(e.substr(s,5),t));return n.join("|")},u=function(e){if(typeof e!="string"||!c())return console.log("RSA decrypt canceled",e),e;var t="",n=e.split("|");for(var r=0,i=n.length;r<i;r++)t+=s(n[r]);return t},a=function(e){var t=new RSAKey;return r.bits=typeof e=="number"?e:128,t.generate(parseInt(r.bits),r.e),r.n=linebrk(t.n.toString(16),64),r.d=linebrk(t.d.toString(16),64),r.p=linebrk(t.p.toString(16),64),r.q=linebrk(t.q.toString(16),64),r.dmp1=linebrk(t.dmp1.toString(16),64),r.dmq1=linebrk(t.dmq1.toString(16),64),r.coeff=linebrk(t.coeff.toString(16),64),r},f=function(){return r.n},l=function(e){r.pk2=e},c=function(){return e.config.get("rsa_enable")},h=function(){return r.pk2};typeof t!="undefined"&&a(),e.myrsa.__reg("encrypt",o,"private"),e.myrsa.__reg("decrypt",u,"private"),e.myrsa.__reg("generate",a,"private"),e.myrsa.__reg("getPk",f,"private"),e.myrsa.__reg("setPk2",l,"private"),e.myrsa.__reg("getPk2",h,"private")};typeof module!="undefined"&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){if(e.netMessage){console.log("netMessage is exist.");return}var t=e.addSubPackage("netMessage"),n={0:"onLocalMessage",100:"onError",200:"onMessage",300:"onGlobalError",400:"onGlobalMessage",500:"onLogMessage"},r=Array.prototype.splice,i=e.IS_SUMERU_SERVER,s=Object.create(n),o=null,u=null,a=null,f=[],l=[],c=[],h=[],p=function(e){var t=[];return e.forEach(function(e){t.push(e.filter)}),t},d=function(e){var t=sumeru.utils.parseJSON(e);return t.number===undefined||t.type===undefined||t.content===undefined?!1:t},v=function(t,n,r){var i={number:n+"",type:null,target:r+"",content:null};return e.utils.isSimpleType(t)?(i.type="simple",i.content=t):(i.type="json",i.content=n!=="0"?JSON.stringify(t):t),i},m=function(e){var t=null;if(e.number==="0")return w(e);i===!0&&e.number==="600"?t=a:t=u;if(t===null)throw"no output";return Array.prototype.splice.call(arguments,0,1,JSON.stringify(e)),t.apply({},arguments)},g=function(t){return function(n,i){var s=v(n,t,i),o=r.call(arguments,0),u=o[o.length-2];if(h.length!==0){var a=e.utils.chain(h,function(e){o.splice(0,2,e),m.apply({},o)});a(s,u instanceof Function?u:function(){})}else o.splice(0,2,s),m.apply({},o)}},y=function(){var e;for(var n in s)e=s[n],e="send"+e.substr(2),t.__reg(e,g(n))},b=function(e,t){return e.order<t.order};t.__reg("addInFilter",function(e,t){var n=e.length==2?function(t,n,r){var i=null;try{i=e(t,n)}catch(s){console.log(s);return}r(i,n)}:e;f.push({filter:n,order:t===undefined?Number.MIN_VALUE:t}),f.sort(b),l=p(f)},!1),t.__reg("addOutFilter",function(e,t){var n=e.length==1?function(t,n,r){var i=null;try{i=e(t)}catch(s){n(s)}r(i,n)}:e;c.push({filter:n,order:t===undefined?Number.MIN_VALUE:t}),c.sort(b),h=p(c)},!1),t.__reg("onData",function(t,n){var r=d(t);if(i&&e.SUMERU_APP_FW_DEBUG===!1)try{w(r,n)}catch(s){console.error(s)}else w(r,n)},!1),t.__reg("addACL",function(e,t){var r=t;t.indexOf("on")!==0&&(r="on"+t.substr(0,1).toUpperCase()+t.substr(1)),n[e]===undefined&&(s[e]=r,y())},!1),t.__reg("setOutput",function(e){if(!(e instanceof Function))throw"__output is not a function.";u=e},!1),i&&(n[600]="onS2SMessage",t.__reg("setOutputToServer",function(e){if(!(e instanceof Function))throw"__output is not a function.";a=e})),t.__reg("setReceiver",function(e){o=o||{};var t,n,r,i,u;for(var a in s){t=s[a],u=e[t];if(u===undefined)continue;if(u instanceof Function)n="",r=u;else{n=u.target||"";if(!(r=u.handle)instanceof Function)continue}i=o[t]=o[t]||{},Array.isArray(n)?n.forEach(function(e){this[e]=r},i):i[n]=r}Object.keys(s).forEach(function(e){this[s[e]]instanceof Function&&(o[s[e]]=this[s[e]])},e),y()},!1);var w=function(t,n){var r=null,i=null,u=null,a=null;if(o===null)throw"no receiver";if(t.number===undefined)return!1;if((r=s[t.number])===undefined)return console.log("unidentifiable message number"),!1;if(o[r]===undefined)return console.log("no receiver handle"),!1;i=o[r][t.target||""];if(i===undefined&&t.target!==""){i=o[r][""];if(i===undefined)return!1}var f=function(){t.type=="json"&&t.number!=="0"?a=e.utils.parseJSON(t.content):a=t.content,u=i(a,t.target,n);if(u===!1&&t.number=="100")return t.number="300",w(t,n);if(u===!1&&t.number=="200")return t.number="400",w(t,n)};if(l.length!==0){var c=e.utils.chain(l,f);c(t,n)}else f()};typeof module!="undefined"&&module.exports&&(module.exports=function(){return t}),console.log("runing [NetMessage] in "+(e.IS_SUMERU_SERVER?"server":"client"))};typeof module!="undefined"&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){(function(e){var t=e.addSubPackage("sense");t.__reg("runSenseContext",function(e){t.__reg("_senseInspector",function(t,n){t.addObserver(n,e)},!0),e(),t.__reg("_senseInspector",function(){},!0)});var n={get:function(e){return t._senseInspector&&t._senseInspector(this,e),this.container[e]},set:function(e,t){this.container[e]=t;if(this.observer.length!=0)for(var n=0,r=this.observer.length;n<r;n++){if(this.observer[n].key!=e||this.toBeCommited.some(function(e){return e(this.observer[n])},this))continue;this.toBeCommited.push(function(t,n){return function(r){if(arguments.length!==0)return r==n;console.log("exec customCloser",n.customClosure.length),n.customClosure.call(t,e)}}(this,this.observer[n]))}},commit:function(){var t=this.toBeCommited;if(t.length===0)return!0;var n=[];e.controller.__reg("_tapped_blocks",n,!0);for(var r=0,i=t.length;r<i;r++)t[r]();e.controller.__load("reactiveRender")(n),t.length=0},addObserver:function(e,t){for(var n=0,r=this.observer.length;n<r;n++)if(this.observer[n].key===e&&this.observer[n].customClosure==t)return;this.observer.push({key:e,customClosure:t})},removeObserver:function(e){for(var t=0,n=this.observer.length;t<n;t++)if(this.observer[t].customClosure===e){this.observer.splice(t,1);return}},cleanObserver:function(){this.observer.length=0,this.toBeCommited.length=0}};t.__reg("extend",function(t,r){var i=function(){return function(){this.toBeCommited=[],this.observer=[],this.container={},t.apply(this,arguments)}}(t);return i.prototype=e.utils.cpp(r||t.prototype,n),i})})(e)};typeof module!="undefined"&&module.exports?module.exports=runnable:runnable(sumeru),function(e){var t=e.addSubPackage("session"),n={},r={},i=e.utils.parseJSON,s=function(e){return JSON.parse(JSON.stringify(resumeObj))},o=e.utils.isSimpleType,u,a,f,l=e.sense.extend(function(e){this.__identifier=e,this.__hashKey=[],this.__snapshot={},this.__getId=function(){return e}});u=l.prototype.get,a=l.prototype.set,f=l.prototype.commit,l.prototype.get=function(e){return function(){return e.apply(this,arguments)}}(u),l.prototype.set=function(e){return function(t,n,r){var i=r;r&&this.__hashKey.push(t);if((i||this.__hashKey.indexOf(t)!=-1)&&!o(n))throw"data type error";return e.call(this,t,n)}}(a),l.prototype.setIfNull=function(e){return function(t,n,r){if(this.container.hasOwnProperty(t))return;r&&this.__hashKey.indexOf(t)==-1&&this.__hashKey.push(t);if((r||this.__hashKey.indexOf(t)!=-1)&&!o(n))throw"data type error";return e.call(this,t,n)}}(a),l.prototype.commit=function(e){return function(){var r={},i=e.apply(this,arguments);return this.__hashKey.forEach(function(e){r[e]=this.container[e]},this),n[this.__identifier]=JSON.stringify(r),n[this.__identifier]=="{}"?delete n[this.__identifier]:this.__snapshot[n[this.__identifier]]=JSON.stringify(this.container),t.serialize(),i}}(f),l.prototype.__unserialize=function(){var e=!1,t=this.__identifier,r=n[t],s,o;if(this.__snapshot[r]&&(s=i(this.__snapshot[r])))this.container=s,e=!0;else if(r!==""&&r!=null){for(var u in o=i(r))this.container[u]=o[u],this.__hashKey.indexOf(u)==-1&&this.__hashKey.push(u);e=!0}return e},t.__reg("create",function(e){var t=null;return(t=r[e])?t:(t=r[e]=new l(e),t.__unserialize(),t)}),t.__reg("destroy",function(t){var i=typeof t=="string"?r[t]:t;t=i.__identifier,e.utils.cleanObj(i),r[t]=undefined,n[t]=undefined,delete r[t],delete n[t]}),t.__reg("serialize",function(){var t=JSON.stringify(n);e.router.joinSessionToHash(t),SUMERU_APP_FW_DEBUG&&console.log("call serialize, serializeDat : ",t)},!0),t.__reg("setResume",function(e){n=e&&i("{"+e+"}")||{};for(var t in r)r[t].__unserialize()&&r[t].commit();SUMERU_APP_FW_DEBUG&&console.log("serialize_pool",n)},!0)}(sumeru);var ObjectId=function(){var e=0,t=Math.floor(Math.random()*32767),n=Math.floor(Math.random()*16777216);if(typeof localStorage!="undefined"){var r=parseInt(localStorage.mongoMachineId);r>=0&&r<=16777215&&(n=Math.floor(localStorage.mongoMachineId)),localStorage.mongoMachineId=n,document.cookie="mongoMachineId="+n+";expires=Tue, 19 Jan 2038 05:00:00 GMT"}else{var i=document.cookie.split("; ");for(var s in i){var o=i[s].split("=");if(o[0]=="mongoMachineId"&&o[1]>=0&&o[1]<=16777215){n=o[1];break}}document.cookie="mongoMachineId="+n+";expires=Tue, 19 Jan 2038 05:00:00 GMT"}return function(){if(!(this instanceof ObjectId))return(new ObjectId(arguments[0],arguments[1],arguments[2],arguments[3])).toString();typeof arguments[0]=="object"?(this.timestamp=arguments[0].timestamp,this.machine=arguments[0].machine,this.pid=arguments[0].pid,this.increment=arguments[0].increment):typeof arguments[0]=="string"&&arguments[0].length==24?(this.timestamp=Number("0x"+arguments[0].substr(0,8)),this.machine=Number("0x"+arguments[0].substr(8,6)),this.pid=Number("0x"+arguments[0].substr(14,4)),this.increment=Number("0x"+arguments[0].substr(18,6))):arguments.length==4&&arguments[0]!=null?(this.timestamp=arguments[0],this.machine=arguments[1],this.pid=arguments[2],this.increment=arguments[3]):(this.timestamp=Math.floor((new Date).valueOf()/1e3),this.machine=n,this.pid=t,e>16777215&&(e=0),this.increment=e++)}}();ObjectId.prototype.getDate=function(){return new Date(this.timestamp*1e3)},ObjectId.prototype.toString=function(){var e=this.timestamp.toString(16),t=this.machine.toString(16),n=this.pid.toString(16),r=this.increment.toString(16);return"00000000".substr(0,6-e.length)+e+"000000".substr(0,6-t.length)+t+"0000".substr(0,4-n.length)+n+"000000".substr(0,6-r.length)+r},sumeru.__reg("__ObjectId",ObjectId,!0),delete ObjectID,App=typeof App!="undefined"?App:{};var runnable=function(e){(function(e){var t=e.sense.extend(function(){}),n=function(){var e=function(){this.configMap={}},n=new t,r=function(){};return r.prototype=n,e.prototype=new r,e.prototype.set=function(){this.define.apply(this,arguments)},e.prototype.get=function(e){return n.get(e),this.configMap[e]},e.prototype.define=function(){var e;if(arguments.length==1)e=arguments[0];else{if(arguments.length!=2)throw new Error("config define error");e={},e[arguments[0]]=arguments[1]}for(var t in e)e.hasOwnProperty(t)&&(n.set(t,e[t]),this.configMap[t]=e[t])},new e},r=function(t){if(typeof t=="undefined")return;var i=n(),s=function(){i.set.apply(i,arguments)};return s.defineModule=r,s.config=function(){i.set.apply(i,arguments)},s.get=function(){return i.get.apply(i,arguments)},s.set=function(e,t){i.set.apply(i,arguments)},s.commit=function(){i.commit.apply(i,arguments),typeof module!="undefined"&&typeof exports!="undefined"?e.pushUpdateOfConfig(i.configMap):e.netMessage.sendMessage(i.configMap,"config_push",function(e){},function(){})},this[t]=s,s};r.call(e,"defineConfig"),e.config=e.defineConfig})(e)};typeof module!="undefined"&&module.exports?module.exports=runnable:runnable(sumeru),function(e){e.addSubPackage("transition");var t="__viewBlock__",n=function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},r=function(e){return document.getElementById(e)},i=function(e){return document.createElement(e)},s=function(e,t){if(typeof t=="string"&&o(e,t))return;var r=n(e.className).replace(/\s+/g," ").split(" ");r=r.concat(t),e.className=r.join(" ")},o=function(e,t){var n=new RegExp("( |^)"+t+"( |$)",["i"]);if(e.className.match(n))return!0},u=function(e,t){var r=n(e.className).replace(/\s+/g," ").split(" ");if(t instanceof Array)for(var i=0,s=r.length;i<s;i++)t.indexOf(r[i])>-1&&r.splice(i,1);else if(t.search("^")===0){var o=new RegExp(t,"");for(var i=0,s=r.length;i<s;i++)r[i]&&r[i].match(o)&&r.splice(i,1)}else for(var i=0,s=r.length;i<s;i++)r[i]===t&&r.splice(i,1);e.className=r.join(" ")},a=function(e,t,r){var i=n(e.className).replace(/\s+/g," ").split(" ");if(r instanceof Array)for(var s=0,o=i.length;s<o;s++)r.indexOf(i[s])>-1&&i.splice(s,1);else for(var s=0,o=i.length;s<o;s++)i[s]===r&&i.splice(s,1);i=i.concat(t),e.className=i.join(" ")},f=function(e,t,r){var i=n(e.className).replace(/\s+/g," ").split(" "),s=i.indexOf(t),o=r?i.indexOf(r):-1;s>=0?(i.splice(s,1),r&&i.push(r)):(i.push(t),o>=0&&i.splice(o,1)),e.className=i.join(" ")},l=function(e){e.style.width="100%"},c={push:[1,1,1,1],rotate:[0,1,0,1],fade:[0,0,0,0,2],shake:[0,1,0,1],none:[0,0,0,0,2]},h={show:"_g_{$}_sw",standby:"_g_{$}_sb",hide:"_g_{$}_hd"},p=["top","right","bottom","left",""],d={push:{up:"Up",down:"Down",left:"Left",right:"Right"},bounce:{"":"",up:"Up",down:"Down",left:"Left",right:"Right"},fade:{"":"",up:"Up",down:"Down",left:"Left",right:"Right"},rotate:{"":"",up:"UpLeft",down:"DownRight",left:"DownLeft",right:"UpRight"},flip:{x:"X",y:"Y"},expand:{x:"X",y:"Y","":""},none:{none:""},1:1},v={push:["_fw_pushIn","_fw_pushOut"],bounce:["_fw_bounceIn","_fw_bounceOut"],fade:["_fw_fadeIn","_fw_fadeOut"],rotate:["_fw_rotateIn","_fw_rotateOut"],flip:["_fw_flipIn","_fw_flipOut"],expand:["_fw_expand","_fw_collapse"],none:["_fw_none","_fw_hide"],1:1},m=null,g=function(e,t){var n=t[0]+(p[t[1]].length>0?"_"+p[t[1]]:"");return h[e].replace("{$}",n)},y={showScene:{type:null,dom:null,anim:null,classname:null},hideScene:{type:null,dom:null,anim:null,classname:null}},b=!0,w=function(){m=document.createElement("div"),m.className="warp",document.body.appendChild(m),b=!1,l(m)},E=function(e,t){var n=i("div"),r=i("div"),s=i("div"),o=i("div");return n.style.webkitPerspective=1e3,r.className="animated _g_flip_card",s.className="_g_flip_front",o.className="_g_flip_back",s.appendChild(e),o.appendChild(t),r.appendChild(o),r.appendChild(s),n.appendChild(r),n},S=function(e){var t={up:0,right:1,down:2,left:3,z:4,none:4};e.anim&&c[e.anim[0]][t[e.anim[1]]]<=0&&(e.anim=["push",1]),e.transitionOut&&c[e.transitionOut[0]][t[e.transitionOut[1]]]<=0&&(e.transitionOut=["push",1]),e.type||(e.type="common"),e.anim&&typeof e.anim[1]!="undefined"&&typeof t[e.anim[1]]!="undefined"&&(e.anim[1]=t[e.anim[1]]);if(!e.anim||typeof c[e.anim[0]]=="undefined"||typeof c[e.anim[0]][e.anim[1]]=="undefined"||c[e.anim[0]][e.anim[1]]<=0)e.anim=["push",1];e.transitionOut&&(typeof e.transitionOut!="object"?e.anim[1]=(e.anim[1]+2)%4:(e.transitionOut[1]=(e.transitionOut[1]+2)%4,e.anim=e.transitionOut))},x=function(e){b&&w(),S(e);var n=y.showScene,r=y.hideScene,i=n&&n.anim?n.anim[0]!=e.anim[0]||n.anim[1]!=e.anim[1]:!0;switch(e.type){case"common":e.dom instanceof Array&&(e.dom_front=e.dom[0],e.dom_back=e.dom[1]);if(e.cloneDom)n.dom.parentNode.appendChild(e.cloneDom),n.dom.addEventListener("webkitTransitionEnd",function(){e.cloneDom&&e.cloneDom.parentNode&&(e.cloneDom.parentNode.removeChild(e.cloneDom),delete e.cloneDom)},!1),n.dom=e.cloneDom;else{if(n.dom==e.dom)return!1;delete e.cloneDom}if(e.dom instanceof Array&&(n.dom==e.dom_front||n.dom==e.dom_back)||(typeof n.dom_front!="undefined"?n.dom_front==e.dom_front||n.dom_front==e.dom_back||n.dom_front==e.dom:!1)||(typeof n.dom_back!="undefined"?n.dom_back==e.dom_front||n.dom_back==e.dom_back||n.dom_back==e.dom:!1))return!1;e.dom instanceof Array&&(e.dom=E(e.dom[0],e.dom[1]));if(r&&r.dom)if(r.dom_front){var o=0;r.dom_front!=e.dom&&r.dom_front!=e.dom_front&&r.dom_front!=e.dom_back&&(r.dom_front.className=r.front_classname?"hide "+r.front_classname:"hide",m.appendChild(r.dom_front),o++),r.dom_back!=e.dom&&r.dom_back!=e.dom_front&&r.dom_back!=e.dom_back&&(r.dom_back.className=r.back_classname?"hide "+r.back_classname:"hide",m.appendChild(r.dom_back),o++),m.removeChild(r.dom)}else r.dom!=e.dom&&r.dom!=e.dom_front&&r.dom!=e.dom_back&&(r.dom.className=r.classname?"hide "+r.classname:"hide");e.dom_front?(e.front_classname=e.dom_front.className.replace(/(_g_[\S]*)|(transi)|(hide)|(animated)/g,"").replace(new RegExp(t,"g"),"").replace(/(^\s*)|(\s*$)/g,"")+t,e.dom_front.className=e.front_classname,e.back_classname=e.dom_back.className.replace(/(_g_[\S]*)|(transi)|(hide)|(animated)/g,"").replace(new RegExp(t,"g"),"").replace(/(^\s*)|(\s*$)/g,"")+t,e.dom_back.className=e.back_classname):(e.classname=e.dom.className.replace(/(_g_[\S]*)|(transi)|(hide)|(animated)/g,"").replace(new RegExp(t,"g"),"").replace(/(^\s*)|(\s*$)/g,"")+t,e.dom.className=e.classname?"hide "+e.classname:"hide");var l=e.dom,h=r.dom?r.dom:!1,p=n.dom?n.dom:!1;i&&p&&(p.className=n.classname?t+" "+n.classname:t,s(p,g("show",e.anim,e.anim_dir))),s(l,[g("standby",e.anim,e.anim_dir),t]),m!=l.parentElement&&m.appendChild(l),u(l,"hide");var d=i?10:1;setTimeout(function(){c[e.anim[0]][e.anim[1]]==1&&(p&&s(p,"transi"),s(l,"transi")),p&&a(p,g("hide",e.anim,e.anim_dir),g("show",e.anim,e.anim_dir)),a(l,g("show",e.anim,e.anim_dir),g("standby",e.anim,e.anim_dir)),c[e.anim[0]][e.anim[1]]==2&&(p&&s(p,"animated"),s(l,"animated"))},d),y.showScene.anim&&(y.showScene.anim=e.anim),y.hideScene=y.showScene,y.showScene=e,y.hideScene.callback&&y.hideScene.callback.hide&&y.hideScene.callback.hide(),e.callback&&e.callback.load&&e.callback.load();break;case"flipleft":u(n.dom.firstChild,["_g_flip_card_right","_g_flip_card_right_def"]),f(n.dom.firstChild,"_g_flip_card_left","_g_flip_card_left_def");break;case"flipright":u(n.dom.firstChild,["_g_flip_card_left","_g_flip_card_left_def"]),f(n.dom.firstChild,"_g_flip_card_right","_g_flip_card_right_def")}return!0},T=function(e,t){var n=e.dom;e.anim||(e.anim=["push","down"]),t?(d[e.anim[0]]&&typeof d[e.anim[0]][e.anim[1]]!="undefined"&&(u(n,"^_fw_"),s(n,v[e.anim[0]][1]+d[e.anim[0]][e.anim[1]])),n.style.display="",n.addEventListener("webkitAnimationEnd",N,!1)):(s(n,"animated"),d[e.anim[0]]&&typeof d[e.anim[0]][e.anim[1]]!="undefined"&&(u(n,"^_fw_"),s(n,v[e.anim[0]][0]+d[e.anim[0]][e.anim[1]])),n.style.display="block",n.removeEventListener("webkitAnimationEnd",N,!1))},N=function(){this.style.display="none"};e.transition.__reg("_run",x,"private"),e.transition.__reg("_subrun",T,"private")}(sumeru),function(e){e.addSubPackage("pubsub");var t={},n={a:1},r=[],i=function(){},s=Array.prototype.pop,o=Array.prototype.slice;i.prototype={subscribe:function(i,u){var a=n[i.replace(/@@_sumeru_@@_page_([\d]+)/,"")],f=a.modelname,l=a.plainstruct;if(typeof f=="undefined")throw"publish "+i+" NOT FOUND";f="Model."+f;var c=null;typeof this=="object"&&typeof this.isWaiting!="undefined"&&(c=this,c.wait());var h=e.collection.create({modelName:f});h.pubName=i;var p=s.call(arguments),d=o.call(arguments,1);e.netMessage.sendMessage({name:i,args:d},"subscribe",function(e){console.log("Err : subscribe "+e)},function(){console.log("send subscribe "+i)}),t[i]||(r.push(i),t[i]={modelName:f,plainStruct:l,args:d,topPriority:!1,stub:[]});var v=this.__UK,m=Function.toString.call(p),g=this.subscribe.caller;t[i].stub=t[i].stub.filter(function(e){return e.id==v&&e.sourceCustomClosure==g&&e.callbackStr==m?!1:!0});var y=function(){p(arguments[0],arguments[1]),c&&c.start()};return t[i].stub.push({id:v,sourceCustomClosure:g,collection:h,callback:y,callbackStr:m,env:this}),h},subscribeByPage:function(e,t,n){var r={pagesize:10,page:1,uniqueField:"time"};t=Library.objUtils.extend(r,t);var i=arguments;i[0]=e+"@@_sumeru_@@_page_"+t.page;var s=this.subscribe.apply(this,i);return s},prioritySubscribe:function(e,n){var r=arguments,i=this.subscribe.apply(this,r);return t[e].topPriority=!0,i}};var u=function(){a(f)},a=function(n){cbHandler=Library.asyncCallbackHandler.create(function(){n(),e.pubsub.__reg("_priorityAsyncHandler",undefined,!0)}),e.pubsub.__reg("_priorityAsyncHandler",cbHandler,!0),cbHandler.add();for(var i=0,s=r.length;i<s;i++){var o=r[i];if(o=="auth-init")continue;if(!(o in t))continue;if(t[o].topPriority===!1)continue;cbHandler.add(),e.netMessage.sendMessage({name:o,args:t[o].args},"subscribe",function(e){console.log("Err : redoPrioritySubscribe")},function(){console.log("sending redo priority subscribe "+o)})}cbHandler.enableCallback(),cbHandler.decrease()},f=function(){for(var n=0,i=r.length;n<i;n++){var s=r[n];if(s=="auth-init")continue;if(!(s in t))continue;if(t[s].topPriority===!0)continue;e.netMessage.sendMessage({name:s,args:t[s].args},"subscribe",function(e){console.log("Err : redoNormalSubscribe")},function(){console.log("redo subscribe "+s)})}};e.pubsub.__reg("clear",function(){var n;for(var i in t){n=t[i].stub||{};for(var s=n.length-1;s>=0;s--)n[s].env.isDestroy&&(n[s].collection=null,n[s].callback=null,n[s].env=null,n.splice(s,1));n.length==0&&(e.netMessage.sendMessage({name:i},"unsubscribe",function(e){},function(){console.log("unsubscribe",i)}),delete t[i],r=r.filter(function(e){return e==i?!1:!0}))}},!0),e.pubsub.__reg("_pubsubObject",i,!0),e.pubsub.__reg("_subscribeMgr",t,!0),e.pubsub.__reg("_publishModelMap",n,!0),e.pubsub.__reg("_redoAllSubscribe",u,!0),e.pubsub.__reg("_postponeQueue",[],"private");var l=e.pubsub._postponeQueue,c=function(e){if(l.length===0)return;l.forEach(function(t,n){t.collection==e&&(t.runner(),l.splice(n,1))})};e.pubsub.__reg("_releaseHold",c,"private")}(sumeru),function(fw){var _controller=fw.addSubPackage("controller"),activeController=[],activeControllerId,cloneDom=null,transitionOut=!1,globalIsforce=null;_bindingMap={};var _bindingData=function(e,t){var n=this.__UK+"_"+e;_bindingMap[n]||(_bindingMap[n]={view_data:{},eventMap:{}});var r=_controller.__load("_tapped_blocks");typeof r!="undefined"&&r.push({widgetId:n});for(var i in t)t.hasOwnProperty(i)&&(_bindingMap[n].view_data[i]=t[i])},_bindingDataByPage=function(e,t){var n=this.__UK+"_"+e;_bindingMap[n]||(_bindingMap[n]={view_data:{},eventMap:{}});if(typeof t.page=="undefined")throw"subscribeByPage always need a page parameter";_bindingMap[n].isByPage=!0;var r=_bindingMap[n].view_data[t.page]={},i=_controller.__load("_tapped_blocks");typeof i!="undefined"&&i.push({widgetId:n,page:t.page,options:t.options||{}});for(var s in t)t.hasOwnProperty(s)&&(r[s]=t[s])},_cloneDom=function(e){cloneDom=e.getDom().cloneNode(!0),cloneDom.style.zIndex="0",cloneDom.removeAttribute("id");var t=cloneDom.querySelectorAll("[tpl-id]");for(var n=0,r=t.length;n<r;n++)t[n].removeAttribute("tpl-id")},_bindingEvent=function(e,t){var n=this.__UK+"_"+e;_bindingMap[n]||(_bindingMap[n]={view_data:{},eventMap:{}});var r=this;_bindingMap[n].eventMap.__default_key__=function(){t.call(r)},_bindingMap[n].eventMap.__default_key__()},queryElementsByTplId=function(e,t){return(t||document).querySelectorAll('block[tpl-id="'+e+'"]')||[]},doRenderByRelation=function(e,t){for(var n in e)t(n,e[n]),doRenderByRelation(e[n],t)},findAndDestroy=_controller.__reg("findAndDestroy",function(e,t){var n=activeController.filter(function(n){var r=n.__getID();return r!==t&&e.indexOf(r)!==-1?!0:!1});n.forEach(function(e){e.destroy()})},!0),_Environment=function(){this.isWaiting=0,this.isWaitingChecker=null,this.callbackFunc=null,this.isDestroy=!1,this.withEnyo=!1},_pubSubObject=new fw.pubsub._pubsubObject;_Environment.prototype={__destroy:function(){fw.utils.cleanObj(this),this.isDestroy=!0,fw.pubsub.clear()},setClockChecker:function(){var e=8e3;this.isWaitingChecker=setTimeout(function(){if(this.isWaiting>0)throw"NOT call env.start after "+e/1e3+" seconds, do you forget it?"},e)},clearClockChecker:function(){clearTimeout(this.isWaitingChecker)},setCallback:function(e){this.callbackFunc=e},fireCallback:function(){this.isWaiting<=0&&this.callbackFunc&&this.callbackFunc()},redirect:function(e,t,n){var r=e;t&&(r+="!"+fw.utils.mapToUriParam(t)),fw.router.redirect(r,n)},refresh:function(){return this.__getControllerInstance().__refresh()},callSub:function(e){this.__getControllerInstance().__callSubController(e)},wait:function(){this.isWaiting++,this.setClockChecker()},start:function(){this.clearClockChecker(),--this.isWaiting<=0&&(this.isWaiting=0,this.fireCallback())},onload:function(){return[]},onrender:function(){},onready:function(){},onsleep:function(){},onresume:function(){},ondestroy:function(){},onerror:function(e){console.log(e)},subscribe:_pubSubObject.subscribe,subscribeByPage:_pubSubObject.subscribeByPage,prioritySubscribe:_pubSubObject.prioritySubscribe};var controllerBase={__init:function(){var e=null,t=[];if(this.__isInited===!1){e=this.getEnvironment(),session=this.getSession();var n=this;activeController.push(this),fw.controller.__reg("_tapped_blocks",t,!0);var r=e.onload(),i=function(t){if(t>=r.length){e.setCallback(null);return}e.setCallback(function(){i(++t)}),fw.sense.runSenseContext(function(e){return function(){fw.controller.__reg("_tapped_blocks",[],!0),e.call({}),n.__render(fw.controller._tapped_blocks)}}(r[t])),e.fireCallback()};i(0),this.__render(),this.__isInited=!0}},__render:function(e){var t=this,n=e.widgetId,r=this.getEnvironment();if(r.withEnyo)return this.__renderEnyo(e),!0;if(typeof _bindingMap[n]=="undefined"||t.__templateBlocks[n]==undefined)return!1;var i=_bindingMap[n];if(i.isByPage){var s=queryElementsByTplId(n),o=e.page,u=_bindingMap[n].view_data[o],a;for(var f=0,l=s.length;f<l;f++){var c=s[f];if(e.options.cleanExist){var h=c.querySelectorAll("[__page-unit-rendered-page]"),p;for(var d=0,v=h.length;d<v;d++)p=h[d],p.parentNode.removeChild(p),p.innerHTML=""}if(c.querySelectorAll("[__page-unit-rendered-page]").length==0){var m=t.__templateBlocks[n](u);m=m.replace(/tpl-role[\s]*=[\s]*['"]page_unit['"]/,'__page-unit-rendered-page="'+o+'"'),c.innerHTML=m}else{var g=document.createElement("div");g.innerHTML=t.__templateBlocks[n](u);var y,b=g.querySelector('[tpl-role="page_unit"]');b==null?y=g:y=b,y.removeAttribute("tpl-role"),y.setAttribute("__page-unit-rendered-page",o);var w;if(w=c.querySelector('[__page-unit-rendered-page="'+o+'"]'))w.innerHTML=y.innerHTML;else{y.innerHTML=y.innerHTML.replace(/tpl-role[\s]*=[\s]*['"]page_unit['"]/,'__page-unit-rendered-page="'+o+'"');var E=c.querySelectorAll("[__page-unit-rendered-page]");w=E[E.length-1],w.parentNode.insertBefore(y,w.nextSibling)}c.innerHTML=c.innerHTML+" "}}var S=_bindingMap[n].eventMap;for(var f in S)S[f]()}else{var u=_bindingMap[n].view_data,s=queryElementsByTplId(n);for(var f=0,l=s.length;f<l;f++){var c=s[f];c.innerHTML=t.__templateBlocks[n](u)}var S=_bindingMap[n].eventMap;for(var f in S)S[f]();var x=null;doRenderByRelation(t.__templateRelation,function(e,t){e==n&&(x=t)}),doRenderByRelation(x,function(e){if(_bindingMap[e]){var n=_bindingMap[e].view_data,r=queryElementsByTplId(e);for(var i=0,s=r.length;i<s;i++){var o=r[i];o.innerHTML=t.__templateBlocks[e](n)}var u=_bindingMap[e].eventMap||{};for(var a in u)u[a]()}})}return!0},__renderEnyo:function(e){var t=session.get("enyoapp");if(!t)return console.log("__renderEnyo -> no enyoapp detacted!"),!1;if(!e){var n=document.getElementById("view/blank@@content");t.renderInto(n);return}var r=e.widgetId,i=r.split(".").pop(),s=_bindingMap[r].eventMap;t.$[i].destroyClientControls(),t.$[i].fwdata=_bindingMap[r].view_data.fwdata,t.$[i].fwdataChanged(),t.$[i].render();for(var o in s)s[o]()},__refresh:function(){var e=this.__getID(),t,n,r=e.split("!");r.length===1&&r.push(""),t=findController(r[0]);if(t===!1)return;this.destroy(!0),n=new MainController(e,fw.utils.uriParamToMap(r[1]),t),n.__init()},destroy:function(e,t){var n=this.__getID(),r=this.__UK,i=this.getSession(),s=this.getEnvironment();!cloneDom&&typeof this.getDom!="undefined"&&t&&_cloneDom(this);try{s.ondestroy()}catch(o){}fw.render.clearTplContent(i),e!==!0?fw.session.destroy(i):i.cleanObserver(),s.__destroy(),fw.render.delTpl(this.tplName);if(this.__subControllerList)for(var u in this.__subControllerList)this.__subControllerList[u].destroy();for(var u in _bindingMap)u.indexOf(r)===0&&(fw.utils.cleanObj(_bindingMap[u].view_data),fw.utils.cleanObj(_bindingMap[u].eventMap),fw.utils.cleanObj(_bindingMap[u]),delete _bindingMap[u]);this.getSession=null,this.getEnvironment=null,this.__getIdentifier=null,delete this.getSession,delete this.getEnvironment,delete this.__getIdentifier;var a=activeController;activeController=a.filter(function(e){return e.__getID()!==n}),a.length=0,SUMERU_APP_FW_DEBUG&&console.log('destory ["'+n+'"]')}},SubControler=function(e,t,n,r){var i=this,s,o;s=new _Environment,o=fw.session.create(e),o.bind=_bindingData,o.event=_bindingEvent,o.eventMap=fw.event.mapEvent,o.__isSubController=!0,o.getMain=function(){return n.session},s.isReady=function(){return!1},s.show=function(){throw"this controller not ready"},s.hide=function(){throw"this controller not ready"},s.destroy=function(){i.destroy()},s.__UK=o.__UK=this.__UK="T"+fw.utils.randomStr(10),this.getSession=function(){return o},this.getEnvironment=function(){return s},this.__getID=function(){return e},this.__isFirstRender=!0,this.__isInited=!1,this.__templateBlocks=!1,this.__templateRelation=!1,r(s,o,t,n),s.__getControllerInstance=function(){return i},SUMERU_APP_FW_DEBUG&&console.log("create new : "+e)};SubControler.prototype=fw.utils.extendFrom(controllerBase,{__render:function(e){var t=this,n=t.getEnvironment(),r=t.getSession(),i=null;n.onrender(function(s,o,u){r.__currentTplName=s;var a,f={position:"absolute",top:0,left:0,width:"100%",height:70,display:"none"};i=typeof u!="undefined"?u:null;var l=function(){if(typeof e!="undefined"){if(!e.length)return;if(t.__isFirstRender){setTimeout(function(){t.__render(e)},50);return}for(var s=0,u=e.length;s<u;s++)controllerBase.__render.call(t,e[s]);return}var l=fw.render.buildRender(r);t.__templateBlocks=l.renderBlock,t.__templateRelation=l.blocksRelation,a=fw.render.getTplContent(r),fw.utils.setStyles(a,fw.utils.cpp(f,o)),doRenderByRelation(t.__templateRelation,function(e){var n=queryElementsByTplId(e);for(var r=0,i=n.length;r<i;r++){var s=n[r];s.innerHTML=t.__templateBlocks[e]({})}}),n.show=function(e){fw.transition._subrun({dom:a,anim:e||i},!1),!i&&e&&(i=e)},n.hide=function(e){fw.transition._subrun({dom:a,anim:e||i},!0)},n.setPosition=function(e){fw.utils.setStyles(a,e)},n.isReady=function(){return!0},r.toBeCommited.length=0,n.onready(a),t.__isFirstRender=!1};fw.render.getTpl(s,r,function(e){t.tplName=s,l()})})}});var MainController=function(e,t,n){var r=this,i,s;i=new _Environment,s=fw.session.create(e),s.bind=_bindingData,s.bindByPage=_bindingDataByPage,s.event=_bindingEvent,s.eventMap=fw.event.mapEvent,i.callSubController=function(e,t,n){return r.__callSubController(e,t,n)},i.__UK=s.__UK=this.__UK="T"+fw.utils.randomStr(10),s.__isSubController=!1,this.getSession=function(){return s},this.getEnvironment=function(){return i},this.__getID=function(){return e},this.__isFirstRender=!0,this.__isInited=!1,this.__templateBlocks=!1,this.__subControllerList={},n(i,s,t),i.__getControllerInstance=function(){return r},SUMERU_APP_FW_DEBUG&&console.log("create new : "+e)};MainController.prototype=fw.utils.extendFrom(controllerBase,{__render:function(e){var t=this,n=t.getEnvironment(),r=t.getSession();n.onrender(function(i,s){r.__currentTplName=i;var o,u=function(){if(typeof e!="undefined"){if(!e.length)return;if(t.__isFirstRender){setTimeout(function(){t.__render(e)},50);return}for(var u=0,a=e.length;u<a;u++)controllerBase.__render.call(t,e[u]);return}var f=fw.render.buildRender(r);t.__templateBlocks=f.renderBlock,t.__templateRelation=f.blocksRelation,o=fw.render.getTplContent(r),doRenderByRelation(t.__templateRelation,function(e){var n=queryElementsByTplId(e);for(var r=0,i=n.length;r<i;r++){var s=n[r];s.innerHTML=t.__templateBlocks[e]({})}}),t.__transition(i,s,function(){r.toBeCommited.length=0,n.onready(o)}),n.withEnyo&&t.__isFirstRender&&controllerBase.__renderEnyo(),t.__isFirstRender=!1};fw.render.getTpl(i,r,function(e){u()})})},__callSubController:function(e,t,n){var r=findController(e),i=this.__lastTransitionIn;if(r===!1)return;var s=this.getEnvironment(),o,u="__subFrom/"+this.__getID()+"/"+e,a,f={session:this.getSession(),env:fw.utils.getProxy(s,["redirect","refresh"]),tplContent:i};if(!r)throw"can not find a sub controller";return a=this.__subControllerList[u],a&&typeof n!="undefined"&&n&&a.destroy(),(a=this.__subControllerList[u])||(a=new SubControler(u,t,f,r),this.__subControllerList[u]=a,o=a.getEnvironment(),o.onready=function(e,t){return function(){e.apply(this,arguments),t&&t.apply({},arguments)}}(o.onready,t.oncreated),o.ondestroy=function(e,t,n,r){return function(){try{e.apply(this,arguments),t&&t()}catch(i){console.error(i)}finally{n.__subControllerList[r]=null,delete n.__subControllerList[r]}}}(o.ondestroy,t.ondestroy,this,u),o.onerror=function(e,t){return function(){e.apply(this,arguments),t&&t.apply({},arguments)}}(o.onerror)),a.__init(),fw.utils.getProxy(a.getEnvironment(),["show","hide","setPosition","isReady","destroy"])},__transition:function(e,t,n){var r,i,s;this.urlToTplHistory=this.urlToTplHistory||{};var o=this.__getID(),u=this.getSession(),a=u.__hashKey.sort(),f={};a.forEach(function(e){f[e]=u.get(e)},a),o+=JSON.stringify(f);if(e||e==="")this.urlToTplHistory[o]=e,r=fw.render.getTplContent(u);else{e=this.urlToTplHistory[o],e||e==""?r=fw.render.getTplContent(u):r=this.__lastTransitionIn;if(!r)return!1}if(s=fw.historyCache.hitUrl([o,t||this.__lastTransitionType],globalIsforce))transitionOut=s[1];return i=fw.transition._run({dom:r,cloneDom:cloneDom,transitionOut:transitionOut,anim:t||this.__lastTransitionType,callback:{load:n||function(){}}}),transitionOut=!1,cloneDom=null,i||(n||function(){})(),this.__lastTransitionType=t||this.__lastTransitionType,this.__lastTransitionIn=r,!0},getDom:function(){return fw.render.getTplContent(this.getSession())}}),_controller.__reg("create",function(e){return e});var findController=_controller.__reg("findController",function(path){var routeMap=fw.router.getAll(),pattern,find;for(var i=routeMap.length-1;i>=0;i--){pattern=new RegExp("^"+routeMap[i].path+"$");if(routeMap[i]["path"]==""&&path==""||routeMap[i].path!==""&&pattern.test(path)===!0){if(find=eval(routeMap[i].action))return find;throw"find a controller ["+path+"], but undefined."}}var externalProcessors=sumeru.router.externalProcessor.getAll(),processor;for(var i=0,l=externalProcessors.length;i<l;i++){processor=externalProcessors[i];if(!0===processor(path))return!1}if(typeof SUMERU_DEFAULT_CONTROLLER!="undefined")return eval(SUMERU_DEFAULT_CONTROLLER);throw"Can NOT find a controller ["+path+"]"},SUMERU_APP_FW_DEBUG?!1:!0),_testReusing=function(e,t){var n=e.__getID();return n.indexOf(t+"!")==0},dispatch=_controller.__reg("dispatch",function(e,t,n){var r=e+"!"+(typeof t!="string"?"":t),i,s=null,o=!1;i=findController(e);if(i===!1)return;console.log("dispatch "+r),globalIsforce=n;var u=null;for(var a in activeController){o=activeController[a],u=o.__getID();if(u==r){s=o;if(!s.__transition()||n)s.destroy(),o=!1;SUMERU_APP_FW_DEBUG&&console.log("ROUTER FULL QUERY PATH : "+r);break}if(_testReusing(s=o,e)){if(activeControllerId===e)s.destroy(!1,!0),o=!1,SUMERU_APP_FW_DEBUG&&console.log("ROUTER SAME QUERY PATH: "+r);else if(!s.__transition()||n)s.destroy(),o=!1,SUMERU_APP_FW_DEBUG&&console.log("ROUTER FULL QUERY PATH: "+r)}else o=!1,SUMERU_APP_FW_DEBUG&&console.log("ROUTER NOT MATCH : "+r)}o||(s=new MainController(r,fw.utils.uriParamToMap(t),i)),activeControllerId=e,s.__init();return},SUMERU_APP_FW_DEBUG?!1:!0);_controller.__reg("reactiveRender",function(e){activeController.forEach(function(t){t.__render(e)})});return}(sumeru),function(e){var t=e.addSubPackage("render"),n={},r="main_tpl";tplContentToController={};var i={top:"",left:"",right:"",bottom:"",width:"",height:"",display:"",position:"",margin:"",padding:""},s=function(e){return"view/"+e},o=function(e){return s(e)+"@@content"},u=t.__reg("getTplContent",function(e){var t=o(e.__currentTplName);return e.__isSubController&&(t=e.__UK+"_"+t),document.getElementById(t)}),a=t.__reg("clearTplContent",function(t){var n=u(t);if(n){n.innerHTML="";if(t.__isSubController){var r=t.__UK+"_",o=r+s(t.__currentTplName);tplContentToController[o]=null,delete tplContentToController[o],n.parentElement.removeChild(n)}else e.utils.setStyles(n,i)}}),f=t.__reg("buildRender",function(t){var n=t.__currentTplName,i=t.__isSubController,u=t.__UK+"_",a=s(n),f=(i?u:"")+a,l=(i?u:"")+o(n),c=t.__getId(),h=null,p;tplContentToController[f]===undefined&&(tplContentToController[f]={type:r,domId:"",usering:[]});var d=tplContentToController[f];d.type=t.__isSubController?t.getMain().__getId():r,d.domId=l,d.usering.indexOf(c)==-1&&d.usering.push(c),d.usering.length>1&&e.controller.findAndDestroy(d.usering,c);var d={tplContent:null,renderBone:null,renderBlock:{},blocksRelation:{}};t.__isSubController?h=o(t.getMain().__currentTplName):h="Runtime@@Wrapper",(p=document.getElementById(l))||(p=document.createElement("section"),p.id=l,document.getElementById(h).appendChild(p));var v=/(<[\s]*block[^>]+tpl-id=['"])(.+)(['"][^>]*>)/gm,m=document.createElement("div"),g=document.getElementById(a).innerHTML;g=g.replace(v,function(e,t,n,r){var i=t+u+n+r;return i});var y={},b=/(<[\s]*block[^>]+tpl-id=['"]([^'"\s]+)['"][^>]*>)([\s\S]*)/mi,w=/<[\s]*\/[\s]*block[\s]*>/mi,E=/(<[\s]*\/[\s]*block[\s]*>)[\s\S]+/mi;g+=" ";var S=g,x=[y],T=function(){var e,t,n,r,i,s;while(e=S.match(b)){i=e[2],n=e[1].length,t=S.indexOf(e[1]),r=S.search(w),r==-1&&(r=S.length);if(r<t)return;var o=x[x.length-1];o[i]={},S=S.substr(t+n),r-=t+n,s=S.search(b),x.push(o[i]);if(s!=-1&&s<r){T(o[i]),x.pop();var u=S.match(E);if(u){var a=S.search(E),f=u[1].length;S=S.substr(a+f);var l=new RegExp("<[\\s]*block[^>]+tpl-id=['\"]"+i+"['\"][^>]*>([\\s\\S]+)<[\\s]*/[\\s]*block[\\s]*>"+Library.string.escapeRegex(S)+"$","mi"),c=g.match(l);c&&(d.renderBlock[i]=Handlebars.compile(c[1]))}}else{x.pop(),d.renderBlock[i]=Handlebars.compile(S.substr(0,r));var u=S.match(E);if(u){var a=S.search(E),f=u[1].length;S=S.substr(a+f)}}}};T(),delete x,d.blocksRelation=y,m.innerHTML=g;var N=m.getElementsByTagName("block");for(var C in N){var k=N[C];k.nodeType==1&&k.getAttribute("tpl-id")&&d.renderBlock[k.getAttribute("tpl-id")]&&(k.innerHTML="")}var L=d.renderBone=Handlebars.compile(m.innerHTML);return m=null,p.innerHTML=L({}),d},!0);t.__reg("getTplStatus",function(e){var t=s(e);return n[t]}),t.__reg("delTpl",function(e){var t=s(e);delete n[t]}),t.__reg("getTpl",function(e,t,r){var i=s(e),o=t.__UK+"_";if(typeof n[i]!="undefined"){if(n[i]=="loaded")r();else if(n[i]=="loading"){var u=function(){n[i]=="loaded"?r():setTimeout(function(){u()},500)};u()}}else{var a=Library.net;n[i]="loading",a.get({url:sumeru.config.view.get("path")+i+".html",callback:function(e){n[i]="loaded";var t=document.createElement("script");t.id=i,t.type="text/x-sumeru-template",t.innerHTML=e,document.getElementById("Runtime@@Wrapper").appendChild(t),r()}})}},!0)}(sumeru),Library=typeof Library=="undefined"?{}:Library;var runnable=function(fw){fw.addSubPackage("Library");var createLibrary=function(e){var t={};return e.call(this,t),t},loadLibrary=function(name){var library=eval(name);if(typeof library=="undefined")throw"Error finding the library "+name};fw.Library.__reg("create",createLibrary),fw.Library.__reg("load",loadLibrary)};typeof module!="undefined"&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){Library.objUtils=e.Library.create(function(e){var t=e.isPlainObject=function(e){if(!e||r(e)!=="object"||e.nodeType||e===e.window)return!1;try{if(e.constructor&&!Object.prototype.hasOwnProperty.call(e,"constructor")&&!Object.prototype.hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}var n;for(n in e);return n===undefined||Object.prototype.hasOwnProperty.call(e,n)},n={};"Boolean Number String Function Array Date RegExp Object".split(" ").forEach(function(e){n["[object "+e+"]"]=e.toLowerCase()});var r=function(e){return e==null?"null":n[Object.prototype.toString.call(e)]||"object"},i=e.isObject=function(e){return r(e)==="object"},s=e.isArray=function(e){return r(e)==="array"},o=e.isFunction=function(e){return r(e)==="function"},u=e.isString=function(e){return r(e)==="string"},a=e.isBoolean=function(e){return r(e)==="bollean"},f=e.isNumber=function(e){return r(e)==="number"},l=e.isDate=function(e){return r(e)==="date"},c=e.isRegExp=function(e){return r(e)==="regexp"},h=e.extend=function(){var e,n,r,i,u,a,f=arguments[0]||{},l=1,c=arguments.length,p=!1;typeof f=="boolean"&&(p=f,f=arguments[1]||{},l=2),typeof f!="object"&&!o(f)&&(f={});if(c===l)return f;for(;l<c;l++)if((e=arguments[l])!=null)for(n in e){r=f[n],i=e[n];if(f===i)continue;p&&i&&(t(i)||(u=s(i)))?(u?(u=!1,a=r&&s(r)?r:[]):a=r&&t(r)?r:{},f[n]=h(p,a,i)):i!==undefined&&(f[n]=i)}return f};return e})};typeof module!="undefined"&&module.exports?module.exports=runnable:runnable(sumeru),function(e){e.addSubPackage("oquery");var t={};t.OPERATORS=[["=",">=",">","<=","<","!=","LIKE","IN","FUNC"],["AND"],["OR"]],t.OPENOPERATORS=["=",">=",">","<=","<","!=","LIKE","IN"],t.isUnitOp=function(e){return t.OPERATORS[0].indexOf(e)>=0},t.query=function(e,n){var r=!1,i;for(op in n)if(t.isUnitOp(op))if(op=="FUNC"){var s=n[op];s instanceof Function?r=t.unitOp(op,s,e):(r=!1,console.error("value is not a function."))}else r=t.unitOp(op,e.get(n[op].key),n[op].value);else{i=n[op];if(op=="AND"){r=!0;for(var o=0,u=i.length;o<u;o++){r=t.query(e,i[o])&&r;if(!r)break}}else if(op=="OR")for(var o=0,u=i.length;o<u;o++){r=t.query(e,i[o])||r;if(r)break}}return r},t.unitOp=function(e,t,n){var r=!1;switch(e){case"=":t===n&&(r=!0);break;case">=":t>=n&&(r=!0);break;case">":t>n&&(r=!0);break;case"<=":t<=n&&(r=!0);break;case"<":t<n&&(r=!0);break;case"!=":t!=n&&(r=!0);break;case"LIKE":(t+"").indexOf(n)>=0&&(r=!0);break;case"IN":n.indexOf(t)>=0&&(r=!0);break;case"FUNC":r=!!t.call(this,n);break;default:r=!1,console.error("unit operator not support.")}return r},e.oquery.__reg("_query",t.query,"private"),e.oquery.__reg("_queryop",t.OPENOPERATORS,"private")}(sumeru);var runnable=function(e){e.addSubPackage("validation");var t=t||{};t.copyArgs=function(e){var t=[];for(var n=0,r=e.length;n<r;n++)t.push(e[n]);return t},t.validations={},t.getErrorMsg=function(e,n,r){console.log(JSON.stringify(arguments));var i="";if(t.validations[r]&&t.validations[r].msg){Library.objUtils.isNumber(e)&&e>=0?i=t.validations[r].msg[e]:i=t.validations[r].msg,i=i.replace("$1",n);for(var s=2,o=arguments.length;s<o;s++)i=i.replace("$"+(s-1),arguments[s])}return i},t.unitValidation=function(e,n,r,i,s,o,u){var a=!0,f="";if(Library.objUtils.isFunction(s))a=s.call(this,i);else if(Library.objUtils.isRegExp(s))a=s.test(i);else if(Library.objUtils.isString(s)){var l=t.validations[s];if(l){if(l.runat.indexOf(e)<0&&l.runat!="both")return!1;if(l.regexp)a=(new RegExp(l.regexp)).test(i);else if(l.func){var c=t.copyArgs(arguments);c.splice(0,5,i),a=l.func.apply(this,c)}else if(l.asyncFunc)return l.asyncFunc.call(this,o,r,i,u),"asyn"}}if(!a||Library.objUtils.isNumber(a)&&a>=0){var c=t.copyArgs(arguments);c.splice(0,5,a,n,s),f=t.getErrorMsg.apply(this,c),a={value:a,msg:f}}else a=!1;return a},t.clientValidation=function(e,n,r,i){var s=t.copyArgs(arguments);return s.unshift("client"),t.unitValidation.apply(this,s)},t.serverValidation=function(e,n,r,i){var s=t.copyArgs(arguments);return s.unshift("server"),t.unitValidation.apply(this,s)},t.isAsynVali=function(e){return typeof t.validations[e]!="undefined"&&typeof t.validations[e]["asyncFunc"]!="undefined"},t.addRule=function(e,n){t.validations[e]=n},e.validation.__reg("addrule",t.addRule,"publish"),e.validation.__reg("_svalidation",t.serverValidation,"private"),e.validation.__reg("_cvalidation",t.clientValidation,"private"),e.validation.__reg("_getvalidationmsg",t.getErrorMsg,"private"),e.validation.__reg("_isasynvali",t.isAsynVali,"private")};typeof module!="undefined"&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){e.validation.addrule("length",{runat:"both",func:function(e,t,n){var e=e+""||"",r=e.length;return r>parseInt(n)?r<parseInt(t)?0:1:r<parseInt(t)?2:-1},msg:["$1长度不能大于$3，且不能小于$2。","$1长度不能大于$3。","$1长度不能小于$2。"]}),e.validation.addrule("minlength",{runat:"both",func:function(e,t){var e=e+""||"",n=e.length;return n>parseInt(t)},msg:"$1长度不能小于$2。"}),e.validation.addrule("maxlength",{runat:"both",func:function(e,t){var e=e+""||"",n=e.length;return n<parseInt(t)},msg:"$1长度不能大于$2。"}),e.validation.addrule("required",{runat:"both",func:function(e){var t=t+""||"",n=t.length;return n>0},msg:"$1为必填项。"}),e.validation.addrule("number",{runat:"both",regexp:"^[0-9]+$",msg:"$1必须为数字。"}),e.validation.addrule("telephone",{runat:"both",regexp:"^(0[0-9]{2,3}-)?([2-9][0-9]{6,7})+(-[0-9]{1,4})?$",msg:"$1必须为电话号码格式。"}),e.validation.addrule("mobilephone",{runat:"both",regexp:"(^0?[1][358][0-9]{9}$)",msg:"$1必须为手机号码格式。"}),e.validation.addrule("email",{runat:"both",regexp:"^[a-zA-Z0-9_.-+]+@([a-zA-Z0-9-]+.)+[a-zA-Z0-9]{2,4}$",msg:"$1必须为email格式。"}),e.validation.addrule("onlyletter",{runat:"both",regexp:"^[a-zA-Z]+$",msg:"$只能是字母。"}),e.validation.addrule("nospecialchars",{runat:"both",regexp:"^[0-9a-zA-Z]+$",msg:"$1不能包含特殊字符。"}),e.validation.addrule("date",{runat:"both",regexp:"^[0-9]{2,4}[/-]{1}[0,1]{0,1}[0-9]{1}[/-]{1}[0,3]{0,1}[0-9]{1}$",msg:"$1格式不正确。"}),e.validation.addrule("chinese",{runat:"both",regexp:"/^[一-龥]+$/",msg:"$1必须为中文。"}),e.validation.addrule("url",{runat:"both",regexp:"/^[a-zA-z]:\\/\\/[^s]$/",msg:"$1必须为URL。"}),e.validation.addrule("unique",{runat:"server",asyncFunc:function(e,t,n,r){var i={};i[t]=n,this.find(i).toArray(function(t,n){var r=!0;t?e.call(this,t):(n.length>0&&(r=!1),e.call(this,t,r))})},msg:"$1不能重复。"})};typeof module!="undefined"&&module.exports?module.exports=runnable:runnable(sumeru),Model=typeof Model=="undefined"?{}:Model;var fw=fw||{};typeof module!="undefined"&&module.exports&&(module.exports=function(e){fw=e}),function(fw){fw.addSubPackage("model"),fw.model.__reg("models",[]);var modelTools={defineProperty:function(e){Object.defineProperty(this,e,{get:function(){return this.__smr__.dataMap[e]},set:function(t){t!=this.__smr__.dataMap[e]&&(this.__smr__.dataMap[e]=t,this._setDirty())}})},setDefineProperties:function(e,t,n,r,i){var n=n||!1,r=r||!1,i=i||!1;if(typeof Object.defineProperty!="undefined")for(var s in t)Object.defineProperty(e,s,{value:t[s],configueable:n,writable:r,enumerable:i});else for(var s in t)e[s]=t[s]}},modelBaseProto={_isModel:!0,_idField:"smr_id",_clientIdField:"__clientId",_isClean:function(){return!this.__smr__.isDirty&&!this.__smr__.isPhantom},_isDeleted:function(){return this.__smr__.isDeleted},_setDirty:function(e){e=typeof e=="undefined"?!0:e,this.__smr__.isDirty=!!e},_setDeleted:function(e){e=typeof e=="undefined"?!0:e,this.__smr__.isDeleted=!!e},_setPhantom:function(e){e=typeof e=="undefined"?!0:e,this.__smr__.isPhantom=e,this.set(this._idField,0),this.set(this._clientIdField,fw.__random())},_setModelChain:function(e,t){this.__smr__.modelchain=e.slice(0),this.__smr__.modelchain.push(t)},_getModelChain:function(){return this.__smr__.modelchain},_delete:function(e){this.__smr__.dataMap[e]=undefined},_clean:function(){this.__smr__.isDirty=!1,this.__smr__.isDeleted=!1,this.__smr__.isPhantom=!1;if(key in this._fieldsMap){var e=this._fieldsMap[key],t=e.type;t==="model"&&this[key]._clean()}},_getModelName:function(){return this._modelName},_baseSet:function(e,t){this.__smr__.dataMap[e]=t},_set:function(e,t,n){if(e in this._fieldsMap){var r=this._fieldsMap[e],i=r.type;if(i==="model"){var s=r.model,o=r.relation;if(o==="many")if(t._isCollection)t._getModelName()===s?this._baseSet(e,t):console.log("model.set arguments format error");else{this[e]._isCollection?this[e].truncate():this._baseSet(e,fw.collection.create({modelName:s}));var u;for(var a=0,f=t.length;a<f;a++)t[a]._isModel?u=t[a]:u=fw.model.create(s,t[a]),this[e].add(u)}else t._isModel?t._getModelName()===s?this._baseSet(e,t):console.log("model.set arguments format error"):this._baseSet(e,fw.model.create(s,t))}else{if(this[e]===t)return this;this[e]=t,e==this._idField&&t!=0&&(this.__smr__.isPhantom=!1)}this._setDirty(n)}return this},_setData:function(e,t){var e=e||{};for(var n in e)this._set(n,e[n],t);this._setDirty(t)},set:function(e,t){var n=arguments.length,r;if(n==1){r=arguments[0];if(Library.objUtils.isObject(r))for(var i in r)this._set(i,r[i],!0)}else n==2&&this._set(e,t,!0)},_setPilotId:function(e){this.__smr__.pilotid=e},_getPilotId:function(){return typeof this.__smr__.pilotid=="undefined"?!1:this.__smr__.pilotid},_setStorable:function(){fw.msgpilot.setPilot(this)},toJSON:function(){var e={};for(key in this.__smr__.dataMap)this._fieldsMap[key]&&this._fieldsMap[key]["type"]=="model"?e[key]=this.__smr__.dataMap[key].toJSON():e[key]=this.__smr__.dataMap[key];return e},_takeSnapshot:function(){this.__smr__.dataMapSnapshot=fw.model._extend({},this.__smr__.dataMap)},_getSnapshot:function(){return this.__smr__.dataMapSnapshot},get:function(e){return this.__smr__.dataMap[e]},getId:function(){return this.__smr__.dataMap[this._idField]},getData:function(){return this.toJSON()},destroy:function(){this.__smr__.isDeleted=!0,this._setDirty()},validation:function(e){if(!fw.config.get("clientValidation"))return!0;var t=[],n,r,i,s,o,u,a,f,l=function(e,t,n){var r={};return r.key=e,r.value=t,r.msg=n.msg,r},c=function(e,t,n){var r={};return r.key=e+"."+n.key,r.value=n.value[0],r.msg=n.msg,r},h=function(e){var n=e.label||e.name,r=e.validation,s=e.validationMsg,o=e.type,u=this[e.name],a=e.name;if(r){Library.objUtils.isString(r)?i=r.split("|"):i=[r];for(var h=0,p=i.length;h<p;h++){var d=(new RegExp("([min,max]*length)\\[([0-9]+)[\\,]*([0-9]*)\\]")).exec(i[h]);if(d){if(d.length>=3){d.shift(),d.unshift(u),d.unshift(a),d.unshift(n);var v=fw.validation.__load("_cvalidation").apply(this,d);v&&t.push(l(a,u,v))}}else{var v=fw.validation.__load("_cvalidation").call(this,n,a,u,i[h]);v&&t.push(l(a,u,v))}}}else if(o=="model"){var m=u.validation();for(var g=0,y=m.length;g<y;g++)f=c(a,u,m[g]),t.push(f)}};if(typeof e!="undefined")h.call(this,this._fieldsMap[e]);else for(var p in this._fieldsMap)n=this._fieldsMap[p],h.call(this,n);var d=!1;return t.length===0&&(d=!0),this.onValidation&&this.onValidation.call(this,d,"client",t),t},_save:function(e,t,n,r){var n=n||this._getPilotId();!t&&!n&&(this._setStorable(),n=this._getPilotId());if(!r){var i=this.validation();if(i.length>0)return console.log("validation faild"),console.log(i),i}e=e||function(){};var s,o;r?(o=this,s=o.__smr_assist__.__sourcePointer[0]):(s=this,o=fw.model._extend(createModel(this._getModelName()),s),o.__smr_assist__.__extendPointer=s,o.__smr_assist__.__pkgId=fw.__random());var u=!1,a=o.__smr__.dataMap,f=!1,l=function(e){for(var i in a)if(a[i]&&a[i]._isCollection){for(var s=0,u=a[i].length;s<u;s++)if(a[i].get(s)&&a[i].get(s)._isModel){if(a[i].get(s)._isClean())continue;if(a[i].get(s).getData().isReference)continue;return}}else if(a[i]&&a[i]._isModel&&!a[i]._isClean()&&!a[i].getData().isReference)return;if(f)return;f=!0;var l=function(e,t){return function(){e.apply(this,arguments)}}(e,r);o._proxy.save(o,l,t,n,o._getModelChain().join("."))},c=function(r){var r=r;if(r._isClean()){r.__smr__.dataMap={isReference:!0,val:"::referenceID::"+r._getModelName()+"::"+r.getId()};return}u=!0,r._save(function(t){return function(n){t.__smr_assist__.__sourcePointer[0].set(t._idField,n),t.__smr_assist__.__sourcePointer[0]._setDirty(!1),t.__smr__.dataMap={isReference:!0,val:"::referenceID::"+t._getModelName()+"::"+n},l(e)}}(r),t,n,!0)};for(var h in a)if(a[h]&&a[h]._isCollection){for(var p=0,d=a[h].length;p<d;p++)a[h].get(p)._isModel&&(a[h].get(p)._setModelChain(o._getModelChain(),h),c(a[h].get(p)));a[h].length===0}else a[h]&&a[h]._isModel&&(a[h]._setModelChain(o._getModelChain(),h),c(a[h]));return!u&&!this._isClean()&&l(e),!0},save:function(e,t,n){this._save(e,t,n,!1)},onValidation:function(e,t,n){}},modelBase=function(){this._modelName="",this._dal={type:"live"},this._proxy={},this._fieldsMap={},this._fieldsMap[this._idField]={name:this._idField,type:"int"},this._fieldsMap[this._clientIdField]={name:this._clientIdField,type:"string"}};modelTools.setDefineProperties(modelBase.prototype,modelBaseProto,!1,!1,!0);var model=function(){this.__smr__={dataMap:{},dataMapSnapshot:{},isDirty:!1,isPhantom:!0,isDeleted:!1,modelchain:[]},this.__smr_assist__={__sourcePointer:null,__extendPointer:null}},getModelTemp=function(modelName){if(typeof fw.model.models[modelName]=="undefined"){var exports={},modelDef=eval(modelName);modelDef.call(this,exports),modelDef=exports;var newModelTemp=new modelBase;newModelTemp._modelName=modelName;if(typeof modelDef.config!="undefined"){var fields=modelDef.config.fields||[],oneField;for(var i=0,l=fields.length;i<l;i++)oneField=fields[i],newModelTemp._fieldsMap[oneField.name]=oneField;var dal=modelDef.config.layer||newModelTemp._dal;newModelTemp._proxy=fw.__DAL.make(dal)}for(var key in modelDef){if(!modelDef.hasOwnProperty(key))continue;if(key=="config")continue;newModelTemp[key]=modelDef[key]}fw.model.models[modelName]=newModelTemp}return fw.model.models[modelName]},createModel=function(modelName,dataMap){var modelTemp=getModelTemp(modelName),newModel=new model;newModel.__proto__=modelTemp;var _fieldsMap=modelTemp._fieldsMap,oneField;for(var p in _fieldsMap){oneField=_fieldsMap[p],modelTools.defineProperty.call(newModel,oneField.name);if(oneField.type==="model"&&typeof oneField.model!="undefined")if(typeof oneField.relation!="undefined"&&oneField["relation"]=="many"){var subCollection=fw.collection.create({modelName:oneField.model});newModel[oneField.name]=subCollection}else{var subModel=fw.model.create(oneField.model);newModel[oneField.name]=subModel}else oneField["type"]=="datetime"&&oneField["defaultValue"]=="now()"?newModel[oneField.name]=fw.utils.getTimeStamp():oneField["type"]=="array"?newModel[oneField.name]=eval(oneField.defaultValue)||[]:oneField["type"]=="object"?newModel[oneField.name]=fw.utils.parseJSON(oneField.defaultValue)||[]:newModel[oneField.name]=oneField.defaultValue||undefined}return newModel._setPhantom(),dataMap&&newModel._setData(dataMap,!1),newModel},extendModel=function(){var e=Library.objUtils,t,n,r,i,s,o,u,a,f=arguments[0]||{},l=1,c=arguments.length;typeof f!="object"&&!e.isFunction(f)&&(f={});if(c===l)return f;for(;l<c;l++)if((t=arguments[l])!=null)for(n in t){if(!t.hasOwnProperty(n))continue;if(n=="__smr_assist__")continue;r=f[n],i=t[n];if(f===i)continue;i&&(e.isPlainObject(i)||(o=i._isCollection)||(u=i._isModel)||(s=e.isArray(i)))?(s?(s=!1,a=r&&e.isArray(r)?r:[]):o?(o=!1,a=r&&r._isCollection?r:fw.collection.create({modelName:i._getModelName()})):u?(u=!1,a=r&&r._isModel?r:fw.model.create(i._getModelName()),a.__smr_assist__.__sourcePointer=i.__smr_assist__.__sourcePointer||[],a.__smr_assist__.__sourcePointer.push(i)):a=r&&e.isPlainObject(r)?r:{},f[n]=extendModel(a,i)):i!==undefined&&(f[n]=i)}return f};fw.model.__reg("create",createModel),fw.model.__reg("_extend",extendModel),fw.model.__reg("_getModelTemp",getModelTemp)}(sumeru),function(e){e.addSubPackage("collection");var t={defineProperty:function(e){Object.defineProperty(this,e,{get:function(){if(this.length>0)return this[0][e]},set:function(t){for(var n=0,r=this.length;n<r;n++)this[n][e]=t}})}};collectionPrototype={_isCollection:!0,_setSynced:function(e){e=typeof e=="undefined"?!1:e,this.__smr__.isSynced=!!e},_isSynced:function(e){return this.__smr__.isSynced},_setNeedSort:function(e){e=typeof e=="undefined"?!0:e,this.__smr__.isNeedSort=!!e},_takeSnapshot:function(){var e=this.find();e.forEach(function(e){e._takeSnapshot()})},_getModelName:function(){return this.__smr__.modelName},_setPilotId:function(e){this.__smr__.pilotid=e},_getPilotId:function(){return typeof this.__smr__.pilotid=="undefined"?!1:this.__smr__.pilotid},_setStorable:function(){e.msgpilot.setPilot(this)},_clean:function(){var e=this.find();e.forEach(function(e){e._clean()})},validation:function(){if(!e.config.get("clientValidation"))return!0;if(arguments.length==0){var t=[],n,r;for(var i=0,s=this.length;i<s;i++){r=this[i];var o=r.validation();o!==!0&&(t=t.concat(o))}var u=!1;return t.length===0&&(u=!0),this.onValidation&&this.onValidation.call(this,u,"client",t),u||t}},add:function(t){var n;return t._isModel?t._getModelName()==this._getModelName()?n=t:console.log("collection.add arguments format error."):n=e.model.create(this._getModelName(),t),this.push(n),this._setSynced(!1),this._setNeedSort(),!0},update:function(e,t){var n=this.find.call(this,t);if(Library.objUtils.isObject(e)){for(var r=0,i=n.length;r<i;r++)n[r]._setData(e,!0);this._setSynced(!1),this._setNeedSort()}},remove:function(e){if(e._isModel)for(var t=0,n=this.length;t<n;t++)this[t]==e&&(this.splice(t,1),t--,n--,this._setNeedSort());else{var r=this.find.apply(this,arguments);for(var i=0,s=r.length;i<s;i++)for(var t=0,n=this.length;t<n;t++)this[t]==r[i]&&(this.splice(t,1),t--,n--,this._setNeedSort())}},destroy:function(e){var t=this.find.apply(this,arguments);for(var n=0,r=t.length;n<r;n++)for(var i=0,s=this.length;i<s;i++)if(this[i]==t[n]){var o=this.splice(i,1);i--,s--,o[0].destroy(),this._setSynced(!1),this._setNeedSort(),o[0].save(function(){},this.pubName,o[0]._getPilotId())}},setData:function(e){this.length=0;for(var t=0,n=e.length;t<n;t++)this.add(e[t]);this._setSynced(!1),this._setNeedSort()},_formatQuery:function(e){var e=e||[],t={};if(Library.objUtils.isArray(e)){t={AND:[]};for(var n=0,r=e.length;n<r;n++)t.AND.push(e[n])}else Library.objUtils.isObject(e)&&(t=this._formatUnitQuery(e));return t},_formatUnitQuery:function(t,n){if(Library.objUtils.isFunction(t))return{FUNC:t};if(Library.objUtils.isObject(t)){var r=[];for(var i in t){var s={},o,u=new RegExp("["+e.oquery.__load("_queryop").join(",")+"]+$"),a=i.replace(/^\s+|\s+$/g,""),f=u.exec(i);f&&f.length>0&&(a=a.replace(f[0]," "+f[0]),a=a.replace(/\s+/," "));var l=a.split(" ");l.length==2?o=l[1]:o="=",s[o]={},s[o].key=l[0],s[o].value=t[i],r.push(s)}if(r.length>1){var n=n||"AND",c=r;r={},r[n]=c}else r=r[0];return r}},_addCondition:function(e,t,n){if(typeof t=="undefined")return;if(t.length==2){var r={};r[t[0]]=t[1],e.push(this._formatUnitQuery(r,n))}else(Library.objUtils.isObject(t[0])||Library.objUtils.isFunction(t[0]))&&e.push(this._formatUnitQuery(t[0],n))},where:function(){return this._addCondition(this.__smr__.wheres,arguments,"AND"),this},orWhere:function(){return this._addCondition(this.__smr__.wheres,arguments,"OR"),this},_clearWheres:function(){this.__smr__.wheres.length=0},find:function(){var t=[];this.sortIt(),arguments.length>0&&this._addCondition(this.__smr__.wheres,arguments,"AND");if(this.__smr__.wheres.length==0)return this;var n,r,i;for(var s=0,o=this.length;s<o;s++){n=this[s];if(n._isDeleted()===!0){this.splice(s,1),s--,o--;continue}r=e.oquery.__load("_query")(n,this._formatQuery(this.__smr__.wheres)),r==1&&t.push(n)}return this._clearWheres(),t},pluck:function(e){if(!e)return[];var t=[],n=this.find();for(var r=0,i=n.length;r<i;r++)typeof n[r][e]!="undefined"&&t.push(n[r][e]);return t},_oSort:function(e){var t=function(e,t,n){var r=0,i=typeof e.localeCompare!="undefined",s=typeof t.localeCompare!="undefined";switch(n){case"ASC":r=i?e.localeCompare(t):e-t;break;case"DESC":r=s?t.localeCompare(e):t-e;break;default:typeof n=="function"&&(r=n.call(this,e,t))}return r},n=function(e,r,i){var s=0,o,u,a,f;if(i.length>0)if(typeof i[0]=="function")s=t.call(this,e,r,i[0]);else{a=i[0].key,f=i[0].value;var o=e.get(a),u=r.get(a);s=t.call(this,o,u,f),i.length>1&&s==0&&(i.shift(),s=n.call(this,e,r,i))}return s};return function(t,r){return n(t,r,e)}},_formatSorter:function(){var e="ASC",t=[];if(arguments.length==0)return;if(arguments.length==1){var n=arguments[0];if(Library.objUtils.isFunction(n))t.push(n);else if(Library.objUtils.isObject(n))for(var r in n){if(/^ASC|DESC$/.test(n[r])||Library.objUtils.isFunction(n))e=n[r];t.push({key:r,value:e})}else t.push({key:n,value:e})}else/^ASC|DESC$/.test(arguments[1])&&(e=arguments[1]),t.push({key:arguments[0],value:e});return t},addSorters:function(){this.__smr__.sorters=this.__smr__.sorters.concat(this._formatSorter.apply(this,arguments)),this._setNeedSort()},clearSorters:function(){this.__smr__.sorters.length=0,this._setNeedSort()},sortIt:function(){arguments.length>0&&this.addSorters.apply(this,arguments);if(this.__smr__.sorters.length==0||!this.__smr__.isNeedSort)return;this.sort(this._oSort(this.__smr__.sorters)),this._setNeedSort(!1)},get:function(e){e=e||0;if(e>=this.length||e<0)return undefined;this.sortIt();var t=this[e];return t._isDeleted()===!0?(this.splice(i,1),this.get(i)):t},stringify:function(){return JSON.stringify(this)},toJSON:function(){var e=[];return this.find().forEach(function(t){e.push(t.getData())}),e},getData:function(){return this.toJSON()},save:function(e,t){t?this.__smr__.saveType="ensure":this.__smr__.saveType="none";if(!e){var n=this.validation();if(n.length>0)return console.log("validation faild"),console.log(n),n;this.pubName||this._setStorable()}for(var r=0,i=this.length;r<i;r++)this[r].save(function(){},this.pubName,this._getPilotId(),!0);return t||this.render(),!0},ensureSave:function(){this.save(!1,!0)},rollback:function(){for(var e=0,t=this.length;e<t;e++){var n=this[e],r=n._getSnapshot();r.smr_id?n._setData(r):this.remove(n)}this._clean()},render:function(){typeof this.pubName!="undefined"&&e.netMessage.sendLocalMessage({pubname:this.pubName,data:""},"data_write_latency")},truncate:function(){this.length=0},hold:function(){this.__smr__.isHolding=!0},releaseHold:function(){e.pubsub._releaseHold(this),this.__smr__.isHolding=!1},isEnsureSave:function(){return this.__smr__.saveType==="ensure"},onValidation:function(e,t,n){}};var n=function(){var e=[];for(p in collectionPrototype)e[p]=collectionPrototype[p];return e},r=function(){return this.__smr__={sorters:[],isNeedSort:!1,wheres:[],isHolding:!1,modelName:"",dal:{type:"live"},isSynced:!1,saveType:"none"},this};r.prototype=new n;var s=function(n,i){if(typeof n.modelName=="undefined")return!1;var s=new r,o=e.model._getModelTemp(n.modelName),u=o._fieldsMap;for(var a in u)t.defineProperty.call(s,u[a].name);s.__smr__.modelName=n.modelName,n.sorters&&(s.__smr__.sorters=n.sorters);var f=n.layer||s.__smr__.dal;return s.__smr__.proxy=e.__DAL.make(f),i&&s.setData(i),s};e.collection.__reg("create",function(e,t){var n=s(e,t);return n._setStorable(),n}),e.collection.__reg("_create",function(e,t){return s(e,t)})}(sumeru);var fw=fw||{};(function(e){e.__DAL={};var t=Library.objUtils,n=function(n){var r=n.getData(),i=n._getSnapshot(),s="",o={};for(var u in i)if(i[u]._isCollection)for(var a=0,f=i[u].length;a<f;a++)i[u].get(a)._isModel&&(i[u].get(a).dataMap={isReference:!0,val:"::referenceID::"+i[u].get(a)._getModelName()+"::"+i[u].get(a).getId()});else i[u]._isModel&&(i[u].dataMap={isReference:!0,val:"::referenceID::"+i[u]._getModelName()+"::"+i[u].getId()});if(!r[n._idField])s="insert",o=e.model._extend({},r),o[n._idField]=e.__load("__ObjectId")(),n.__smr_assist__.__extendPointer&&n.__smr_assist__.__extendPointer.set(n._idField,o[n._idField]);else if(n._isDeleted())s="delete",o[n._idField]=r[n._idField];else{s="update";for(var a in r){if(!i[a]||!r[a]._isCollection&&i[a]!=r[a]||(r[a]._isCollection||r[a]._isModel)&&JSON.stringify(r[a])!=JSON.stringify(i[a])){if(a===n._idField||a===n._clientIdField)continue;o[a]=r[a]}o[n._idField]=i[n._idField]||r[n._idField]}}for(var u in o)t.isObject(o[u])&&o[u]._isCollection&&o[u].length===0&&delete o[u];return n._setDirty(!1),n.__smr_assist__.__extendPointer&&n.__smr_assist__.__extendPointer._setDirty(!1),{type:s,modelName:n._getModelName().replace(/Model\./,""),cnt:o}};e.__DAL.make=function(e){var t=e.type.toLowerCase();if(r[t]){var i=new r[t];i.config=e;var s=i.save;return i.save=function(e,t,r,i,o){var u=n(e);s(u,t,r,i,o)},i}};var r={};r.live=function(){this.proxyid=e.__random()},r.live.prototype={save:function(t,n,r,i,s){typeof r!="undefined"||typeof i!="undefined"?(r&&(i=""),e.netMessage.sendMessage({pubname:r,pilotid:i,modelchain:s,data:t},"data_write_from_client",function(e){console.log("Err : data_write_from_client "+e)},function(){}),n(t.cnt.smr_id)):n(t.cnt.smr_id)}},r.network=function(){this.proxyid=e.__random()},r.network.prototype={save:function(e,t){var n=this.config.url;console.log("network layer saving : ",n+" ",e);var r=e.id;t(r)},get:function(e){},load:function(e,t){var n=[];t(n)}},r.localstorage=function(){this.proxyid=e.__random()},r.localstorage.prototype={save:function(e){console.log("localstorage layer saving : "+e)},get:function(e){}},r.memory=function(){this.proxyid=e.__random(),this.data={},r.memory.manager[this.proxyid]=this},r.memory.manager={},r.memory.manager.resolveRef=function(e,t){var n=/::referenceID::(.*)::(.*)/,i=e.match(n);t(r.memory.manager[i[2]].get())},r.memory.prototype={save:function(e,t){return this.data=e,console.log("memory layer save done",e),t(this.proxyid),!0},get:function(){return this.data},load:function(e,t){var n={};t(n)}}})(sumeru),function(e){function r(e,t){var n,r;for(var i=0,s=t.length;i<s;i++)n=t[i].type,r=t[i].cnt,n=="append"?e.splice(e.length,0,r):n=="update"?e[r.id]=r.cnt:n=="splice"&&e.splice(r)}function i(e,t){var n,r;for(var i=0,s=t.length;i<s;i++){n=t[i].type,r=t[i].cnt;if(n=="insert")for(var o in r)e[o]=r[o];else if(n=="update")for(var o in r)e[o]=r[o];else if(n=="delete")for(var o,u=r.length;o<u;o++)e[o]=undefined}}function s(t,n){var r,u,a=t._modelName,f=e.model._getModelTemp(a)._fieldsMap,l,c,h;for(var p=0,d=n.length;p<d;p++){r=n[p].type,u=n[p].cnt;if(r=="insert")for(var v in u){l=f[v].type;if(l=="model"){c=f[v].model,h=f[v].relation;if(h=="many"){var m=e.collection.create({modelName:c},u[v]);t._baseSet(v,m)}else subModel=e.model.create(c,u[v]),t._baseSet(v,subModel)}else t._baseSet(v,u[v])}else if(r=="update")for(var v in u)l=f[v].type,l=="model"?(c=f[v].model,h=f[v].relation,h=="many"?o(t[v],u[v]):s(t[v],u[v])):l=="array"?t._baseSet(v,u[v]):l=="object"?i(t[v],u[v]):t._baseSet(v,u[v]);else if(r=="delete")for(var g=0,y=u.length;g<y;g++)t._delete(u[g])}}function o(e,t){var n=!1;for(var r=0,i=t.length;r<i;r++){var o=t[r];if(o.type=="insert"){var u=o.cnt,a=e.find({smr_id:u.smr_id});a.length?typeof o["cnt"]["uri"]!="undefined"?(a[0].uri=o.cnt.uri,n=!0):n=!1:(e.add(u),n=!0)}else if(o.type=="delete"){var u=o.cnt;e.remove({"smr_id IN":u}),n=!0}else if(o.type=="update"){var f=e.find({smr_id:o.id});if(!(f.length>0))continue;f=f[0];var u=s(f,o.cnt);n=!0}}return n}function u(e,n,r,i,s){var u=i.collection,a=!1,f=[];if(s)u=r,a=!0;else if(e=="data_write_from_server_delta")f=r,a=o(u,f);else if(!u._isSynced()||u.stringify()!==JSON.stringify(r))u.setData(r),a=!0;s||u._takeSnapshot();if(a===!0){var l=[];t&&t.__reg("_tapped_blocks",l,!0);var c=new RegExp("@@_sumeru_@@_page_([\\d]+)"),h=n.match(c);h?i.callback(u,{page:h[1]}):i.callback(u,{delta:f}),t&&t.reactiveRender(l)}s||u._setSynced(!0)}var t=e.controller,n=e.model,a=e.pubsub._postponeQueue,f=function(t){e.onGlobalMessage?e.onGlobalMessage(t):console.log("GLOBAL MESSAGE : "+t)},l=function(t,n){var r=n=="data_auth_from_server"?"auth faild":t;e.onGlobalError?e.onGlobalError(r):console.log("GLOBAL ERROR : "+r)},c=function(t){if(!t.needAuth){var n=t.pubname,r=e.pubsub._subscribeMgr[n].stub,i=!1;return r.forEach(function(e,t){e.env.onerror?(e.env.onerror("auth failed"),i=!0):i=i}),i}},h=function(t){var n=t.pubname,r=e.pubsub._subscribeMgr[n].stub,i=!1;return r.forEach(function(e,n){e.env.onerror?(e.env.onerror("dberror:"+t.data.stringify()),i=!0):i=i}),i},p=function(t){var n=t.pubname,r=t.pilotid;if(n){var i=e.pubsub._subscribeMgr[n].stub,s=!1;return i.forEach(function(e,n){if(e.collection.onValidation){var r=t.data;if(t.modelchain!="")for(var n=0,i=r.length;n<i;n++)r[n].key=t.modelchain+"."+r[n].key;e.collection.onValidation.call(e.collection,r.length>0?!1:!0,"server",r),s=!0}else s=s}),s}var o=e.msgpilot.getPilot(r),s=!1;if(o.stub.onValidation){var u=t.data;o.stub.onValidation.call(o.stub,u.length>0?!1:!0,"server",u),s=!0}else s=s;return s},d=function(t){var n=(new Date).valueOf();serverTimeStamp=t.timestamp,typeof t.swappk!="undefined"&&(e.myrsa.setPk2(t.swappk),console.log("从server获得新pk2",t.swappk));var r=function(){var e=(new Date).valueOf(),t=e-n,r=t+serverTimeStamp;return r};e.utils.__reg("getTimeStamp",r),Library.objUtils.extend(sumeru.pubsub._publishModelMap,t.pubmap),e.netMessage.sendLocalMessage({},"after_echo_from_server")},v=function(t,n){var r=t.pubname,i=t.pilotid,s=t.data;if(r){if(!(r in e.pubsub._subscribeMgr))return;console.log("data_write_from_server",r),n=="data_write_from_server"&&e.pubsub._subscribeMgr[r].topPriority==1&&typeof e.pubsub._priorityAsyncHandler!="undefined"&&e.pubsub._priorityAsyncHandler.decrease();var o=e.pubsub._subscribeMgr[r].stub,f=sumeru.pubsub._publishModelMap[r.replace(/@@_sumeru_@@_page_([\d]+)/,"")].plainstruct;o.forEach(function(e,t){var i=e.collection;f?u(n,r,s,e,f):i.__smr__.isHolding?a.push({collection:i,runner:function(){u(n,r,s,e)}}):u(n,r,s,e)})}else{var l=sumeru.msgpilot.getPilot(i);l.type!=="model"&&u(n,i,s,item)}},m=function(t,n){var r=t.pubname,i=e.pubsub._subscribeMgr[r].stub,s=!1;return i.forEach(function(e,t){e.env.onerror?(e.env.onerror("auth failed"),s=!0):s=s}),s},g=function(n,r){var i=n.pubname,s=e.pubsub._subscribeMgr[i].stub;s.forEach(function(e,n){var r=e.collection,i=[];t.__reg("_tapped_blocks",i,!0),e.callback(r),t.reactiveRender(i)})},y=function(t,n){if(t&&typeof t=="object")for(var r in t)e.config.set(r,t[r]);e.config.commit()};e.netMessage.setReceiver({onMessage:{target:"config_write_from_server",handle:y}}),e.netMessage.setReceiver({onMessage:{target:"echo_from_server",handle:d}}),e.netMessage.setReceiver({onMessage:{target:["data_write_from_server","data_write_from_server_delta"],handle:v},onLocalMessage:{target:["data_write_latency"],handle:g},onError:m,onGlobalError:l,onGlobalMessage:f}),e.netMessage.setReceiver({onError:{target:["data_auth_from_server"],handle:c}}),e.netMessage.setReceiver({onError:{target:["data_write_from_server_dberror"],handle:h}}),e.netMessage.setReceiver({onError:{target:["data_write_from_server_validation"],handle:p}})}(sumeru);var globalConfig=function(e){var t=8081,n="127.0.0.1",r=27017,i=8080,s="test",o=["xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];typeof process!="undefined"&&typeof process.BAE!="undefined"&&(t=process.env.APP_PORT,n="",r=0,i=0,o=["xhr-streaming"]),e.config.defineModule("cluster"),e.config.cluster({enable:!0,cluster_mgr:"127.0.0.1",cluster_mgr_port:6379}),e.config({soketPort:t,dbname:s,mongoServer:n,mongoPort:r,bae_user:"",bae_password:"",httpServerPort:i,protocols_whitelist:o,view_from_cache:!0}),e.config({clientValidation:!0,serverValidation:!0});if(typeof location!="undefined"){var u=location.hostname+":"+t+"/socket/";typeof process!="undefined"&&typeof process.BAE!="undefined"&&(u=location.hostname+"/socket/"),e.config({clientSocketServer:u,selfGroupManagerAddr:"0.0.0.0",selfGroupManagerPort:"8089"})}if(typeof exports!="undefined"&&typeof module!="undefined"){var a=process.dstDir+"/server/tmp/config";e.config({configPath:a})}var f=e.config.defineModule("view");f({path:"/"})};typeof module!="undefined"&&module.exports?module.exports=globalConfig:globalConfig(sumeru),function(e){var t=!1,n="__viewBlock__",r=function(n,i){var s=Library.cookie;s.getCookie("clientId")||s.addCookie("clientId",sumeru.utils.randomStr(12),175200),s.getCookie("OPEN_STICKY_SESSION")||s.addCookie("OPEN_STICKY_SESSION",1),n=n||0;var o=e.__random();console.log("OPEN : "+e.config.get("clientSocketServer")),sumeru.reachability.setStatus_(sumeru.reachability.STATUS_CONNECTING);var u=new SockJS("http://"+e.config.get("clientSocketServer"),undefined,{protocols_whitelist:e.config.get("protocols_whitelist")});u.onmessage=function(t){var n;e.config.get("rsa_enable")?n=e.myrsa.decrypt(t.data):n=t.data,e.netMessage.onData(n);return},u.onopen=function(){sumeru.reachability.setStatus_(sumeru.reachability.STATUS_CONNECTED);var r={};e.config.get("rsa_enable")?(n===0?(e.myrsa.setPk2(e.config.get("rsa_pk")),e.myrsa.generate()):(r.swappk=e.myrsa.getPk(),e.myrsa.setPk2("")),r.socketId=o,r.uuid=SUMERU_APP_UUID,r.pk=e.myrsa.getPk()):r={socketId:o,uuid:"sumeru_app_uuid"},console.log("ON OPEN : "+u.readyState+" : "+JSON.stringify(r)),e.netMessage.setReceiver({onLocalMessage:{target:["after_echo_from_server"],handle:function(){e.auth.init(function(){t=!0,i&&i(),sumeru.writeBuffer_.resume(),n>0&&(n=0,e.pubsub.__load("_redoAllSubscribe")())})}}}),e.netMessage.sendMessage(r,"echo",function(e){console.log("send echo error...")},function(){console.log("send echo success...")})},u.onclose=function(){sumeru.reachability.setStatus_(sumeru.reachability.STATUS_OFFLINE);if(n>500)throw"Fail to connect to network";setTimeout(function(){r(++n)},1e3)};var a=function(t,n,r){if(u.readyState===0){setTimeout(function(){a(t,n,r)},50);return}var i;!e.config.get("rsa_enable")||t.match(/"target":"echo"/)!==null?i=t:i=e.myrsa.encrypt(t);try{u.send(i)}catch(s){console.log("ERR : "+u.readyState+" "+t),n&&n(s)}r&&r()};e.netMessage.addOutFilter(function(e){return e.sessionId=s.getCookie("sessionId"),e.clientId=s.getCookie("clientId"),e.passportType=s.getCookie("passportType"),e},0),sumeru.writeBuffer_.setOutput(a),sumeru.netMessage.setOutput(sumeru.writeBuffer_.write);return};return e.init=function(e){t?e&&e():r(0,e)},e}(sumeru);var SUMERU_ROUTER=SUMERU_ROUTER===undefined?!0:SUMERU_ROUTER;(function(e){function r(){var e=self.location.href.indexOf("#"),t="";return e>=0&&(t=self.location.href.substr(e+1)),t}function p(e){var t={controller:"",params:"",session:""},n=0,r;try{return e?(r=e.indexOf("!"),r==-1?(t.controller=e,t):(e.indexOf("_smr_ignore=true")!=-1&&(c=!0),t.controller=e.substring(n,r),n=r+1,r=e.indexOf("_smr_ses_dat{"),r=r==-1?undefined:r,t.params=e.substring(n,r),t.params=="&"?t.params="":t.params!=""&&t.params.lastIndexOf("&")!=t.params.length-1&&(t.params+="&"),r===undefined?t:(n=r,r=e.indexOf("}",n+"_smr_ses_dat{".length),t.session=e.substring(n+"_smr_ses_dat{".length,r),t.session=decodeURIComponent(t.session),t))):t}finally{s=t.controller!=a,a=t.controller,o=f!=t.params,f=t.params||"",u=l!=t.session,l=t.session,SUMERU_APP_FW_DEBUG&&(console.log("isControllerChange :"+s),console.log("isSessionChange :"+u),console.log("isParamsChange :"+o),console.log("parts of hash:",t))}}function d(t){t&&t.preventDefault();var n=p(r());u&&!i&&e.session.setResume(n.session),c==0&&(s||o)&&e.init(function(t,n){return function(){e.controller.dispatch(t,n,h),h=!1}}(n.controller,n.params)),c=i=s=u=o=!1}var t=e.addSubPackage("router"),n=e.utils,i=!1,s=!0,o=!0,u=!0,a=null,f=null,l=null,c=!1,h=!1;t.__reg("joinSessionToHash",function(e){var t=n.encodeURIComponentFull(e.substring(1,e.length-1)),r=a+"!"+(f==""?"&":f);r.indexOf("!")==-1&&(r+="!"),r[r.length-1]!="&"&&(r+="&"),r+="_smr_ses_dat{"+t+"}",l=t,i=!0,self.location.hash=r},!0),t.__reg("redirect",function(e,t){e.indexOf("!")==-1&&(e+="!"),e[e.length-1]!="&"&&(e+="&"),l&&(e+="_smr_ses_dat{"+n.encodeURIComponentFull(l)+"}"),self.location.hash=e,h=!!t}),e.event.domReady(function(){SUMERU_APP_FW_DEBUG?sumeru.__require("./unit/qunit/qunit-1.9.0.js",function(e){var t=document.createElement("link");t.href="./unit/qunit/qunit-1.9.0.css",t.rel="stylesheet",document.querySelector("head").appendChild(t);var n=document.createElement("div");n.id="qunit",n.style.position="fixed",n.style.zIndex=1e4,n.style.textAlign="left",n.style.overflow="scroll",n.style.height=screen.availHeight+"px",n.style.width=screen.availWidth+"px",n.style.left="10000px",n.style.top="10000px",document.body.appendChild(n),e.showResource=function(){n.style.left=0,n.style.top=0},e.hideResource=function(){n.style.left="10000px",n.style.top="10000px"},e.init(),e.hideResource(),console.log("DEBUG MODE : QUNIT READIED.")},"Qunit"):window.test=function(){},SUMERU_ROUTER&&(window.onhashchange=d,d())}),SUMERU_APP_FW_DEBUG&&t.__reg("splitHash",p,!0);return})(sumeru),function(e){var t=[],n=function(e){var n;for(var r=0,i=arguments.length;r<i;r++)n=arguments[r],Library.objUtils.isObject(n)&&typeof n.pattern!="undefined"&&n.action&&t.push({path:n.pattern,action:n.action})},r=function(){return t},i=function(e){return e&&n({pattern:"",action:e}),!0},s=[];e.router.addSubPackage("externalProcessor");var o=function(e){var t;for(var n=0,r=arguments.length;n<r;n++)t=arguments[n],typeof t=="function"&&s.push(t)},u=function(){return s};e.router.__reg("add",n),e.router.__reg("getAll",r),e.router.__reg("setDefault",i),e.router.externalProcessor.__reg("add",o),e.router.externalProcessor.__reg("getAll",u)}(sumeru),function(e){e.addSubPackage("historyCache");var t=[],n=function(e,n){if(n)return i(e),!1;var r=!1;for(var s=t.length-1;s>=0;s--)if(t[s]&&t[s][0]===e[0]){r=!0;break}if(!r)return i(e),!1;if(s===t.length-1)return!1;console.log("hit historycache and get",t[s][1],t);for(var o=t.length-1;o>s;o--)t.pop();var u=JSON.stringify(t[s]);return JSON.parse(u)},r=function(){return t},i=function(e){e&&e[0]&&e[1]&&t.push(e)};e.historyCache.__reg("hitUrl",n),e.historyCache.__reg("getCache",r)}(sumeru);var runnable=function(e){var t=0,n=16,r=256,i=1,s=17,o=273,u=4369,a=t,f=0;if(e.reachability)return;var l=e.addSubPackage("reachability"),c=function(e){return a=e,a},h=function(){return a};l.STATUS_OFFLINE=t,l.STATUS_CONNECTING=n,l.STATUS_CONNECTED=r,l.__reg("setStatus_",c,"private"),l.__reg("getStatus",h,"private")};typeof module!="undefined"&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){if(e.writeBuffer_)return;var t=e.addSubPackage("writeBuffer_"),n=e.reachability,r,i=[],s=function(e){r=e},o=function(e,t,n){i.push({msg:e,onError:t,onSuccess:n}),u()},u=function(){if(i.length==0)return!0;var e;while(n.getStatus()==n.STATUS_CONNECTED&&(e=i.shift()))r(e.msg,e.onError,e.onSuccess)};t.__reg("write",o,"private"),t.__reg("setOutput",s,"private"),t.__reg("resume",u,"private")};typeof module!="undefined"&&module.exports?module.exports=runnable:runnable(sumeru);var runnable=function(e){var t={},n=0,r=function(){return"pilot"+n++},i=function(e,n){var n=n||"model";if(!e._getPilotId()){var i=r();t[i]={type:n,stub:e},e._setPilotId(i)}},s=function(e){return t[e]};if(e.msgpilot)return;var o=e.addSubPackage("msgpilot");o.__reg("setPilot",i,"private"),o.__reg("getPilot",s,"private")};typeof module!="undefined"&&module.exports?module.exports=runnable:runnable(sumeru);var Handlebars={};Handlebars.VERSION="1.0.beta.6",Handlebars.helpers={},Handlebars.partials={},Handlebars.registerHelper=function(e,t,n){n&&(t.not=n),this.helpers[e]=t},Handlebars.registerPartial=function(e,t){this.partials[e]=t},Handlebars.registerHelper("helperMissing",function(e){if(arguments.length===2)return undefined;throw new Error("Could not find property '"+e+"'")});var toString=Object.prototype.toString,functionType="[object Function]";Handlebars.registerHelper("blockHelperMissing",function(e,t){var n=t.inverse||function(){},r=t.fn,i="",s=toString.call(e);s===functionType&&(e=e.call(this));if(e===!0)return r(this);if(e===!1||e==null)return n(this);if(s==="[object Array]"){if(e.length>0)for(var o=0,u=e.length;o<u;o++)i+=r(e[o]);else i=n(this);return i}return r(e)}),Handlebars.registerHelper("each",function(e,t){var n=t.fn,r=t.inverse,i="";if(e&&e.length>0)for(var s=0,o=e.length;s<o;s++)i+=n(e[s]);else i=r(this);return i}),Handlebars.registerHelper("if",function(e,t){var n=toString.call(e);return n===functionType&&(e=e.call(this)),!e||Handlebars.Utils.isEmpty(e)?t.inverse(this):t.fn(this)}),Handlebars.registerHelper("unless",function(e,t){var n=t.fn,r=t.inverse;return t.fn=r,t.inverse=n,Handlebars.helpers["if"].call(this,e,t)}),Handlebars.registerHelper("with",function(e,t){return t.fn(e)}),Handlebars.registerHelper("log",function(e){Handlebars.log(e)});var handlebars=function(){var e={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,statements:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,OPEN_PARTIAL:24,params:25,hash:26,param:27,STRING:28,INTEGER:29,BOOLEAN:30,hashSegments:31,hashSegment:32,ID:33,EQUALS:34,pathSegments:35,SEP:36,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",28:"STRING",29:"INTEGER",30:"BOOLEAN",33:"ID",34:"EQUALS",36:"SEP"},productions_:[0,[3,2],[4,3],[4,1],[4,0],[6,1],[6,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[7,2],[17,3],[17,2],[17,2],[17,1],[25,2],[25,1],[27,1],[27,1],[27,1],[27,1],[26,1],[31,2],[31,1],[32,3],[32,3],[32,3],[32,3],[21,1],[35,3],[35,1]],performAction:function(t,n,r,i,s,o,u){var a=o.length-1;switch(s){case 1:return o[a-1];case 2:this.$=new i.ProgramNode(o[a-2],o[a]);break;case 3:this.$=new i.ProgramNode(o[a]);break;case 4:this.$=new i.ProgramNode([]);break;case 5:this.$=[o[a]];break;case 6:o[a-1].push(o[a]),this.$=o[a-1];break;case 7:this.$=new i.InverseNode(o[a-2],o[a-1],o[a]);break;case 8:this.$=new i.BlockNode(o[a-2],o[a-1],o[a]);break;case 9:this.$=o[a];break;case 10:this.$=o[a];break;case 11:this.$=new i.ContentNode(o[a]);break;case 12:this.$=new i.NativeNode(o[a]);break;case 13:this.$=new i.MustacheNode(o[a-1][0],o[a-1][1]);break;case 14:this.$=new i.MustacheNode(o[a-1][0],o[a-1][1]);break;case 15:this.$=o[a-1];break;case 16:this.$=new i.MustacheNode(o[a-1][0],o[a-1][1]);break;case 17:this.$=new i.MustacheNode(o[a-1][0],o[a-1][1],!0);break;case 18:this.$=new i.PartialNode(o[a-1]);break;case 19:this.$=new i.PartialNode(o[a-2],o[a-1]);break;case 20:break;case 21:this.$=[[o[a-2]].concat(o[a-1]),o[a]];break;case 22:this.$=[[o[a-1]].concat(o[a]),null];break;case 23:this.$=[[o[a-1]],o[a]];break;case 24:this.$=[[o[a]],null];break;case 25:o[a-1].push(o[a]),this.$=o[a-1];break;case 26:this.$=[o[a]];break;case 27:this.$=o[a];break;case 28:this.$=new i.StringNode(o[a]);break;case 29:this.$=new i.IntegerNode(o[a]);break;case 30:this.$=new i.BooleanNode(o[a]);break;case 31:this.$=new i.HashNode(o[a]);break;case 32:o[a-1].push(o[a]),this.$=o[a-1];break;case 33:this.$=[o[a]];break;case 34:this.$=[o[a-2],o[a]];break;case 35:this.$=[o[a-2],new i.StringNode(o[a])];break;case 36:this.$=[o[a-2],new i.IntegerNode(o[a])];break;case 37:this.$=[o[a-2],new i.BooleanNode(o[a])];break;case 38:this.$=new i.IdNode(o[a]);break;case 39:o[a-2].push(o[a]),this.$=o[a-2];break;case 40:this.$=[o[a]]}},table:[{3:1,4:2,5:[2,4],6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{1:[3]},{5:[1,16]},{5:[2,3],7:17,8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,19],20:[2,3],22:[1,13],23:[1,14],24:[1,15]},{5:[2,5],14:[2,5],15:[2,5],16:[2,5],19:[2,5],20:[2,5],22:[2,5],23:[2,5],24:[2,5]},{4:20,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{4:21,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],24:[2,11]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{17:22,21:23,33:[1,25],35:24},{17:26,21:23,33:[1,25],35:24},{17:27,21:23,33:[1,25],35:24},{17:28,21:23,33:[1,25],35:24},{21:29,33:[1,25],35:24},{1:[2,1]},{6:30,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{5:[2,6],14:[2,6],15:[2,6],16:[2,6],19:[2,6],20:[2,6],22:[2,6],23:[2,6],24:[2,6]},{17:22,18:[1,31],21:23,33:[1,25],35:24},{10:32,20:[1,33]},{10:34,20:[1,33]},{18:[1,35]},{18:[2,24],21:40,25:36,26:37,27:38,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,38],28:[2,38],29:[2,38],30:[2,38],33:[2,38],36:[1,46]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],36:[2,40]},{18:[1,47]},{18:[1,48]},{18:[1,49]},{18:[1,50],21:51,33:[1,25],35:24},{5:[2,2],8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,2],22:[1,13],23:[1,14],24:[1,15]},{14:[2,20],15:[2,20],16:[2,20],19:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,7],14:[2,7],15:[2,7],16:[2,7],19:[2,7],20:[2,7],22:[2,7],23:[2,7],24:[2,7]},{21:52,33:[1,25],35:24},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{18:[2,22],21:40,26:53,27:54,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,23]},{18:[2,26],28:[2,26],29:[2,26],30:[2,26],33:[2,26]},{18:[2,31],32:55,33:[1,56]},{18:[2,27],28:[2,27],29:[2,27],30:[2,27],33:[2,27]},{18:[2,28],28:[2,28],29:[2,28],30:[2,28],33:[2,28]},{18:[2,29],28:[2,29],29:[2,29],30:[2,29],33:[2,29]},{18:[2,30],28:[2,30],29:[2,30],30:[2,30],33:[2,30]},{18:[2,33],33:[2,33]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],34:[1,57],36:[2,40]},{33:[1,58]},{14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,17],14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],24:[2,17]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]},{18:[1,59]},{18:[1,60]},{18:[2,21]},{18:[2,25],28:[2,25],29:[2,25],30:[2,25],33:[2,25]},{18:[2,32],33:[2,32]},{34:[1,57]},{21:61,28:[1,62],29:[1,63],30:[1,64],33:[1,25],35:24},{18:[2,39],28:[2,39],29:[2,39],30:[2,39],33:[2,39],36:[2,39]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{18:[2,34],33:[2,34]},{18:[2,35],33:[2,35]},{18:[2,36],33:[2,36]},{18:[2,37],33:[2,37]}],defaultActions:{16:[2,1],37:[2,23],53:[2,21]},parseError:function(t,n){throw new Error(t)},parse:function(t){function d(e){r.length=r.length-2*e,i.length=i.length-e,s.length=s.length-e}function v(){var e;return e=n.lexer.lex()||1,typeof e!="number"&&(e=n.symbols_[e]||e),e}var n=this,r=[0],i=[null],s=[],o=this.table,u="",a=0,f=0,l=0,c=2,h=1;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,typeof this.lexer.yylloc=="undefined"&&(this.lexer.yylloc={});var p=this.lexer.yylloc;s.push(p),typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);var m,g,y,b,w,E,S={},x,T,N,C;for(;;){y=r[r.length-1],this.defaultActions[y]?b=this.defaultActions[y]:(m==null&&(m=v()),b=o[y]&&o[y][m]);if(typeof b=="undefined"||!b.length||!b[0])if(!l){C=[];for(x in o[y])this.terminals_[x]&&x>2&&C.push("'"+this.terminals_[x]+"'");var k="";this.lexer.showPosition?k="Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+C.join(", ")+", got '"+this.terminals_[m]+"'":k="Parse error on line "+(a+1)+": Unexpected "+(m==1?"end of input":"'"+(this.terminals_[m]||m)+"'"),this.parseError(k,{text:this.lexer.match,token:this.terminals_[m]||m,line:this.lexer.yylineno,loc:p,expected:C})}if(b[0]instanceof Array&&b.length>1)throw new Error("Parse Error: multiple actions possible at state: "+y+", token: "+m);switch(b[0]){case 1:r.push(m),i.push(this.lexer.yytext),s.push(this.lexer.yylloc),r.push(b[1]),m=null,g?(m=g,g=null):(f=this.lexer.yyleng,u=this.lexer.yytext,a=this.lexer.yylineno,p=this.lexer.yylloc,l>0&&l--);break;case 2:T=this.productions_[b[1]][1],S.$=i[i.length-T],S._$={first_line:s[s.length-(T||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(T||1)].first_column,last_column:s[s.length-1].last_column},E=this.performAction.call(S,u,f,a,this.yy,b[1],i,s);if(typeof E!="undefined")return E;T&&(r=r.slice(0,-1*T*2),i=i.slice(0,-1*T),s=s.slice(0,-1*T)),r.push(this.productions_[b[1]][0]),i.push(S.$),s.push(S._$),N=o[r[r.length-2]][r[r.length-1]],r.push(N);break;case 3:return!0}}return!0}},t=function(){var e={EOF:1,parseError:function(t,n){if(!this.yy.parseError)throw new Error(t);this.yy.parseError(t,n)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.match+=e,this.matched+=e;var t=e.match(/\n/);return t&&this.yylineno++,this._input=this._input.slice(1),e},unput:function(e){return this._input=e+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=(new Array(e.length+1)).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,r;this._more||(this.yytext="",this.match="");var i=this._currentRules();for(var s=0;s<i.length;s++){t=this._input.match(this.rules[i[s]]);if(t){r=t[0].match(/\n.*/g),r&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-1:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,i[s],this.conditionStack[this.conditionStack.length-1]);if(e)return e;return}}if(this._input==="")return this.EOF;this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return typeof t!="undefined"?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)}};return e.performAction=function(t,n,r,i){var s=i;switch(r){case 0:n.yytext.slice(-1)!=="\\"&&this.begin("mu"),n.yytext.slice(-1)==="\\"&&(n.yytext=n.yytext.substr(0,n.yyleng-1),this.begin("emu"));if(n.yytext)return 14;break;case 1:return 14;case 2:return this.popState(),14;case 3:return 24;case 4:return 16;case 5:return 20;case 6:return 19;case 7:return 19;case 8:return 23;case 9:return 23;case 10:return n.yytext=n.yytext.substr(3,n.yyleng-5),this.popState(),15;case 11:return 22;case 12:return 34;case 13:return 33;case 14:return 33;case 15:return 36;case 16:break;case 17:return this.popState(),18;case 18:return this.popState(),18;case 19:return n.yytext=n.yytext.substr(1,n.yyleng-2).replace(/\\"/g,'"'),28;case 20:return 30;case 21:return 30;case 22:return 29;case 23:return 33;case 24:return n.yytext=n.yytext.substr(1,n.yyleng-2),33;case 25:return"INVALID";case 26:return 5}},e.rules=[/^[^\x00]*?(?=(\{\{))/,/^[^\x00]+/,/^[^\x00]{2,}?(?=(\{\{))/,/^\{\{>/,/^\{\{#/,/^\{\{\//,/^\{\{\^/,/^\{\{\s*else\b/,/^\{\{\{/,/^\{\{&/,/^\{\{\$[\s\S]*?\}\}/,/^\{\{/,/^=/,/^\.(?=[} ])/,/^\.\./,/^[\/.]/,/^\s+/,/^\}\}\}/,/^\}\}/,/^"(\\["]|[^"])*"/,/^true(?=[}\s])/,/^false(?=[}\s])/,/^[0-9]+(?=[}\s])/,/^[a-zA-Z0-9_$-]+(?=[=}\s\/.])/,/^\[[^\]]*\]/,/^./,/^$/],e.conditions={mu:{rules:[3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26],inclusive:!1},emu:{rules:[2],inclusive:!1},INITIAL:{rules:[0,1,26],inclusive:!0}},e}();return e.lexer=t,e}();typeof require!="undefined"&&typeof exports!="undefined"&&(exports.parser=handlebars,exports.parse=function(){return handlebars.parse.apply(handlebars,arguments)},exports.main=function(t){if(!t[1])throw new Error("Usage: "+t[0]+" FILE");if(typeof process!="undefined")var n=require("fs").readFileSync(require("path").join(process.cwd(),t[1]),"utf8");else var r=require("file").path(require("file").cwd()),n=r.join(t[1]).read({charset:"utf-8"});return exports.parser.parse(n)},typeof module!="undefined"&&require.main===module&&exports.main(typeof process!="undefined"?process.argv.slice(1):require("system").args)),Handlebars.Parser=handlebars,Handlebars.parse=function(e){return Handlebars.Parser.yy=Handlebars.AST,Handlebars.Parser.parse(e)},Handlebars.print=function(e){return(new Handlebars.PrintVisitor).accept(e)},Handlebars.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(e,t){}},Handlebars.log=function(e,t){Handlebars.logger.log(e,t)},function(){Handlebars.AST={},Handlebars.AST.ProgramNode=function(e,t){this.type="program",this.statements=e,t&&(this.inverse=new Handlebars.AST.ProgramNode(t))},Handlebars.AST.MustacheNode=function(e,t,n){this.type="mustache",this.id=e[0],this.params=e.slice(1),this.hash=t,this.escaped=!n},Handlebars.AST.PartialNode=function(e,t){this.type="partial",this.id=e,this.context=t};var e=function(e,t){if(e.original!==t.original)throw new Handlebars.Exception(e.original+" doesn't match "+t.original)};Handlebars.AST.BlockNode=function(t,n,r){e(t.id,r),this.type="block",this.mustache=t,this.program=n},Handlebars.AST.InverseNode=function(t,n,r){e(t.id,r),this.type="inverse",this.mustache=t,this.program=n},Handlebars.AST.ContentNode=function(e){this.type="content",this.string=e},Handlebars.AST.HashNode=function(e){this.type="hash",this.pairs=e},Handlebars.AST.IdNode=function(e){this.type="ID",this.original=e.join(".");var t=[],n=0;for(var r=0,i=e.length;r<i;r++){var s=e[r];s===".."?n++:s==="."||s==="this"?this.isScoped=!0:t.push(s)}this.parts=t,this.string=t.join("."),this.depth=n,this.isSimple=t.length===1&&n===0},Handlebars.AST.StringNode=function(e){this.type="STRING",this.string=e},Handlebars.AST.IntegerNode=function(e){this.type="INTEGER",this.integer=e},Handlebars.AST.BooleanNode=function(e){this.type="BOOLEAN",this.bool=e},Handlebars.AST.CommentNode=function(e){this.type="comment",this.comment=e},Handlebars.AST.NativeNode=function(e){this.type="nativerun",this.code=e}}(),Handlebars.Exception=function(e){var t=Error.prototype.constructor.apply(this,arguments);for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n]);this.message=t.message},Handlebars.Exception.prototype=new Error,Handlebars.SafeString=function(e){this.string=e},Handlebars.SafeString.prototype.toString=function(){return this.string.toString()},function(){var e={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},t=/&(?!\w+;)|[<>"'`]/g,n=/[&<>"'`]/,r=function(t){return e[t]||"&amp;"};Handlebars.Utils={escapeExpression:function(e){return e instanceof Handlebars.SafeString?e.toString():e==null||e===!1?"":n.test(e)?e.replace(t,r):e},isEmpty:function(e){return typeof e=="undefined"?!0:e===null?!0:e===!1?!0:Object.prototype.toString.call(e)==="[object Array]"&&e.length===0?!0:!1}}}(),Handlebars.Compiler=function(){},Handlebars.JavaScriptCompiler=function(){},function(e,t){e.OPCODE_MAP={appendContent:1,getContext:2,lookupWithHelpers:3,lookup:4,append:5,invokeMustache:6,appendEscaped:7,pushString:8,truthyOrFallback:9,functionOrFallback:10,invokeProgram:11,invokePartial:12,push:13,assignToHash:15,pushStringParam:16,nativerun:17},e.MULTI_PARAM_OPCODES={appendContent:1,getContext:1,lookupWithHelpers:2,lookup:1,invokeMustache:3,pushString:1,truthyOrFallback:1,functionOrFallback:1,invokeProgram:3,invokePartial:1,push:1,assignToHash:1,pushStringParam:1,nativerun:1},e.DISASSEMBLE_MAP={};for(var n in e.OPCODE_MAP){var r=e.OPCODE_MAP[n];e.DISASSEMBLE_MAP[r]=n}e.multiParamSize=function(t){return e.MULTI_PARAM_OPCODES[e.DISASSEMBLE_MAP[t]]},e.prototype={compiler:e,disassemble:function(){var t=this.opcodes,n,r,i=[],s,o,u;for(var a=0,f=t.length;a<f;a++){n=t[a];if(n==="DECLARE")o=t[++a],u=t[++a],i.push("DECLARE "+o+" = "+u);else{s=e.DISASSEMBLE_MAP[n];var l=e.multiParamSize(n),c=[];for(var h=0;h<l;h++)r=t[++a],typeof r=="string"&&(r='"'+r.replace("\n","\\n")+'"'),c.push(r);s=s+" "+c.join(" "),i.push(s)}}return i.join("\n")},guid:0,compile:function(e,t){this.children=[],this.depths={list:[]},this.options=t;var n=this.options.knownHelpers;this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0};if(n)for(var r in n)this.options.knownHelpers[r]=n[r];return this.program(e)},accept:function(e){return this[e.type](e)},program:function(e){var t=e.statements,n;this.opcodes=[];for(var r=0,i=t.length;r<i;r++)n=t[r],this[n.type](n);return this.isSimple=i===1,this.depths.list=this.depths.list.sort(function(e,t){return e-t}),this},compileProgram:function(e){var t=(new this.compiler).compile(e,this.options),n=this.guid++;this.usePartial=this.usePartial||t.usePartial,this.children[n]=t;for(var r=0,i=t.depths.list.length;r<i;r++){depth=t.depths.list[r];if(depth<2)continue;this.addDepth(depth-1)}return n},block:function(e){var t=e.mustache,n,r,i,s,o=this.setupStackForMustache(t),u=this.compileProgram(e.program);e.program.inverse&&(s=this.compileProgram(e.program.inverse),this.declare("inverse",s)),this.opcode("invokeProgram",u,o.length,!!t.hash),this.declare("inverse",null),this.opcode("append")},inverse:function(e){var t=this.setupStackForMustache(e.mustache),n=this.compileProgram(e.program);this.declare("inverse",n),this.opcode("invokeProgram",null,t.length,!!e.mustache.hash),this.declare("inverse",null),this.opcode("append")},hash:function(e){var t=e.pairs,n,r;this.opcode("push","{}");for(var i=0,s=t.length;i<s;i++)n=t[i],r=n[1],this.accept(r),this.opcode("assignToHash",n[0])},partial:function(e){var t=e.id;this.usePartial=!0,e.context?this.ID(e.context):this.opcode("push","depth0"),this.opcode("invokePartial",t.original),this.opcode("append")},content:function(e){this.opcode("appendContent",e.string)},mustache:function(e){var t=this.setupStackForMustache(e);this.opcode("invokeMustache",t.length,e.id.original,!!e.hash),e.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ID:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth),this.opcode("lookupWithHelpers",e.parts[0]||null,e.isScoped||!1);for(var t=1,n=e.parts.length;t<n;t++)this.opcode("lookup",e.parts[t])},STRING:function(e){this.opcode("pushString",e.string)},INTEGER:function(e){this.opcode("push",e.integer)},BOOLEAN:function(e){this.opcode("push",e.bool)},comment:function(){},nativerun:function(e){this.opcode("nativerun",e.code)},pushParams:function(e){var t=e.length,n;while(t--)n=e[t],this.options.stringParams?(n.depth&&this.addDepth(n.depth),this.opcode("getContext",n.depth||0),this.opcode("pushStringParam",n.string)):this[n.type](n)},opcode:function(t,n,r,i){this.opcodes.push(e.OPCODE_MAP[t]),n!==undefined&&this.opcodes.push(n),r!==undefined&&this.opcodes.push(r),i!==undefined&&this.opcodes.push(i)},declare:function(e,t){this.opcodes.push("DECLARE"),this.opcodes.push(e),this.opcodes.push(t)},addDepth:function(e){if(e===0)return;this.depths[e]||(this.depths[e]=!0,this.depths.list.push(e))},setupStackForMustache:function(e){var t=e.params;return this.pushParams(t),e.hash&&this.hash(e.hash),this.ID(e.id),t}},t.prototype={nameLookup:function(e,n,r){return/^[0-9]+$/.test(n)?e+"["+n+"]":t.isValidJavaScriptVariableName(n)?e+"."+n:e+"['"+n+"']"},appendToBuffer:function(e){return this.environment.isSimple?"return "+e+";":"buffer += "+e+";"},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(e,t,n,r){this.environment=e,this.options=t||{},this.name=this.environment.name,this.isChild=!!n,this.context=n||{programs:[],aliases:{self:"this"},registers:{list:[]}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.compileChildren(e,t);var i=e.opcodes,s;this.i=0;for(u=i.length;this.i<u;this.i++)s=this.nextOpcode(0),s[0]==="DECLARE"?(this.i=this.i+2,this[s[1]]=s[2]):(this.i=this.i+s[1].length,this[s[0]].apply(this,s[1]));return this.createFunctionContext(r)},nextOpcode:function(t){var n=this.environment.opcodes,r=n[this.i+t],i,s,o,u;if(r==="DECLARE")return i=n[this.i+1],s=n[this.i+2],["DECLARE",i,s];i=e.DISASSEMBLE_MAP[r],o=e.multiParamSize(r),u=[];for(var a=0;a<o;a++)u.push(n[this.i+a+1+t]);return[i,u]},eat:function(e){this.i=this.i+e.length},preamble:function(){var e=[];this.useRegister("foundHelper");if(!this.isChild){var t=this.namespace,n="helpers = helpers || "+t+".helpers;";this.environment.usePartial&&(n=n+" partials = partials || "+t+".partials;"),e.push(n)}else e.push("");this.environment.isSimple?e.push(""):e.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=e},createFunctionContext:function(e){var t=this.stackVars;this.isChild||(t=t.concat(this.context.registers.list)),t.length>0&&(this.source[1]=this.source[1]+", "+t.join(", "));if(!this.isChild){var n=[];for(var r in this.context.aliases)this.source[1]=this.source[1]+", "+r+"="+this.context.aliases[r]}this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.source.push("return buffer;");var i=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"];for(var s=0,o=this.environment.depths.list.length;s<o;s++)i.push("depth"+this.environment.depths.list[s]);if(e)return i.push(this.source.join("\n  ")),Function.apply(this,i);var u="function "+(this.name||"")+"("+i.join(",")+") {\n  "+this.source.join("\n  ")+"}";return Handlebars.log(Handlebars.logger.DEBUG,u+"\n\n"),u},appendContent:function(e){this.source.push(this.appendToBuffer(this.quotedString(e)))},append:function(){var e=this.popStack();this.source.push("if("+e+" || "+e+" === 0) { "+this.appendToBuffer(e)+" }"),this.environment.isSimple&&this.source.push("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){var e=this.nextOpcode(1),t="";this.context.aliases.escapeExpression="this.escapeExpression",e[0]==="appendContent"&&(t=" + "+this.quotedString(e[1][0]),this.eat(e)),this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"+t))},getContext:function(e){this.lastContext!==e&&(this.lastContext=e)},lookupWithHelpers:function(e,t){if(e){var n=this.nextStack();this.usingKnownHelper=!1;var r;!t&&this.options.knownHelpers[e]?(r=n+" = "+this.nameLookup("helpers",e,"helper"),this.usingKnownHelper=!0):t||this.options.knownHelpersOnly?r=n+" = "+this.nameLookup("depth"+this.lastContext,e,"context"):(this.register("foundHelper",this.nameLookup("helpers",e,"helper")),r=n+" = foundHelper || "+this.nameLookup("depth"+this.lastContext,e,"context")),r+=";",this.source.push(r)}else this.pushStack("depth"+this.lastContext)},lookup:function(e){var t=this.topStack();this.source.push(t+" = ("+t+" === null || "+t+" === undefined || "+t+" === false ? "+t+" : "+this.nameLookup(t,e,"context")+");")},nativerun:function(e){e.match(/this/)&&(e=e.replace(/this/g,"depth0")),this.source.push("with(depth0){"+this.appendToBuffer(e)+"}")},pushStringParam:function(e){this.pushStack("depth"+this.lastContext),this.pushString(e)},pushString:function(e){this.pushStack(this.quotedString(e))},push:function(e){this.pushStack(e)},invokeMustache:function(e,t,n){this.populateParams(e,this.quotedString(t),"{}",null,n,function(e,t,n){this.usingKnownHelper||(this.context.aliases.helperMissing="helpers.helperMissing",this.context.aliases.undef="void 0",this.source.push("else if("+n+"=== undef) { "+e+" = helperMissing.call("+t+"); }"),e!==n&&this.source.push("else { "+e+" = "+n+"; }"))})},invokeProgram:function(e,t,n){var r=this.programExpression(this.inverse),i=this.programExpression(e);this.populateParams(t,null,i,r,n,function(e,t,n){this.usingKnownHelper||(this.context.aliases.blockHelperMissing="helpers.blockHelperMissing",this.source.push("else { "+e+" = blockHelperMissing.call("+t+"); }"))})},populateParams:function(e,t,n,r,i,s){var o=i||this.options.stringParams||r||this.options.data,u=this.popStack(),a,f=[],l,c,h;o?(this.register("tmp1",n),h="tmp1"):h="{ hash: {} }";if(o){var p=i?this.popStack():"{}";this.source.push("tmp1.hash = "+p+";")}this.options.stringParams&&this.source.push("tmp1.contexts = [];");for(var d=0;d<e;d++)l=this.popStack(),f.push(l),this.options.stringParams&&this.source.push("tmp1.contexts.push("+this.popStack()+");");r&&(this.source.push("tmp1.fn = tmp1;"),this.source.push("tmp1.inverse = "+r+";")),this.options.data&&this.source.push("tmp1.data = data;"),f.push(h),this.populateCall(f,u,t||u,s,n!=="{}")},populateCall:function(e,t,n,r,i){var s=["depth0"].concat(e).join(", "),o=["depth0"].concat(n).concat(e).join(", "),u=this.nextStack();if(this.usingKnownHelper)this.source.push(u+" = "+t+".call("+s+");");else{this.context.aliases.functionType='"function"';var a=i?"foundHelper && ":"";this.source.push("if("+a+"typeof "+t+" === functionType) { "+u+" = "+t+".call("+s+"); }")}r.call(this,u,o,t),this.usingKnownHelper=!1},invokePartial:function(e){params=[this.nameLookup("partials",e,"partial"),"'"+e+"'",this.popStack(),"helpers","partials"],this.options.data&&params.push("data"),this.pushStack("self.invokePartial("+params.join(", ")+");")},assignToHash:function(e){var t=this.popStack(),n=this.topStack();this.source.push(n+"['"+e+"'] = "+t+";")},compiler:t,compileChildren:function(e,t){var n=e.children,r,i;for(var s=0,o=n.length;s<o;s++){r=n[s],i=new this.compiler,this.context.programs.push("");var u=this.context.programs.length;r.index=u,r.name="program"+u,this.context.programs[u]=i.compile(r,t,this.context)}},programExpression:function(e){if(e==null)return"self.noop";var t=this.environment.children[e],n=t.depths.list,r=[t.index,t.name,"data"];for(var i=0,s=n.length;i<s;i++)depth=n[i],depth===1?r.push("depth0"):r.push("depth"+(depth-1));return n.length===0?"self.program("+r.join(", ")+")":(r.shift(),"self.programWithDepth("+r.join(", ")+")")},register:function(e,t){this.useRegister(e),this.source.push(e+" = "+t+";")},useRegister:function(e){this.context.registers[e]||(this.context.registers[e]=!0,this.context.registers.list.push(e))},pushStack:function(e){return this.source.push(this.nextStack()+" = "+e+";"),"stack"+this.stackSlot},nextStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),"stack"+this.stackSlot},popStack:function(){return"stack"+this.stackSlot--},topStack:function(){return"stack"+this.stackSlot},quotedString:function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'}};var i="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),s=t.RESERVED_WORDS={};for(var o=0,u=i.length;o<u;o++)s[i[o]]=!0;t.isValidJavaScriptVariableName=function(e){return!t.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(e)?!0:!1}}(Handlebars.Compiler,Handlebars.JavaScriptCompiler),Handlebars.precompile=function(e,t){t=t||{};var n=Handlebars.parse(e),r=(new Handlebars.Compiler).compile(n,t);return(new Handlebars.JavaScriptCompiler).compile(r,t)},Handlebars.compile=function(e,t){function r(){var n=Handlebars.parse(e),r=(new Handlebars.Compiler).compile(n,t),i=(new Handlebars.JavaScriptCompiler).compile(r,t,undefined,!0);return Handlebars.template(i)}t=t||{};var n;return function(e,t){return n||(n=r()),n.call(this,e,t)}},Handlebars.VM={template:function(e){var t={escapeExpression:Handlebars.Utils.escapeExpression,invokePartial:Handlebars.VM.invokePartial,programs:[],program:function(e,t,n){var r=this.programs[e];return n?Handlebars.VM.program(t,n):r?r:(r=this.programs[e]=Handlebars.VM.program(t),r)},programWithDepth:Handlebars.VM.programWithDepth,noop:Handlebars.VM.noop};return function(n,r){return r=r||{},e.call(t,Handlebars,n,r.helpers,r.partials,r.data)}},programWithDepth:function(e,t,n){var r=Array.prototype.slice.call(arguments,2);return function(n,i){return i=i||{},e.apply(this,[n,i.data||t].concat(r))}},program:function(e,t){return function(n,r){return r=r||{},e(n,r.data||t)}},noop:function(){return""},invokePartial:function(e,t,n,r,i,s){options={helpers:r,partials:i,data:s};if(e===undefined)throw new Handlebars.Exception("The partial "+t+" could not be found");if(e instanceof Function)return e(n,options);if(!Handlebars.compile)throw new Handlebars.Exception("The partial "+t+" could not be compiled when running in runtime-only mode");return i[t]=Handlebars.compile(e),i[t](n,options)}},Handlebars.template=Handlebars.VM.template,Handlebars.registerHelper("foreach",function(e,t){var n="",r;if(e){if(e instanceof Array)for(var i=0,s=e.length;i<s;i++)n+=t.fn({key:i,index:i,value:e[i]});else if(typeof e=="object")for(r in e)e.hasOwnProperty(r)&&(n+=t.fn({key:r,value:e[r]}))}else n=t.inverse(this);return n}),Handlebars.registerHelper("equal",function(e,t,n){return e==t?n.fn(this):n.inverse(this)}),Handlebars.registerHelper("unequal",function(e,t,n){return e!=t?n.fn(this):n.inverse(this)}),Library.net=sumeru.Library.create(function(e){return e.get=function(e){var t=new window.XMLHttpRequest;t.onreadystatechange=function(){if(t.readyState==4){var n,r=!1;t.status>=200&&t.status<300||t.status==0&&protocol=="file:"?(n=t.responseText,e.callback(n)):e.callback(t.responseText)}},t.open("GET",e.url,!0),t.send(e.query||"")},e}),SockJS=function(){var e=document,t=window,n={},r=function(){};r.prototype.addEventListener=function(e,t){this._listeners||(this._listeners={}),e in this._listeners||(this._listeners[e]=[]);var r=this._listeners[e];n.arrIndexOf(r,t)===-1&&r.push(t);return},r.prototype.removeEventListener=function(e,t){if(!(this._listeners&&e in this._listeners))return;var r=this._listeners[e],i=n.arrIndexOf(r,t);if(i!==-1){r.length>1?this._listeners[e]=r.slice(0,i).concat(r.slice(i+1)):delete this._listeners[e];return}return},r.prototype.dispatchEvent=function(e){var t=e.type,n=Array.prototype.slice.call(arguments,0);this["on"+t]&&this["on"+t].apply(this,n);if(this._listeners&&t in this._listeners)for(var r=0;r<this._listeners[t].length;r++)this._listeners[t][r].apply(this,n)};var i=function(e,t){this.type=e;if(typeof t!="undefined")for(var n in t){if(!t.hasOwnProperty(n))continue;this[n]=t[n]}};i.prototype.toString=function(){var e=[];for(var t in this){if(!this.hasOwnProperty(t))continue;var n=this[t];typeof n=="function"&&(n="[function]"),e.push(t+"="+n)}return"SimpleEvent("+e.join(", ")+")"};var s=function(e){this.events=e||[]};s.prototype.emit=function(e){var t=this,r=Array.prototype.slice.call(arguments,1);!t.nuked&&t["on"+e]&&t["on"+e].apply(t,r),n.arrIndexOf(t.events,e)===-1&&n.log("Event "+JSON.stringify(e)+" not listed "+JSON.stringify(t.events)+" in "+t)},s.prototype.nuke=function(e){var t=this;t.nuked=!0;for(var n=0;n<t.events.length;n++)delete t[t.events[n]]};var o="abcdefghijklmnopqrstuvwxyz0123456789_";n.random_string=function(e,t){t=t||o.length;var n,r=[];for(n=0;n<e;n++)r.push(o.substr(Math.floor(Math.random()*t),1));return r.join("")},n.random_number=function(e){return Math.floor(Math.random()*e)},n.random_number_string=function(e){var t=(""+(e-1)).length,r=Array(t+1).join("0");return(r+n.random_number(e)).slice(-t)},n.getOrigin=function(e){e+="/";var t=e.split("/").slice(0,3);return t.join("/")},n.isSameOriginUrl=function(e,n){return n||(n=t.location.href),e.split("/").slice(0,3).join("/")===n.split("/").slice(0,3).join("/")},n.getParentDomain=function(e){if(/^[0-9.]*$/.test(e))return e;if(/^\[/.test(e))return e;if(!/[.]/.test(e))return e;var t=e.split(".").slice(1);return t.join(".")},n.objectExtend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e};var u="_jp";n.polluteGlobalNamespace=function(){u in t||(t[u]={})},n.closeFrame=function(e,t){return"c"+JSON.stringify([e,t])},n.userSetCode=function(e){return e===1e3||e>=3e3&&e<=4999},n.countRTO=function(e){var t;return e>100?t=3*e:t=e+200,t},n.log=function(){t.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)},n.bind=function(e,t){return e.bind?e.bind(t):function(){return e.apply(t,arguments)}},n.flatUrl=function(e){return e.indexOf("?")===-1&&e.indexOf("#")===-1},n.amendUrl=function(t){var r=e.location;if(!t)throw new Error("Wrong url for SockJS");if(!n.flatUrl(t))throw new Error("Only basic urls are supported in SockJS");return t.indexOf("//")===0&&(t=r.protocol+t),t.indexOf("/")===0&&(t=r.protocol+"//"+r.host+t),t=t.replace(/[/]+$/,""),t},n.arrIndexOf=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},n.arrSkip=function(e,t){var r=n.arrIndexOf(e,t);if(r===-1)return e.slice();var i=e.slice(0,r);return i.concat(e.slice(r+1))},n.isArray=Array.isArray||function(e){return{}.toString.call(e).indexOf("Array")>=0},n.delay=function(e,t){return typeof e=="function"&&(t=e,e=0),setTimeout(t,e)};var a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f={"\0":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","	":"\\t","\n":"\\n","":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","":"\\u0080","":"\\u0081","":"\\u0082","":"\\u0083","":"\\u0084","":"\\u0085","":"\\u0086","":"\\u0087","":"\\u0088","":"\\u0089","":"\\u008a","":"\\u008b","":"\\u008c","":"\\u008d","":"\\u008e","":"\\u008f","":"\\u0090","":"\\u0091","":"\\u0092","":"\\u0093","":"\\u0094","":"\\u0095","":"\\u0096","":"\\u0097","":"\\u0098","":"\\u0099","":"\\u009a","":"\\u009b","":"\\u009c","":"\\u009d","":"\\u009e","":"\\u009f","­":"\\u00ad","؀":"\\u0600","؁":"\\u0601","؂":"\\u0602","؃":"\\u0603","؄":"\\u0604","܏":"\\u070f","឴":"\\u17b4","឵":"\\u17b5","‌":"\\u200c","‍":"\\u200d","‎":"\\u200e","‏":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","‪":"\\u202a","‫":"\\u202b","‬":"\\u202c","‭":"\\u202d","‮":"\\u202e"," ":"\\u202f","⁠":"\\u2060","⁡":"\\u2061","⁢":"\\u2062","⁣":"\\u2063","⁤":"\\u2064","⁥":"\\u2065","⁦":"\\u2066","⁧":"\\u2067","⁨":"\\u2068","⁩":"\\u2069","⁪":"\\u206a","⁫":"\\u206b","⁬":"\\u206c","⁭":"\\u206d","⁮":"\\u206e","⁯":"\\u206f","﻿":"\\ufeff","￰":"\\ufff0","￱":"\\ufff1","￲":"\\ufff2","￳":"\\ufff3","￴":"\\ufff4","￵":"\\ufff5","￶":"\\ufff6","￷":"\\ufff7","￸":"\\ufff8","￹":"\\ufff9","￺":"\\ufffa","￻":"\\ufffb","￼":"\\ufffc","�":"\\ufffd","￾":"\\ufffe","￿":"\\uffff"},l=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,c,h=JSON&&JSON.stringify||function(e){return a.lastIndex=0,a.test(e)&&(e=e.replace(a,function(e){return f[e]})),'"'+e+'"'},p=function(e){var t,n={},r=[];for(t=0;t<65536;t++)r.push(String.fromCharCode(t));return e.lastIndex=0,r.join("").replace(e,function(e){return n[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,n};n.quote=function(e){var t=h(e);return l.lastIndex=0,l.test(t)?(c||(c=p(l)),t.replace(l,function(e){return c[e]})):t};var d=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];n.probeProtocols=function(){var e={};for(var t=0;t<d.length;t++){var n=d[t];e[n]=T[n]&&T[n].enabled()}return e},n.detectProtocols=function(e,t,n){var r={},i=[];t||(t=d);for(var s=0;s<t.length;s++){var o=t[s];r[o]=e[o]}var u=function(e){var t=e.shift();r[t]?i.push(t):e.length>0&&u(e)};return n.websocket!==!1&&u(["websocket"]),r["xhr-streaming"]&&!n.null_origin?i.push("xhr-streaming"):r["xdr-streaming"]&&!n.cookie_needed&&!n.null_origin?i.push("xdr-streaming"):u(["iframe-eventsource","iframe-htmlfile"]),r["xhr-polling"]&&!n.null_origin?i.push("xhr-polling"):r["xdr-polling"]&&!n.cookie_needed&&!n.null_origin?i.push("xdr-polling"):u(["iframe-xhr-polling","jsonp-polling"]),i};var v="_sockjs_global";n.createHook=function(){var e="a"+n.random_string(8);if(!(v in t)){var r={};t[v]=function(e){return e in r||(r[e]={id:e,del:function(){delete r[e]}}),r[e]}}return t[v](e)},n.attachMessage=function(e){n.attachEvent("message",e)},n.attachEvent=function(n,r){typeof t.addEventListener!="undefined"?t.addEventListener(n,r,!1):(e.attachEvent("on"+n,r),t.attachEvent("on"+n,r))},n.detachMessage=function(e){n.detachEvent("message",e)},n.detachEvent=function(n,r){typeof t.addEventListener!="undefined"?t.removeEventListener(n,r,!1):(e.detachEvent("on"+n,r),t.detachEvent("on"+n,r))};var m={},g=!1,y=function(){for(var e in m)m[e](),delete m[e]},b=function(){if(g)return;g=!0,y()};n.attachEvent("beforeunload",b),n.attachEvent("unload",b),n.unload_add=function(e){var t=n.random_string(8);return m[t]=e,g&&n.delay(y),t},n.unload_del=function(e){e in m&&delete m[e]},n.createIframe=function(t,r){var i=e.createElement("iframe"),s,o,u=function(){clearTimeout(s);try{i.onload=null}catch(e){}i.onerror=null},a=function(){i&&(u(),setTimeout(function(){i&&i.parentNode.removeChild(i),i=null},0),n.unload_del(o))},f=function(e){i&&(a(),r(e))},l=function(e,t){try{i&&i.contentWindow&&i.contentWindow.postMessage(e,t)}catch(n){}};return i.src=t,i.style.display="none",i.style.position="absolute",i.onerror=function(){f("onerror")},i.onload=function(){clearTimeout(s),s=setTimeout(function(){f("onload timeout")},2e3)},e.body.appendChild(i),s=setTimeout(function(){f("timeout")},15e3),o=n.unload_add(a),{post:l,cleanup:a,loaded:u}},n.createHtmlfile=function(e,r){var i=new ActiveXObject("htmlfile"),s,o,a,f=function(){clearTimeout(s)},l=function(){i&&(f(),n.unload_del(o),a.parentNode.removeChild(a),a=i=null,CollectGarbage())},c=function(e){i&&(l(),r(e))},h=function(e,t){try{a&&a.contentWindow&&a.contentWindow.postMessage(e,t)}catch(n){}};i.open(),i.write('<html><script>document.domain="'+document.domain+'";'+"</s"+"cript></html>"),i.close(),i.parentWindow[u]=t[u];var p=i.createElement("div");return i.body.appendChild(p),a=i.createElement("iframe"),p.appendChild(a),a.src=e,s=setTimeout(function(){c("timeout")},15e3),o=n.unload_add(l),{post:h,cleanup:l,loaded:f}};var w=function(){};w.prototype=new s(["chunk","finish"]),w.prototype._start=function(e,r,i,s){var o=this;try{o.xhr=new XMLHttpRequest}catch(u){}if(!o.xhr)try{o.xhr=new t.ActiveXObject("Microsoft.XMLHTTP")}catch(u){}if(t.ActiveXObject||t.XDomainRequest)r+=(r.indexOf("?")===-1?"?":"&")+"t="+ +(new Date);o.unload_ref=n.unload_add(function(){o._cleanup(!0)});try{o.xhr.open(e,r,!0)}catch(a){o.emit("finish",0,""),o._cleanup();return}if(!s||!s.no_credentials)o.xhr.withCredentials="true";if(s&&s.headers)for(var f in s.headers)o.xhr.setRequestHeader(f,s.headers[f]);o.xhr.onreadystatechange=function(){if(o.xhr){var e=o.xhr;switch(e.readyState){case 3:try{var t=e.status,n=e.responseText}catch(e){}n&&n.length>0&&o.emit("chunk",t,n);break;case 4:o.emit("finish",e.status,e.responseText),o._cleanup(!1)}}},o.xhr.send(i)},w.prototype._cleanup=function(e){var t=this;if(!t.xhr)return;n.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){};if(e)try{t.xhr.abort()}catch(r){}t.unload_ref=t.xhr=null},w.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)};var E=n.XHRCorsObject=function(){var e=this,t=arguments;n.delay(function(){e._start.apply(e,t)})};E.prototype=new w;var S=n.XHRLocalObject=function(e,t,r){var i=this;n.delay(function(){i._start(e,t,r,{no_credentials:!0})})};S.prototype=new w;var x=n.XDRObject=function(e,t,r){var i=this;n.delay(function(){i._start(e,t,r)})};x.prototype=new s(["chunk","finish"]),x.prototype._start=function(e,t,r){var i=this,s=new XDomainRequest;t+=(t.indexOf("?")===-1?"?":"&")+"t="+ +(new Date);var o=s.ontimeout=s.onerror=function(){i.emit("finish",0,""),i._cleanup(!1)};s.onprogress=function(){i.emit("chunk",200,s.responseText)},s.onload=function(){i.emit("finish",200,s.responseText),i._cleanup(!1)},i.xdr=s,i.unload_ref=n.unload_add(function(){i._cleanup(!0)});try{i.xdr.open(e,t),i.xdr.send(r)}catch(u){o()}},x.prototype._cleanup=function(e){var t=this;if(!t.xdr)return;n.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null;if(e)try{t.xdr.abort()}catch(r){}t.unload_ref=t.xdr=null},x.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},n.isXHRCorsCapable=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:t.XDomainRequest&&e.domain?2:j.enabled()?3:4};var T=function(e,t,r){var i=this,s;i._options={devel:!1,debug:!1,protocols_whitelist:[],info:undefined,rtt:undefined},r&&n.objectExtend(i._options,r),i._base_url=n.amendUrl(e),i._server=i._options.server||n.random_number_string(1e3),i._options.protocols_whitelist&&i._options.protocols_whitelist.length?s=i._options.protocols_whitelist:(typeof t=="string"&&t.length>0?s=[t]:n.isArray(t)?s=t:s=null,s&&i._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.')),i._protocols=[],i.protocol=null,i.readyState=T.CONNECTING,i._ir=W(i._base_url),i._ir.onfinish=function(e,t){i._ir=null,e?(i._options.info&&(e=n.objectExtend(e,i._options.info)),i._options.rtt&&(t=i._options.rtt),i._applyInfo(e,t,s),i._didClose()):i._didClose(1002,"Can't connect to server",!0)}};T.prototype=new r,T.version="0.3.1",T.CONNECTING=0,T.OPEN=1,T.CLOSING=2,T.CLOSED=3,T.prototype._debug=function(){this._options.debug&&n.log.apply(n,arguments)},T.prototype._dispatchOpen=function(){var e=this;e.readyState===T.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=T.OPEN,e.dispatchEvent(new i("open"))):e._didClose(1006,"Server lost session")},T.prototype._dispatchMessage=function(e){var t=this;if(t.readyState!==T.OPEN)return;t.dispatchEvent(new i("message",{data:e}))},T.prototype._dispatchHeartbeat=function(e){var t=this;if(t.readyState!==T.OPEN)return;t.dispatchEvent(new i("heartbeat",{}))},T.prototype._didClose=function(e,t,r){var s=this;if(s.readyState!==T.CONNECTING&&s.readyState!==T.OPEN&&s.readyState!==T.CLOSING)throw new Error("INVALID_STATE_ERR");s._ir&&(s._ir.nuke(),s._ir=null),s._transport&&(s._transport.doCleanup(),s._transport=null);var o=new i("close",{code:e,reason:t,wasClean:n.userSetCode(e)});if(!n.userSetCode(e)&&s.readyState===T.CONNECTING&&!r){if(s._try_next_protocol(o))return;o=new i("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:o})}s.readyState=T.CLOSED,n.delay(function(){s.dispatchEvent(o)})},T.prototype._didMessage=function(e){var t=this,n=e.slice(0,1);switch(n){case"o":t._dispatchOpen();break;case"a":var r=JSON.parse(e.slice(1)||"[]");for(var i=0;i<r.length;i++)t._dispatchMessage(r[i]);break;case"m":var r=JSON.parse(e.slice(1)||"null");t._dispatchMessage(r);break;case"c":var r=JSON.parse(e.slice(1)||"[]");t._didClose(r[0],r[1]);break;case"h":t._dispatchHeartbeat()}},T.prototype._try_next_protocol=function(t){var r=this;r.protocol&&(r._debug("Closed transport:",r.protocol,""+t),r.protocol=null),r._transport_tref&&(clearTimeout(r._transport_tref),r._transport_tref=null);for(;;){var i=r.protocol=r._protocols.shift();if(!i)return!1;if(T[i]&&T[i].need_body===!0&&(!e.body||typeof e.readyState!="undefined"&&e.readyState!=="complete"))return r._protocols.unshift(i),r.protocol="waiting-for-load",n.attachEvent("load",function(){r._try_next_protocol()}),!0;if(!!T[i]&&!!T[i].enabled(r._options)){var s=T[i].roundTrips||1,o=(r._options.rto||0)*s||5e3;r._transport_tref=n.delay(o,function(){r.readyState===T.CONNECTING&&r._didClose(2007,"Transport timeouted")});var u=n.random_string(8),a=r._base_url+"/"+r._server+"/"+u;return r._debug("Opening transport:",i," url:"+a," RTO:"+r._options.rto),r._transport=new T[i](r,a,r._base_url),!0}r._debug("Skipping transport:",i)}},T.prototype.close=function(e,t){var r=this;if(e&&!n.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return r.readyState!==T.CONNECTING&&r.readyState!==T.OPEN?!1:(r.readyState=T.CLOSING,r._didClose(e||1e3,t||"Normal closure"),!0)},T.prototype.send=function(e){var t=this;if(t.readyState===T.CONNECTING)throw new Error("INVALID_STATE_ERR");return t.readyState===T.OPEN&&t._transport.doSend(n.quote(""+e)),!0},T.prototype._applyInfo=function(t,r,i){var s=this;s._options.info=t,s._options.rtt=r,s._options.rto=n.countRTO(r),s._options.info.null_origin=!e.domain;var o=n.probeProtocols();s._protocols=n.detectProtocols(o,i,t)};var N=T.websocket=function(e,r){var i=this,s=r+"/websocket";s.slice(0,5)==="https"?s="wss"+s.slice(5):s="ws"+s.slice(4),i.ri=e,i.url=s;var o=t.WebSocket||t.MozWebSocket;i.ws=new o(i.url),i.ws.onmessage=function(e){i.ri._didMessage(e.data)},i.unload_ref=n.unload_add(function(){i.ws.close()}),i.ws.onclose=function(){i.ri._didMessage(n.closeFrame(1006,"WebSocket connection broken"))}};N.prototype.doSend=function(e){this.ws.send("["+e+"]")},N.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),n.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},N.enabled=function(){return!!t.WebSocket||!!t.MozWebSocket},N.roundTrips=2;var C=function(){};C.prototype.send_constructor=function(e){var t=this;t.send_buffer=[],t.sender=e},C.prototype.doSend=function(e){var t=this;t.send_buffer.push(e),t.send_stop||t.send_schedule()},C.prototype.send_schedule_wait=function(){var e=this,t;e.send_stop=function(){e.send_stop=null,clearTimeout(t)},t=n.delay(25,function(){e.send_stop=null,e.send_schedule()})},C.prototype.send_schedule=function(){var e=this;if(e.send_buffer.length>0){var t="["+e.send_buffer.join(",")+"]";e.send_stop=e.sender(e.trans_url,t,function(){e.send_stop=null,e.send_schedule_wait()}),e.send_buffer=[]}},C.prototype.send_destructor=function(){var e=this;e._send_stop&&e._send_stop(),e._send_stop=null};var k=function(t,r,i){var s=this;if(!("_send_form"in s)){var o=s._send_form=e.createElement("form"),u=s._send_area=e.createElement("textarea");u.name="d",o.style.display="none",o.style.position="absolute",o.method="POST",o.enctype="application/x-www-form-urlencoded",o.acceptCharset="UTF-8",o.appendChild(u),e.body.appendChild(o)}var o=s._send_form,u=s._send_area,a="a"+n.random_string(8);o.target=a,o.action=t+"/jsonp_send?i="+a;var f;try{f=e.createElement('<iframe name="'+a+'">')}catch(l){f=e.createElement("iframe"),f.name=a}f.id=a,o.appendChild(f),f.style.display="none";try{u.value=r}catch(c){n.log("Your browser is seriously broken. Go home! "+c.message)}o.submit();var h=function(e){if(!f.onerror)return;f.onreadystatechange=f.onerror=f.onload=null,n.delay(500,function(){f.parentNode.removeChild(f),f=null}),u.value="",i()};return f.onerror=f.onload=h,f.onreadystatechange=function(e){f.readyState=="complete"&&h()},h},L=function(e){return function(t,n,r){var i=new e("POST",t+"/xhr_send",n);return i.onfinish=function(e,t){r(e)},function(e){r(0,e)}}},A=function(t,r){var i,s=e.createElement("script"),o,u=function(e){o&&(o.parentNode.removeChild(o),o=null),s&&(clearTimeout(i),s.parentNode.removeChild(s),s.onreadystatechange=s.onerror=s.onload=s.onclick=null,s=null,r(e),r=null)},a=!1,f=null;s.id="a"+n.random_string(8),s.src=t,s.type="text/javascript",s.charset="UTF-8",s.onerror=function(e){f||(f=setTimeout(function(){a||u(n.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},s.onload=function(e){u(n.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},s.onreadystatechange=function(e){if(/loaded|closed/.test(s.readyState)){if(s&&s.htmlFor&&s.onclick){a=!0;try{s.onclick()}catch(t){}}s&&u(n.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}};if(typeof s.async=="undefined"&&e.attachEvent)if(!/opera/i.test(navigator.userAgent)){try{s.htmlFor=s.id,s.event="onclick"}catch(l){}s.async=!0}else o=e.createElement("script"),o.text="try{var a = document.getElementById('"+s.id+"'); if(a)a.onerror();}catch(x){};",s.async=o.async=!1;typeof s.async!="undefined"&&(s.async=!0),i=setTimeout(function(){u(n.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var c=e.getElementsByTagName("head")[0];return c.insertBefore(s,c.firstChild),o&&c.insertBefore(o,c.firstChild),u},O=T["jsonp-polling"]=function(e,t){n.polluteGlobalNamespace();var r=this;r.ri=e,r.trans_url=t,r.send_constructor(k),r._schedule_recv()};O.prototype=new C,O.prototype._schedule_recv=function(){var e=this,t=function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv()};e._recv_stop=M(e.trans_url+"/jsonp",A,t)},O.enabled=function(){return!0},O.need_body=!0,O.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var M=function(e,r,i){var s="a"+n.random_string(6),o=e+"?c="+escape(u+"."+s),a=function(e){delete t[u][s],i(e)},f=r(o,a);t[u][s]=f;var l=function(){t[u][s]&&t[u][s](n.closeFrame(1e3,"JSONP user aborted read"))};return l},_=function(){};_.prototype=new C,_.prototype.run=function(e,t,n,r,i){var s=this;s.ri=e,s.trans_url=t,s.send_constructor(L(i)),s.poll=new Y(e,r,t+n,i)},_.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var D=T["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",rt,n.XHRCorsObject)};D.prototype=new _,D.enabled=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},D.roundTrips=2,D.need_body=!0;var P=T["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",rt,n.XDRObject)};P.prototype=new _,P.enabled=function(){return!!t.XDomainRequest},P.roundTrips=2;var H=T["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",rt,n.XHRCorsObject)};H.prototype=new _,H.enabled=D.enabled,H.roundTrips=2;var B=T["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",rt,n.XDRObject)};B.prototype=new _,B.enabled=P.enabled,B.roundTrips=2;var j=function(){};j.prototype.i_constructor=function(e,t,r){var i=this;i.ri=e,i.origin=n.getOrigin(r),i.base_url=r,i.trans_url=t;var s=r+"/iframe.html";i.ri._options.devel&&(s+="?t="+ +(new Date)),i.window_id=n.random_string(8),s+="#"+i.window_id,i.iframeObj=n.createIframe(s,function(e){i.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),i.onmessage_cb=n.bind(i.onmessage,i),n.attachMessage(i.onmessage_cb)},j.prototype.doCleanup=function(){var e=this;if(e.iframeObj){n.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(t){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},j.prototype.onmessage=function(e){var t=this;if(e.origin!==t.origin)return;var n=e.data.slice(0,8),r=e.data.slice(8,9),i=e.data.slice(9);if(n!==t.window_id)return;switch(r){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([T.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(i)}},j.prototype.postMessage=function(e,t){var n=this;n.iframeObj.post(n.window_id+e+(t||""),n.origin)},j.prototype.doSend=function(e){this.postMessage("m",e)},j.enabled=function(){var e=navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Konqueror")!==-1;return(typeof t.postMessage=="function"||typeof t.postMessage=="object")&&!e};var F,I=function(e,r){parent!==t?parent.postMessage(F+e+(r||""),"*"):n.log("Can't postMessage, no parent window.",e,r)},q=function(){};q.prototype._didClose=function(e,t){I("t",n.closeFrame(e,t))},q.prototype._didMessage=function(e){I("t",e)},q.prototype._doSend=function(e){this._transport.doSend(e)},q.prototype._doCleanup=function(){this._transport.doCleanup()},n.parent_origin=undefined,T.bootstrap_iframe=function(){var r;F=e.location.hash.slice(1);var i=function(e){if(e.source!==parent)return;typeof n.parent_origin=="undefined"&&(n.parent_origin=e.origin);if(e.origin!==n.parent_origin)return;var i=e.data.slice(0,8),s=e.data.slice(8,9),o=e.data.slice(9);if(i!==F)return;switch(s){case"s":var u=JSON.parse(o),a=u[0],f=u[1],l=u[2],c=u[3];a!==T.version&&n.log('Incompatibile SockJS! Main site uses: "'+a+'", the iframe:'+' "'+T.version+'".');if(!n.flatUrl(l)||!n.flatUrl(c)){n.log("Only basic urls are supported in SockJS");return}if(!n.isSameOriginUrl(l)||!n.isSameOriginUrl(c)){n.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([t.location.href,l,c])+")");return}r=new q,r._transport=new q[f](r,l,c);break;case"m":r._doSend(o);break;case"c":r&&r._doCleanup(),r=null}};n.attachMessage(i),I("s")};var R=function(e,t){var r=this;n.delay(function(){r.doXhr(e,t)})};R.prototype=new s(["finish"]),R.prototype.doXhr=function(e,t){var r=this,i=(new Date).getTime(),s=new t("GET",e+"/info"),o=n.delay(8e3,function(){s.ontimeout()});s.onfinish=function(e,t){clearTimeout(o),o=null;if(e===200){var n=(new Date).getTime()-i,s=JSON.parse(t);typeof s!="object"&&(s={}),r.emit("finish",s,n)}else r.emit("finish")},s.ontimeout=function(){s.close(),r.emit("finish")}};var U=function(t){var r=this,i=function(){var e=new j;e.protocol="w-iframe-info-receiver";var n=function(t){if(typeof t=="string"&&t.substr(0,1)==="m"){var n=JSON.parse(t.substr(1)),i=n[0],s=n[1];r.emit("finish",i,s)}else r.emit("finish");e.doCleanup(),e=null},i={_options:{},_didClose:n,_didMessage:n};e.i_constructor(i,t,t)};e.body?i():n.attachEvent("load",i)};U.prototype=new s(["finish"]);var z=function(){var e=this;n.delay(function(){e.emit("finish",{},2e3)})};z.prototype=new s(["finish"]);var W=function(e){if(n.isSameOriginUrl(e))return new R(e,n.XHRLocalObject);switch(n.isXHRCorsCapable()){case 1:return new R(e,n.XHRCorsObject);case 2:return new R(e,n.XDRObject);case 3:return new U(e);default:return new z}},X=q["w-iframe-info-receiver"]=function(e,t,r){var i=new R(r,n.XHRLocalObject);i.onfinish=function(t,n){e._didMessage("m"+JSON.stringify([t,n])),e._didClose()}};X.prototype.doCleanup=function(){};var V=T["iframe-eventsource"]=function(){var e=this;e.protocol="w-iframe-eventsource",e.i_constructor.apply(e,arguments)};V.prototype=new j,V.enabled=function(){return"EventSource"in t&&j.enabled()},V.need_body=!0,V.roundTrips=3;var $=q["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",Z,n.XHRLocalObject)};$.prototype=new _;var J=T["iframe-xhr-polling"]=function(){var e=this;e.protocol="w-iframe-xhr-polling",e.i_constructor.apply(e,arguments)};J.prototype=new j,J.enabled=function(){return t.XMLHttpRequest&&j.enabled()},J.need_body=!0,J.roundTrips=3;var K=q["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",rt,n.XHRLocalObject)};K.prototype=new _;var Q=T["iframe-htmlfile"]=function(){var e=this;e.protocol="w-iframe-htmlfile",e.i_constructor.apply(e,arguments)};Q.prototype=new j,Q.enabled=function(){return j.enabled()},Q.need_body=!0,Q.roundTrips=3;var G=q["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",nt,n.XHRLocalObject)};G.prototype=new _;var Y=function(e,t,n,r){var i=this;i.ri=e,i.Receiver=t,i.recv_url=n,i.AjaxObject=r,i._scheduleRecv()};Y.prototype._scheduleRecv=function(){var e=this,t=e.poll=new e.Receiver(e.recv_url,e.AjaxObject),n=0;t.onmessage=function(t){n+=1,e.ri._didMessage(t.data)},t.onclose=function(n){e.poll=t=t.onmessage=t.onclose=null,e.poll_is_closing||(n.reason==="permanent"?e.ri._didClose(1006,"Polling error ("+n.reason+")"):e._scheduleRecv())}},Y.prototype.abort=function(){var e=this;e.poll_is_closing=!0,e.poll&&e.poll.abort()};var Z=function(e){var t=this,r=new EventSource(e);r.onmessage=function(e){t.dispatchEvent(new i("message",{data:unescape(e.data)}))},t.es_close=r.onerror=function(e,s){var o=s?"user":r.readyState!==2?"network":"permanent";t.es_close=r.onmessage=r.onerror=null,r.close(),r=null,n.delay(200,function(){t.dispatchEvent(new i("close",{reason:o}))})}};Z.prototype=new r,Z.prototype.abort=function(){var e=this;e.es_close&&e.es_close({},!0)};var et,tt=function(){if(et===undefined)if("ActiveXObject"in t)try{et=!!(new ActiveXObject("htmlfile"))}catch(e){}else et=!1;return et},nt=function(e){var r=this;n.polluteGlobalNamespace(),r.id="a"+n.random_string(6,26),e+=(e.indexOf("?")===-1?"?":"&")+"c="+escape(u+"."+r.id);var s=tt()?n.createHtmlfile:n.createIframe,o;t[u][r.id]={start:function(){o.loaded()},message:function(e){r.dispatchEvent(new i("message",{data:e}))},stop:function(){r.iframe_close({},"network")}},r.iframe_close=function(e,n){o.cleanup(),r.iframe_close=o=null,delete t[u][r.id],r.dispatchEvent(new i("close",{reason:n}))},o=s(e,function(e){r.iframe_close({},"permanent")})};nt.prototype=new r,nt.prototype.abort=function(){var e=this;e.iframe_close&&e.iframe_close({},"user")};var rt=function(e,t){var n=this,r=0;n.xo=new t("POST",e,null),n.xo.onchunk=function(e,t){if(e!==200)return;for(;;){var s=t.slice(r),o=s.indexOf("\n");if(o===-1)break;r+=o+1;var u=s.slice(0,o);n.dispatchEvent(new i("message",{data:u}))}},n.xo.onfinish=function(e,t){n.xo.onchunk(e,t),n.xo=null;var r=e===200?"network":"permanent";n.dispatchEvent(new i("close",{reason:r}))}};return rt.prototype=new r,rt.prototype.abort=function(){var e=this;e.xo&&(e.xo.close(),e.dispatchEvent(new i("close",{reason:"user"})),e.xo=null)},T.getUtils=function(){return n},T.getIframeTransport=function(){return j},T}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),typeof define=="function"&&define.amd&&define("sockjs",[],function(){return SockJS}),Library.string=sumeru.Library.create(function(e){return e.trim=function(e){return e.replace(/^\s|\s$/g,"")},e.escapeRegex=function(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},e}),Library.screenUtils=sumeru.Library.create(function(e){var t=e.fullScreen=function(){function e(){var e=document.documentElement,t=window.innerHeight,n=window.outerHeight,r=window.devicePixelRatio;e.style.height="100%",scrollHeight<n&&(e.style.height=n/window.devicePixelRatio+"px"),setTimeout(function(){window.scrollTo(0,1)},0)}window.addEventListener("load",function(){e()}),window.addEventListener("orientationchange",function(){document.documentElement.style.height="auto",e(),setTimeout(function(){e()},800)})};return e}),Library.cookie=sumeru.Library.create(function(e){var t="",n=e.addCookie=function(e,t,n){var r=e+"="+escape(t);if(n>0){var i=new Date;i.setTime(i.getTime()+n*3600*1e3),r=r+"; expires="+i.toGMTString()}document.cookie=r},r=e.getCookie=function(e){var n=document.cookie,r=n.split("; ");for(var i=0;i<r.length;i++){var s=r[i].split("=");if(s[0]==e)return s[1]}return t},i=e.deleteCookie=function(e){n(e,t)};return e});var touch=Library.touch=sumeru.Library.create(function(e){function N(e,t){var n=d.get(e,"_touchEv");n||(n=new g(e),d.set(e,"_touchEv",n)),n["on"+t]=function(n){v.trigger(e,t,n)}}function C(e){var t=d.get(e,"_touchEv");if(!t)return;d.set(e,"_touchEv",null),t.tearDown()}var t=function(e){if(!e||r(e)!=="object"||e.nodeType||e===e.window)return!1;var t=Object.prototype.hasOwnProperty;if(e.constructor&&!t.call(e,"constructor")&&!t.call(e.constructor.prototype,"isPrototypeOf"))return!1;var n;for(n in e);return n===undefined||t.call(e,n)},n={};"Boolean Number String Function Array Date RegExp Object".split(" ").forEach(function(e){n["[object "+e+"]"]=e.toLowerCase()});var r=function(e){return e==null?"null":n[Object.prototype.toString.call(e)]||"object"},i=function(e){return r(e)==="object"},s=function(e){return r(e)==="array"},o=function(e){return r(e)==="function"},u=function(e){return r(e)==="string"},a=function(e){return r(e)==="bollean"},f=function(e){return r(e)==="number"},l=function(e){return r(e)==="date"},c=function(e){return r(e)==="regexp"},h=function(){var e,n,r,i,u,a,f=arguments[0]||{},l=1,c=arguments.length,p=!1;typeof f=="boolean"&&(p=f,f=arguments[1]||{},l=2),typeof f!="object"&&!o(f)&&(f={});if(c===l)return f;for(;l<c;l++)if((e=arguments[l])!=null)for(n in e){r=f[n],i=e[n];if(f===i)continue;p&&i&&(t(i)||(u=s(i)))?(u?(u=!1,a=r&&s(r)?r:[]):a=r&&t(r)?r:{},f[n]=h(p,a,i)):i!==undefined&&(f[n]=i)}return f},p=function(){var e="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIGKLMNOPQRSTUVWXYZ",t=e.length-1;return{query:function(e){return document.querySelectorAll(e)},randomStr:function(n){var r="";n=typeof n=="undefined"?8:n;for(var i=0;i<n;i++)r+=e[Math.floor(Math.random()*(t+1))];return r},getElUID:function(e){var t=e.getAttribute("data-uid");return t||(t=this.randomStr(18),e.setAttribute("data-uid",t)),t},addEvents:function(e,t,n){t=t?t.split(" "):[];for(var r=0,i=t.length;r<i;r++)e.addEventListener&&n&&e.addEventListener(t[r],n,!1)},removeEvents:function(e,t,n){t=t?t.split(" "):[];for(var r=0,i=t.length;r<i;r++)e.removeEventListener&&e.removeEventListener(t[r],n,!1)},deepCopy:function(e,t){return t||(t=e,e={}),h(!0,e,t),e}}}(),d=function(){var e={};return{get:function(t,n){var r=p.getElUID(t);return e[r]=e[r]||{},arguments.length===1?e[r]:e[r][n]},set:function(t,n,r){var i=p.getElUID(t);e[i]=e[i]||{},e[i][n]=r}}}(),v=function(){var e={},t={};return{trigger:function(n,r,i){var s=p.getElUID(n),o=e[s][r].handler,u=L,a=[u.SWIPE_START,u.SWIPING,u.SWIPE_END,u.SWIPE_LEFT,u.SWIPE_RIGHT,u.SWIPE_UP,u.SWIPE_DOWN,u.SWIPE],f=function(e,n,r,i){r&&r.interval?(t[e]=t[e]||{},t[e].list=t[e].list||[],t[e].list.push(function(e,t,n){return function(){e.call(t,n)}}(e,n,i)),t[e].interval||(t[e].interval=setInterval(function(e){return function(){var n=t[e].list.shift();n?n():(clearInterval(t[e].interval),t[e].interval=null)}}(e),r.interval))):e.call(n,i)};for(var l=0,c=o.length;l<c;l++){var h=o[l].options;if(a.indexOf(r)!=-1&&h&&h.swipeFactor){var d=i.duration/1e3;i.factor=(10-h.swipeFactor)*d*d*10}if(h&&h.__binding_live){var v=i.originEvent.target,m=p.query(h.__binding_live);m&&m.length>0&&(m=Array.prototype.slice.apply(m,[0]),m.forEach(function(e){e.contains(v)&&f(o[l],e,h,i)}))}else f(o[l],n,h,i)}},off:function(){if(typeof arguments[0]=="undefined")return;var t=p.getElUID(arguments[0]);if(typeof arguments[3]=="string"){var n=[];try{n=e[t][arguments[1]].handler}catch(r){n=[]}if(arguments[2]){var i=n.indexOf(arguments[2]);if(i>-1){var s=n.splice(i,1);delete s.options}}else for(var o=0;o<n.length;o++){var u=n[o].options;if(u&&u.__binding_live&&u.__binding_live===arguments[3]){var s=n.splice(o,1);delete s.options,o--}}return!1}if(arguments.length==1)e[t]=null;else if(arguments.length===2)e[t]&&(e[t][arguments[1]]=null);else if(e[t]&&e[t][arguments[1]]&&e[t][arguments[1]].handler){var n=e[t][arguments[1]].handler,i=n.indexOf(arguments[2]);if(i>-1){var s=n.splice(i,1);delete s.options,e[t][arguments[1]]=n.length===0?null:n}}},add:function(t,n,r,i){var s=p.getElUID(t);e[s]=e[s]||{},e[s][n]=e[s][n]||{},e[s][n].handler=e[s][n].handler||[],!i||(r.options=i),typeof r=="function"?e[s][n].handler.push(r):null},hasHandler:function(t,n){try{var r=p.getElUID(t),i=e[r][n].handler;return i&&i.length>0?!0:!1}catch(s){return!1}},isEmpty:function(t){var n=p.getElUID(t),r=e[n];for(var i in r)if(r[i]&&r[i].handler&&r[i].handler.length!==0)return!1;return!0}}}(),m={tap:!0,doubleTap:!0,tapMaxDistance:10,hold:!0,holdTime:650,maxDoubleTapInterval:300,swipe:!0,swipeTime:300,swipeMinDistance:18,swipeFactor:5,drag:!0,pinch:!0,minScaleRate:0,minRotationAngle:0},g=function(){function t(t){if(e){var n=[],r=null;for(var i=0,s=t.touches.length;i<s;i++)r=t.touches[i],n.push({x:r.pageX,y:r.pageY});return n}return[{x:t.pageX,y:t.pageY}]}function n(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}function r(e){return e.touches?e.touches.length:1}function i(e,t){if(e.length>=2&&t.length>=2){var r=n(e[1],e[0]),i=n(t[1],t[0]);return i/r}return 1}function s(e,t){return Math.atan2(t.y-e.y,t.x-e.x)*180/Math.PI}function o(e,t){var n=Math.atan((t.y-e.y)*-1/(t.x-e.x))*(180/Math.PI);return n<0?n+180:n}function u(e){var t={up:e<-45&&e>-135,down:e>=45&&e<135,left:e>=135||e<=-135,right:e>=-45&&e<=45};for(var n in t)if(t[n])return n;return null}function a(e){e.preventDefault(),e.stopPropagation()}function f(e){var t=0,n=0;while(e.offsetParent)t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;return{left:t,top:n}}var e="ontouchstart"in window;return function(a){function A(e,t){typeof l["on"+e]=="function"&&l["on"+e](t)}function O(){g=y=b=null,C=T=w=E=!1,S=!1,c={},B=!1}function M(e){return e.type==="touchstart"||e.type==="mousedown"}function _(e){return e.type==="touchmove"||e.type==="mousemove"}function D(e){return e.type==="touchend"||e.type==="mouseup"||e.type==="touchcancel"}function P(e,t,n,r){v.hasHandler(e,t)&&(r=typeof r=="undefind"?!0:r,r&&(n=p.deepCopy(n)),n.type=t,n.startRotate=function(){l.startRotate()},A(t,n))}var l=this,c={start:null,move:null,end:null},h=0,d=0,g=null,y=null,b=null,w=!1,E=!1,S=!1,x={},T=!1,N=null,C=!1,k=null,H=1,B=!1,j=[],F=0,I=0,q=0,R=null,U={_getAngleDiff:function(e){var t=parseInt(F-o(e[0],e[1]),10),n=0;while(Math.abs(t-I)>90&&n++<50)I<0?t-=180:t+=180;return I=parseInt(t,10),I},pinch:function(e){if(m.pinch){if(!T)return;if(r(e)<2&&!D(e))return;var t=v,n=i(c.start,c.move),s=this._getAngleDiff(c.move),o={type:"",originEvent:e,scale:n,rotation:s,direction:s>0?"right":"left",fingersCount:r(e),startRotate:function(){l.startRotate()}};E?_(e)?o.fingerStatus="move":D(e)&&(o.fingerStatus="end",P(a,L.PINCH_END,o)):(E=!0,o.fingerStatus="start",P(a,L.PINCH_START,o)),P(a,L.PINCH,o);if(Math.abs(1-n)>m.minScaleRate){var u=p.deepCopy(o),f=1e-11;n>H?(H=n-f,P(a,L.PINCH_OUT,u,!1)):n<H&&(H=n+f,P(a,L.PINCH_IN,u,!1)),D(e)&&(H=1)}if(Math.abs(s)>m.minRotationAngle){var h=p.deepCopy(o),d;d=s>0?L.ROTATION_RIGHT:L.ROTATION_LEFT,P(a,d,h,!1),P(a,L.ROTATION,o)}}},rotateSingleFinger:function(e){if(B&&r(e)<2){if(!c.move)return;if(j.length<2){var t=f(a);j=[{x:t.left+a.offsetWidth/2,y:t.top+a.offsetHeight/2},c.move[0]],F=parseInt(o(j[0],j[1]),10)}var n=[j[0],c.move[0]],i=this._getAngleDiff(n),s={type:"",originEvent:e,rotation:i,direction:i>0?"right":"left",fingersCount:r(e)};if(_(e))s.fingerStatus="move";else if(D(e)||e.type==="mouseout")s.fingerStatus="end",P(a,L.PINCH_END,s);eventType=i>0?L.ROTATION_RIGHT:L.ROTATION_LEFT,P(a,eventType,s),P(a,L.ROTATION,s)}},swipe:function(e){if(!T||!c.move||r(e)>1)return;var t=v,i=Date.now(),o=i-h,f=n(c.start[0],c.move[0]),l={x:c.move[0].x-x.left,y:c.move[0].y-x.top},p=s(c.start[0],c.move[0]),d=u(p),g=o/1e3,y=(10-m.swipeFactor)*10*g*g,b={type:L.SWIPE,originEvent:e,position:l,direction:d,distance:f,distanceX:c.move[0].x-c.start[0].x,distanceY:c.move[0].y-c.start[0].y,angle:p,duration:o,fingersCount:r(e),factor:y};if(m.swipe){var E=function(){var e=L;switch(d){case"up":P(a,e.SWIPE_UP,b);break;case"down":P(a,e.SWIPE_DOWN,b);break;case"left":P(a,e.SWIPE_LEFT,b);break;case"right":P(a,e.SWIPE_RIGHT,b)}};if(!w)b.fingerStatus=b.swipe="start",w=!0,P(a,L.SWIPE_START,b);else if(_(e))b.fingerStatus=b.swipe="move",P(a,L.SWIPING,b),o>m.swipeTime&&o<m.swipeTime+50&&f>m.swipeMinDistance&&(E(),P(a,L.SWIPE,b,!1));else if(D(e)||e.type==="mouseout")b.fingerStatus=b.swipe="end",P(a,L.SWIPE_END,b),m.swipeTime>o&&f>m.swipeMinDistance&&(E(),P(a,L.SWIPE,b,!1))}m.drag&&(S?_(e)?b.fingerStatus=b.swipe="move":D(e)&&(b.fingerStatus=b.swipe="end"):(b.fingerStatus=b.swipe="start",S=!0),P(a,L.DRAG,b))},tap:function(e){if(m.tap){var t=v,i=Date.now(),s=i-h,o=n(c.start[0],c.move?c.move[0]:c.start[0]);clearTimeout(N);var u=function(){if(R&&m.doubleTap&&h-q<m.maxDoubleTapInterval){var e=n(R,c.start[0]);if(e<16)return!0}return!1}();if(u){A(L.DOUBLE_TAP,{type:L.DOUBLE_TAP,originEvent:e,position:c.start[0]});return}if(m.tapMaxDistance<o)return;m.holdTime>s&&r(e)<=1&&(C=!0,q=i,R=c.start[0],t.hasHandler(a,L.TAP)&&A(L.TAP,{type:L.TAP,originEvent:e,fingersCount:r(e),position:c.start[0]}),t.hasHandler(a,L.CLICK)&&A(L.CLICK,{type:L.CLICK,originEvent:e,fingersCount:r(e),position:c.start[0]}))}},hold:function(e){m.hold&&(clearTimeout(N),N=setTimeout(function(){if(!c.start)return;var t=n(c.start[0],c.move?c.move[0]:c.start[0]);if(m.tapMaxDistance<t)return;C||A("hold",{type:"hold",originEvent:e,fingersCount:r(e),position:c.start[0]})},m.holdTime))}},z=function(e){switch(e.type){case"touchstart":case"mousedown":B=!1,j=[],P(a,e.type,{originEvent:e}),T=!0;if(!c.start||c.start.length<2)c.start=t(e);r(e)>=2&&(F=parseInt(o(c.start[0],c.start[1]),10)),h=Date.now(),g=e,x={};var n=a.getBoundingClientRect(),i=document.documentElement;x={top:n.top+(window.pageYOffset||i.scrollTop)-(i.clientTop||0),left:n.left+(window.pageXOffset||i.scrollLeft)-(i.clientLeft||0)},U.hold(e);break;case"touchmove":case"mousemove":P(a,e.type,{originEvent:e});if(!T||!c.start)return;c.move=t(e),r(e)>=2?U.pinch(e):(B&&U.rotateSingleFinger(e),U.swipe(e));break;case"touchend":case"touchcancel":case"mouseup":case"mouseout":P(a,e.type,{originEvent:e});if(!T)return;b=e,E?U.pinch(e):(B&&U.rotateSingleFinger(e),w&&U.swipe(e)),U.tap(e),O(),F=0,I=0,e.touches&&e.touches.length===1&&(T=!0,B=!0)}},W=e?"touchstart touchmove touchend touchcancel":"mouseup mousedown mousemove mouseout";p.addEvents(a,W,z),this.tearDown=function(){p.removeEvents(a,W,z)},this.startRotate=function(){B=!0}}}(),y=function(){if(typeof arguments.length<3)throw"Please specify complete argments";var e=typeof arguments[0]=="string"?p.query(arguments[0]):[arguments[0]],t=arguments[1].split(" "),n=arguments[arguments.length-1],r=arguments.length>3?arguments[arguments.length-2]:undefined;e=Array.prototype.slice.apply(e,[0]),e.forEach(function(e){for(var i=0;i<t.length;i++){var s=x(t[i]);A.special[s]?(v.add(e,s,n,r),A.special[s].setUp.apply(this,[e,s])):p.addEvents(e,s,n)}})},b=function(){if(arguments.length<3)throw new Error("wrong argument");if(typeof arguments[0]!="string"){y.apply(e,arguments);return}var t=arguments.length>3?arguments[arguments.length-2]:{},n=arguments[1],r=arguments[arguments.length-1];t.__binding_live=arguments[0],y.apply(e,[document.body,n,t,r])},w=function(e,t,n,r){if(typeof e=="undefined")throw"Please specify the selector.";e=typeof e=="string"?p.query(e):[e],e=Array.prototype.slice.apply(e,[0]),t?(t=t.split(" "),e.forEach(function(e){t.forEach(function(t,i){var s=[e,x(t)];n?s.push(n):null,r?s.push(r):null,A.special[t]?(v.off.apply(v,s),v.isEmpty(e,t)&&A.special[t].tearDown(e)):p.removeEvents.apply(this,s)})})):(v.off(e),p.removeEvents(e))},E=function(e,t,n){w(document.body,t,n,e)},S={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"},x=function(e){return"ontouchstart"in window||!S[e]?e:S[e]},T=function(e){if(typeof e!="object")return;m=h(m,e)},k={setUp:N,tearDown:C},L={TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_UP:"mouseup",CLICK:"click",PINCH_START:"pinchstart",PINCH_END:"pinchend",PINCH:"pinch",PINCH_IN:"pinchin",PINCH_OUT:"pinchout",ROTATION_LEFT:"rotateleft",ROTATION_RIGHT:"rotateright",ROTATION:"rotate",SWIPE_START:"swipestart",SWIPING:"swiping",SWIPE_END:"swipeend",SWIPE_LEFT:"swipeleft",SWIPE_RIGHT:"swiperight",SWIPE_UP:"swipeup",SWIPE_DOWN:"swipedown",SWIPE:"swipe",DRAG:"drag",HOLD:"hold",TAP:"tap",DOUBLE_TAP:"doubletap"},A={};return A.special={},Object.keys(L).forEach(function(e){A.special[L[e]]=k}),e.live=b,e.die=E,e.on=y,e.off=w,e.config=T,e});(function(){Library.domUtils=sumeru.Library.create(function(e){e.Encoder=function(e){return{EncodeType:e||"entity",isEmpty:function(e){return e?e===null||e.length==0||/^\s+$/.test(e):!0},arr1:new Array("&nbsp;","&iexcl;","&cent;","&pound;","&curren;","&yen;","&brvbar;","&sect;","&uml;","&copy;","&ordf;","&laquo;","&not;","&shy;","&reg;","&macr;","&deg;","&plusmn;","&sup2;","&sup3;","&acute;","&micro;","&para;","&middot;","&cedil;","&sup1;","&ordm;","&raquo;","&frac14;","&frac12;","&frac34;","&iquest;","&Agrave;","&Aacute;","&Acirc;","&Atilde;","&Auml;","&Aring;","&Aelig;","&Ccedil;","&Egrave;","&Eacute;","&Ecirc;","&Euml;","&Igrave;","&Iacute;","&Icirc;","&Iuml;","&ETH;","&Ntilde;","&Ograve;","&Oacute;","&Ocirc;","&Otilde;","&Ouml;","&times;","&Oslash;","&Ugrave;","&Uacute;","&Ucirc;","&Uuml;","&Yacute;","&THORN;","&szlig;","&agrave;","&aacute;","&acirc;","&atilde;","&auml;","&aring;","&aelig;","&ccedil;","&egrave;","&eacute;","&ecirc;","&euml;","&igrave;","&iacute;","&icirc;","&iuml;","&eth;","&ntilde;","&ograve;","&oacute;","&ocirc;","&otilde;","&ouml;","&divide;","&Oslash;","&ugrave;","&uacute;","&ucirc;","&uuml;","&yacute;","&thorn;","&yuml;","&quot;","&amp;","&lt;","&gt;","&oelig;","&oelig;","&scaron;","&scaron;","&yuml;","&circ;","&tilde;","&ensp;","&emsp;","&thinsp;","&zwnj;","&zwj;","&lrm;","&rlm;","&ndash;","&mdash;","&lsquo;","&rsquo;","&sbquo;","&ldquo;","&rdquo;","&bdquo;","&dagger;","&dagger;","&permil;","&lsaquo;","&rsaquo;","&euro;","&fnof;","&alpha;","&beta;","&gamma;","&delta;","&epsilon;","&zeta;","&eta;","&theta;","&iota;","&kappa;","&lambda;","&mu;","&nu;","&xi;","&omicron;","&pi;","&rho;","&sigma;","&tau;","&upsilon;","&phi;","&chi;","&psi;","&omega;","&alpha;","&beta;","&gamma;","&delta;","&epsilon;","&zeta;","&eta;","&theta;","&iota;","&kappa;","&lambda;","&mu;","&nu;","&xi;","&omicron;","&pi;","&rho;","&sigmaf;","&sigma;","&tau;","&upsilon;","&phi;","&chi;","&psi;","&omega;","&thetasym;","&upsih;","&piv;","&bull;","&hellip;","&prime;","&prime;","&oline;","&frasl;","&weierp;","&image;","&real;","&trade;","&alefsym;","&larr;","&uarr;","&rarr;","&darr;","&harr;","&crarr;","&larr;","&uarr;","&rarr;","&darr;","&harr;","&forall;","&part;","&exist;","&empty;","&nabla;","&isin;","&notin;","&ni;","&prod;","&sum;","&minus;","&lowast;","&radic;","&prop;","&infin;","&ang;","&and;","&or;","&cap;","&cup;","&int;","&there4;","&sim;","&cong;","&asymp;","&ne;","&equiv;","&le;","&ge;","&sub;","&sup;","&nsub;","&sube;","&supe;","&oplus;","&otimes;","&perp;","&sdot;","&lceil;","&rceil;","&lfloor;","&rfloor;","&lang;","&rang;","&loz;","&spades;","&clubs;","&hearts;","&diams;"),arr2:new Array("&#160;","&#161;","&#162;","&#163;","&#164;","&#165;","&#166;","&#167;","&#168;","&#169;","&#170;","&#171;","&#172;","&#173;","&#174;","&#175;","&#176;","&#177;","&#178;","&#179;","&#180;","&#181;","&#182;","&#183;","&#184;","&#185;","&#186;","&#187;","&#188;","&#189;","&#190;","&#191;","&#192;","&#193;","&#194;","&#195;","&#196;","&#197;","&#198;","&#199;","&#200;","&#201;","&#202;","&#203;","&#204;","&#205;","&#206;","&#207;","&#208;","&#209;","&#210;","&#211;","&#212;","&#213;","&#214;","&#215;","&#216;","&#217;","&#218;","&#219;","&#220;","&#221;","&#222;","&#223;","&#224;","&#225;","&#226;","&#227;","&#228;","&#229;","&#230;","&#231;","&#232;","&#233;","&#234;","&#235;","&#236;","&#237;","&#238;","&#239;","&#240;","&#241;","&#242;","&#243;","&#244;","&#245;","&#246;","&#247;","&#248;","&#249;","&#250;","&#251;","&#252;","&#253;","&#254;","&#255;","&#34;","&#38;","&#60;","&#62;","&#338;","&#339;","&#352;","&#353;","&#376;","&#710;","&#732;","&#8194;","&#8195;","&#8201;","&#8204;","&#8205;","&#8206;","&#8207;","&#8211;","&#8212;","&#8216;","&#8217;","&#8218;","&#8220;","&#8221;","&#8222;","&#8224;","&#8225;","&#8240;","&#8249;","&#8250;","&#8364;","&#402;","&#913;","&#914;","&#915;","&#916;","&#917;","&#918;","&#919;","&#920;","&#921;","&#922;","&#923;","&#924;","&#925;","&#926;","&#927;","&#928;","&#929;","&#931;","&#932;","&#933;","&#934;","&#935;","&#936;","&#937;","&#945;","&#946;","&#947;","&#948;","&#949;","&#950;","&#951;","&#952;","&#953;","&#954;","&#955;","&#956;","&#957;","&#958;","&#959;","&#960;","&#961;","&#962;","&#963;","&#964;","&#965;","&#966;","&#967;","&#968;","&#969;","&#977;","&#978;","&#982;","&#8226;","&#8230;","&#8242;","&#8243;","&#8254;","&#8260;","&#8472;","&#8465;","&#8476;","&#8482;","&#8501;","&#8592;","&#8593;","&#8594;","&#8595;","&#8596;","&#8629;","&#8656;","&#8657;","&#8658;","&#8659;","&#8660;","&#8704;","&#8706;","&#8707;","&#8709;","&#8711;","&#8712;","&#8713;","&#8715;","&#8719;","&#8721;","&#8722;","&#8727;","&#8730;","&#8733;","&#8734;","&#8736;","&#8743;","&#8744;","&#8745;","&#8746;","&#8747;","&#8756;","&#8764;","&#8773;","&#8776;","&#8800;","&#8801;","&#8804;","&#8805;","&#8834;","&#8835;","&#8836;","&#8838;","&#8839;","&#8853;","&#8855;","&#8869;","&#8901;","&#8968;","&#8969;","&#8970;","&#8971;","&#9001;","&#9002;","&#9674;","&#9824;","&#9827;","&#9829;","&#9830;"),HTML2Numerical:function(e){return this.swapArrayVals(e,this.arr1,this.arr2)},NumericalToHTML:function(e){return this.swapArrayVals(e,this.arr2,this.arr1)},numEncode:function(e){if(this.isEmpty(e))return"";var t="";for(var n=0;n<e.length;n++){var r=e.charAt(n);if(r<" "||r>"~")r="&#"+r.charCodeAt()+";";t+=r}return t},htmlDecode:function(e){var t,n,r=e;if(this.isEmpty(r))return"";r=this.HTML2Numerical(r),arr=r.match(/&#[0-9]{1,5};/g);if(arr!=null)for(var i=0;i<arr.length;i++)n=arr[i],t=n.substring(2,n.length-1),t>=-32768&&t<=65535?r=r.replace(n,String.fromCharCode(t)):r=r.replace(n,"");return r},htmlEncode:function(e,t){if(this.isEmpty(e))return"";t=t||!1,t&&(this.EncodeType=="numerical"?e=e.replace(/&/g,"&#38;"):e=e.replace(/&/g,"&amp;")),e=this.XSSEncode(e,!1);if(this.EncodeType=="numerical"||!t)e=this.HTML2Numerical(e);return e=this.numEncode(e),t||(e=e.replace(/&#/g,"##AMPHASH##"),this.EncodeType=="numerical"?e=e.replace(/&/g,"&#38;"):e=e.replace(/&/g,"&amp;"),e=e.replace(/##AMPHASH##/g,"&#")),e=e.replace(/&#\d*([^\d;]|$)/g,"$1"),t||(e=this.correctEncoding(e)),this.EncodeType=="entity"&&(e=this.NumericalToHTML(e)),e},XSSEncode:function(e,t){return this.isEmpty(e)?"":(t=t||!0,t?(e=e.replace(/\'/g,"&#39;"),e=e.replace(/\"/g,"&quot;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;")):(e=e.replace(/\'/g,"&#39;"),e=e.replace(/\"/g,"&#34;"),e=e.replace(/</g,"&#60;"),e=e.replace(/>/g,"&#62;")),e)},hasEncoded:function(e){return/&#[0-9]{1,5};/g.test(e)?!0:/&[A-Z]{2,6};/gi.test(e)?!0:!1},stripUnicode:function(e){return e.replace(/[^\x20-\x7E]/g,"")},correctEncoding:function(e){return e.replace(/(&amp;)(amp;)+/,"$1")},swapArrayVals:function(e,t,n){if(this.isEmpty(e))return"";var r;if(t&&n&&t.length==n.length)for(var i=0,s=t.length;i<s;i++)r=new RegExp(t[i],"g"),e=e.replace(r,n[i]);return e},inArray:function(e,t){for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1}}},e.on=function(e,t,n){e&&t&&n&&(t.indexOf("on")==0&&(t=t.substr(2)),e.addEventListener(t,n))},e.hasClass=function(e,t){if(e.className=="")return!1;if(e.classList&&e.classList.contains)return e.classList.contains(t);var n=e.className.split(" ");return n.indexOf(t)!==-1};var t=function(e,t){var t=t||document,n=t.querySelectorAll(e);return n.length===1?n[0]:n};t.makeArray=function(e){return Array.prototype.slice.call(e)},t.reg=function(e,t,n){e.prototype[t]||(e.prototype[t]=n)},t.extend=function(){return!1},t.reg(Node,"contains",function(e){return this.compareDocumentPosition(e)-19>0}),t.reg(Node,"closestByClass",function(e){var t=this;while(!t.classList.contains(e))t=this.parentNode;return t}),t.reg(Node,"addClass",function(e){return this.classList.add(e),this}),t.reg(Node,"find",function(e){return t(e,this)}),t.reg(Node,"removeClass",function(e){return this.classList.remove(e),this}),t.reg(Node,"hasClass",function(e){return this.classList.contains(e)}),t.reg(Node,"toggleClass",function(e){return this.classList.toggle(e),this}),t.reg(Node,"css",function(){if(arguments.length===1&&typeof arguments[0]=="string")return this.style[arguments[0]];if(typeof arguments[0]=="object"){var e=this,t=arguments[0],n=Object.keys(arguments[0]);n.forEach(function(r,i){e.style[n[i]]=t[n[i]]})}else{var r=arguments[0],i=arguments[1];this.style[r]=i}return this}),t.reg(Node,"forEach",function(e){return Array.prototype.forEach.call([this],function(t,n,r){e(t,n,r)}),this}),t.reg(Node,"index",function(){var e=this,t=0;while(e.previousSibling)t++,e=e.previousSibling;return t}),t.reg(NodeList,"forEach",function(e){Array.prototype.forEach.call(this,function(t,n,r){e(t,n,r)})}),t.reg(NodeList,"addClass",function(e){return this.forEach(function(t){t.classList.add(e)}),this}),t.reg(NodeList,"removeClass",function(e){return this.forEach(function(t,n,r){t.classList.remove(e)}),this}),t.reg(String,"contains",function(e){return this.indexOf(e)===-1?!1:!0}),Object.equals=function(e,t){if(e===t)return!0;if(e instanceof Object&&t instanceof Object){if(e.constructor!==t.constructor)return!1;for(var n in e)if(e.hasOwnProperty(n)){if(!t.hasOwnProperty(n))return!1;if(e[n]===t[n])continue;if(typeof e[n]!="object")return!1;if(!Object.equals(e[n],t[n]))return!1}for(n in t)if(t.hasOwnProperty(n)&&!e.hasOwnProperty(n))return!1;return!0}return!1},t.getLocalData=function(e){return JSON.parse(localStorage.getItem(e))},t.setLocalData=function(e,t){var n=JSON.stringify(t);localStorage.setItem(e,n)},e.$=t})})();var runnable=function(e){Library.asyncCallbackHandler=e.Library.create(function(e){var t=function(e,t){this.counter=0,this.callbacked=!1,this.callback=function(){this.callbacked||(e(),this.callbacked=!0)},this._enableCallback=!1,t&&(this.timeout=t),this.timeoutFunc=null};return t.prototype={add:function(){this.counter++},decrease:function(){this.counter--,this._enableCallback&&this.counter===0&&this.callback()},enableCallback:function(){this._enableCallback=!0,this.timeout&&(this.timeoutFunc=setTimeout(function(e){e.callback()}(this),this.timeout)),this._enableCallback&&this.counter===0&&this.callback()}},e.create=function(e,n){return new t(e,n)},e})};typeof module!="undefined"&&module.exports?module.exports=runnable:runnable(sumeru),Model=Model||{},Model.smrAuthModel=function(e){e.config={fields:[{name:"token",type:"string"},{name:"password",type:"string"},{name:"sessionId",type:"string"},{name:"info",type:"object"},{name:"status",type:"string",defaultValue:"0"},{name:"clientId",type:"string"},{name:"secretKey",type:"string"},{name:"passportType",type:"string",defaultValue:"local"},{name:"vCodeStr",type:"string"},{name:"verifyCode",type:"string"}]}},Model.smrLoginModel=function(e){e.config={fields:[{name:"clientId",type:"string"},{name:"token",type:"string"},{name:"sessionId",type:"string"},{name:"time",type:"string"},{name:"userId",type:"string"},{name:"lastRequestTime",type:"string"},{name:"isLogin",type:"string",defaultValue:"1"},{name:"info",type:"object"},{name:"expires",type:"int"}]}},function(e){var t=e.addSubPackage("auth");t.addSubPackage("tpa"),t.addSubPackage("baidu");var n=!1,r=!1,i=[],s={},o={},u=175200,a=new e.pubsub._pubsubObject;s.LOGOUT="0",s.LOGIN="1",s.LOGIN_UNKNOW="2",s.LOGIN_TIMEOUT="3",s.LOGIN_PASSWORD_UPDATE="4",s.LOGIN_VERIFY_CODE="5",s.UPSERT_SUCC="10",s.UPSERT_FAIL="11",s.UPSERT_REPEAT="12",o.local="LOCAL",o.baidu="BAIDU",o.tpa="tpa";var f=e.model.create("Model.smrAuthModel"),l="http://passport.baidu.com/cgi-bin/genimage?",c=function(e){var t=this,o=Library.cookie,l=o.getCookie("sessionId"),c=o.getCookie("clientId"),h=o.getCookie("passportType");l||f.set("status",s.LOGOUT),c&&f.set("clientId",c),a.subscribe("auth-init",l,c,h,function(o){var a=o.get(0);l&&l===a.get("sessionId")&&(f.set("status",s.LOGIN),f.set("token",a.get("token")),f.set("info",a.get("info")),f.set("passportType",a.get("passportType")),n=!0),c||Library.cookie.addCookie("clientId",a.get("clientId"),u),i&&i.length>0&&i.forEach(function(e){e()}),r=!0,e&&e.call(t,f.get("status"))})},h=function(e,t){var r=s.LOGOUT;if(e.length>0){var i=e.get(0);r=i.get("status"),f.set("status",r),sumeru.model._extend(f,i),r===s.LOGIN&&(n=!0,Library.cookie.addCookie("sessionId",i.get("sessionId"),u),Library.cookie.addCookie("passportType",i.get("passportType"),u)),i.get("passportType")===o.baidu&&f.set("verifyCode",l+i.get("vCodeStr"))}t&&t.call(this,{success:r===s.LOGIN,status:r})},p=function(){if(arguments.length===0)throw"Please specified local token or password.";var t,n,r,i,s=Library.cookie.getCookie("clientId");if(arguments.length===1&&typeof arguments[0]=="object"){var o=arguments[0];t=o.token,n=o.password,i=o.callback,r=o.expires}else t=arguments[0],n=arguments[1],arguments.length<=3?i=arguments[2]:(r=arguments[2],i=arguments[3]);a.prioritySubscribe("auth-login",t,n,s,r,function(t){h.call(e.auth,t,i)})},d=function(){if(arguments.length===0)throw"Please specify the token or password with baidu account";var t,n,r,i,s,o;t=Library.cookie.getCookie("clientId");if(arguments.length===1&&typeof arguments[0]=="object"){var u=arguments[0];n=u.token,r=u.password,o=u.callback,s=u.expires,i=u.verifyCode}else n=arguments[0],r=arguments[1],arguments.length===3?o=arguments[2]:arguments.length>3&&(i=arguments[2],o=arguments[3]);a.prioritySubscribe("auth-login-baidu",t,n,r,f.get("vCodeStr"),i,s,function(t){h.call(e.auth,t,o)})},v=function(){var t,n,r,i,s=Library.cookie.getCookie("clientId");if(arguments.length<2)throw"Please specify the token or password with baidu account";t=arguments[0],n=arguments[1],arguments.length===3?(r="",i=arguments[2]):arguments.length>3&&(r=arguments[2],i=arguments[3]),a.prioritySubscribe("other-login",t,n,r,s,function(t){h.call(e.auth,t,i)})},m=function(t,n,r,i){var o=Library.cookie.getCookie("clientId");a.subscribe("auth-register",t,n,r,o,function(t){var n=t.get(0),r=n.get("status");i.call(e.auth,{success:r===s.UPSERT_SUCC,status:r})})},g=function(t,r){if(n){var i=Library.cookie.getCookie("clientId"),o=Library.cookie.getCookie("sessionId");a.subscribe("auth-update",o,i,t,function(t){var n=t.get(0),i=n.get("status");r.call(e.auth,{success:i===s.UPSERT_SUCC,status:i})})}},y=function(e,t,n,r){m(e,t,n,r)},b=function(t){var n=Library.cookie.getCookie("sessionId"),r=Library.cookie.getCookie("clientId");a.subscribe("auth-logout",n,r,function(n){var r=n.get(0);r.status===s.LOGOUT&&(f.status=s.LOGOUT,f.sessionId="",Library.cookie.deleteCookie("sessionId")),t&&t.call(e.auth,{success:r.status===s.LOGOUT,status:r.status})})},w=function(e){var t=this;return r?e&&e.call(this,f.get("status")):e&&i.push(function(){e.call(t,f.get("status"))}),f.get("status")===s.LOGIN},E=function(){return n?f.get("token"):""},S=function(){return sumeru.model._extend(sumeru.model.create("Model.smrAuthModel"),f)},x=function(){var e=f.get("status");return e===s.LOGIN_VERIFY_CODE?f.get("verifyCode"):null};e.auth.__reg("init",c,"private"),e.auth.__reg("login",p),e.auth.__reg("logout",b),e.auth.__reg("register",y),e.auth.__reg("update",g),e.auth.__reg("getToken",E),e.auth.__reg("getModel",S),e.auth.__reg("isLogin",w),e.auth.__reg("getVerifyCode",x),e.auth.tpa.__reg("login",v),e.auth.baidu.__reg("login",d)}(sumeru);var fwkit=function(){function g(e,t,n){m.push([e,t]),e.addEventListener(t,n,!1)}var e=e||function(t,n){return e.win?e.win(t,n):null};e.version="1.0";var t=null,n={},r={},i=0;e.noti_show=!0,e.snapping=!1;var s={},o,u,a="scrollbars=no,status=no,innerHeight=480,innerWidth=560",f="scrollbars=no,status=no,innerHeight=600,innerWidth=700",l="innerHeight=300,innerWidth=400,top=150,left=300,scrollbars=no,status=no,resizable=no",c=function(t){if(!e.main.isMain||!e.main.isKit)return!1;if(e.main.trayNotify&&!e.main.isMac){t==="/fav.ico"?e.systray("noflash"):e.systray("flash");return}o&&clearTimeout(o),o=setTimeout(function(){if(t===u)return;e.main.trayNotify&&e.main.trayNotify.close(),e.main.trayNotify=window.webkitNotifications.createTrayNotification(t,function(t){t.code===0?(e.systray.click_default(),e.systray.click&&e.systray.click()):t.code===1?e.systray.rightclick&&e.systray.rightclick():t.code===2?e.systray.mouseover&&e.systray.mouseover():t.code===3&&e.systray.dbclick&&e.systray.dbclick()}),e.main.trayNotify.show(),u=t},200)};e.systray=function(t,n){switch(t){case"show":e.main.trayNotify.show();break;case"hide":e.main.trayNotify.close();break;case"flash":e.main.trayNotify.updateTray(1);break;case"click":n&&(e.systray.click=n);break;case"addclick":if(arguments[2]&&s[arguments[2]])return;s[arguments[2]]=n;break;case"mouseover":n&&(e.systray.mouseover=n);break;case"rightclick":n&&(e.systray.rightclick=n);break;case"noflash":e.main.trayNotify.updateTray(0);break;default:}};var h=function(e){for(var t in e)return!1;return!0};e.systray.click_default=function(){if(sumeru.reachability.getStatus()!=sumeru.reachability.STATUS_CONNECTED){window.exc_cmd("active"),location.hash="/hi-login!errmsg="+encodeURI("您已断线，请重新连接"),location.reload();return}if(e.winsStack.length||!h(s)){for(var t in s)s[t](),delete s[t];(function(e){for(var t=0,n=e.length;t<n;t++){var r=e.shift();r&&(Library.hiUtils.openDialog(r),delete r)}})(e.winsStack)}else window.exc_cmd("active")},e.taskbar=function(e,t){switch(e){case"show":window.exc_cmd("addicontaskbar");break;case"hide":window.exc_cmd("delicontaskbar");break;case"flash":window.flashWindow();break;default:}t&&t()},e.main=e.main||function(){var t={isMain:window.opener===null||window.opener===window,isKit:window.webkitNotifications&&typeof window.webkitNotifications.createTrayNotification!="undefined",isMac:navigator.userAgent.indexOf("Mac")!=-1};t.topWindow=null,t.isKit&&(window.addEventListener("keydown",function(n){var r=t.isMac?n.metaKey:n.ctrlKey;n.keyCode===87&&r?t.isMain?e("min"):window.close():n.keyCode===116&&n.preventDefault()}),window.onchromewindowclose=function(){e("close")});if(t.isMain)t.isKit&&(window.addEventListener("unload",function(){e.main.trayNotify.close(),o&&clearTimeout(o);var r=e.winsApp.getWins();for(y in n)n[y]&&n[y].close();t.isMac&&window.removeBadgeLabel()}),t.isMac||e.taskbar("hide"));else{var r=window.opener;while(r){if(r.opener===null||r.opener===r)break;r=r.opener}t.topWindow=r}return t.isMac&&window.addEventListener("dockclick",function(){e.systray.click_default(),e.systray.click&&e.systray.click()}),t}(),c("/fav.ico"),e.drag=function(t){function r(e){o(t,e)}function i(e){s(t,e)}function s(e,t){n={},e.releaseCapture?e.releaseCapture():e&&(window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",i))}function o(e,t){if(typeof n.winX=="undefined")return;window.moveTo(n.winX+(t.screenX-n.screenX),n.winY+(t.screenY-n.screenY))}var n={};e.main.offsetTop=window.outerHeight-window.innerHeight+window.screen.availTop,e.main.offsetLeft=window.outerWidth-window.innerWidth+window.screen.availLeft,t.addEventListener("mousedown",function(s){n.pageY=s.pageY,n.pageX=s.pageX,n.screenX=s.screenX,n.screenY=s.screenY,n.winX=s.screenX-n.pageX-e.main.offsetLeft,n.winY=s.screenY-n.pageY-e.main.offsetTop,t.setCapture?t.setCapture():(window.addEventListener("mousemove",r,!0),window.addEventListener("mouseup",i,!0))},!1),t.getElementsByClassName("imctrl").length&&t.getElementsByClassName("imctrl")[0].addEventListener("mousedown",function(e){e.stopPropagation()},!1)},e.win=function(t,n){if(!e.main.isKit&&t.substring(0,4)!=="open"&&t!="active")return!1;n=n||{};switch(t){case"max":window.exc_cmd("maximize");break;case"min":window.exc_cmd("minimize");break;case"active":e.main.isKit?window.exc_cmd("active"):window.focus();break;case"restore":window.exc_cmd("restore");break;case"open":return window.open(n.url,n.target||"",n.params);case"openDialog":if(e.winsApp.isActive(n)){var r=e.winsApp.getWin(n);if(r&&!r.closed){r.fwkit("active");return}}return e("open",{url:location.pathname+"#/hi-solo!fid="+n,target:"hi-solo-"+n,params:a});case"openMulti":if(e.winsApp.isActive(n)){var r=e.winsApp.getWin(n);if(r&&!r.closed){r.fwkit("active");return}}return e("open",{url:location.pathname+"#/hi-discussion!multiId="+n,target:"hi-multi-"+n,params:a});case"openGroup":if(e.winsApp.isActive(n)){var r=e.winsApp.getWin(n);if(r&&!r.closed){r.fwkit("active");return}}return e("open",{url:location.pathname+"#/hi-group!gid="+n,target:"hi-group-"+n,params:a});case"openHistory":return typeof n=="object"&&n.did?window.fwkit("open",{url:location.pathname+"#/hi-history!did="+n.did+"&type="+n.type,target:"hi-history",params:f}):window.fwkit("open",{url:location.pathname+"#/hi-history",target:"hi-history",params:f});case"openAddFriend":return window.fwkit("open",{url:location.pathname+"#/hi-addFriend",target:"hi-addFriend",params:l});case"close":e.main.isMain?e("min"):window.close();break;case"winSize":window.exc_cmd("setMinSize;width:"+(n.x||0)+";height:"+(n.y||0)+";");break;case"resize":typeof n=="object"&&window.resizeTo(n.x,n.y)}};var p=function(e){var t;return e.type==1?t="solo#"+e.from:e.type==2?t="group#"+e.to:e.type==="sys"&&(t="sys#"+e.smr_id),t},d=function(e){var t=p(e);return n[t]||!1};e.noti_close=function(e,t){if(e==="all"){for(var r in n)n[r]&&n[r].close();return!0}var i=e+"#"+t;return n[i]?(n[i].close(),delete n[i],!0):!1};var v=function(e,t){var r=p(e);return t===null?delete n[r]:n[r]=t,t};e.all_noti=function(){return n},e.noti=function(t,n,i,s){if(!e.noti_show)return;var o,u=d(t);if(u&&(t.keepShow||t.count==u.isShowed))return!1;var a=p(t),f=[];for(var l in t)f.push(l+"="+encodeURIComponent(t[l]));return o=window.webkitNotifications.createHTMLNotification("/noti.html?"+f.join("&")),o.isShowed=0,o.params=t,o.addEventListener("show",function(){this.params.keepShow||setTimeout(function(){o.close()},2e4),this.isShowed=this.params.count||1,v(this.params,this),s&&s()}),o.addEventListener("click",function(){n&&n(),this.params.keepShow||this.close()}),o.addEventListener("close",function(){this.isShowed&&delete this}),u?(u.cancel(),v(t,null)):console.log("open type ==2 just open"),r[a]&&clearTimeout(r[a]),r[a]=setTimeout(function(){o.show()},50),i&&o.addEventListener("close",i),v(t,o),!0};var m=[];e.snap=function(t){window.removeEventListener("screensnap"),window.exc_cmd("screensnap"),e.snapping=!0,window.addEventListener("screensnap",function(){e.snapping=!1,window.Screensnapdata&&t(window.Screensnapdata)},!1)},e.updateNotiCnt=function(t){if(i==t)return;t=parseInt(t),t>0?(e.main.isMac&&window.setBadgeLabel(t),i===0&&c("/hi1.ico")):(e.main.isMac&&window.removeBadgeLabel(),c("/fav.ico")),i=t},e.winsApp=function(){var e={},t=function(){return JSON.parse(localStorage.getItem("wins"))},n=function(e){localStorage.setItem("wins",JSON.stringify(e))},r=function(){n([])},i=function(r,i){var s=t();s.push(r),n(s),typeof i!="undefined"&&(e[r]=i)},s=function(r){var i=t();i.splice(i.indexOf(r),1),n(i),typeof e[r]!="undefined"&&delete e[r]},o=function(t){return typeof e[t]!="undefined"},u=function(t){return e[t]},a=function(){return e},f=function(){return t()};return{init:r,status:f,add:i,remove:s,getWin:u,getWins:a,isActive:o}}(),e.winsStack=[];if(!e.main.isKit)for(var y in e)typeof e[y]=="function"&&y!=="drag"&&y!=="win"&&function(t){e[t]=function(){console.log("not in kitsuit! fwkit."+t)}}(y);return e}()